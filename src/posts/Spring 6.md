# Spring6


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221209110043449.png)



## 1ã€æ¦‚è¿°


### 1.1ã€Springæ˜¯ä»€ä¹ˆï¼Ÿ


Spring æ˜¯ä¸€æ¬¾ä¸»æµçš„ Java EE è½»é‡çº§å¼€æºæ¡†æ¶ ï¼ŒSpring ç”±â€œSpring ä¹‹çˆ¶â€Rod Johnson æå‡ºå¹¶åˆ›ç«‹ï¼Œå…¶ç›®çš„æ˜¯ç”¨äºç®€åŒ– Java ä¼ä¸šçº§åº”ç”¨çš„å¼€å‘éš¾åº¦å’Œå¼€å‘å‘¨æœŸã€‚Springçš„ç”¨é€”ä¸ä»…é™äºæœåŠ¡å™¨ç«¯çš„å¼€å‘ã€‚ä»ç®€å•æ€§ã€å¯æµ‹è¯•æ€§å’Œæ¾è€¦åˆçš„è§’åº¦è€Œè¨€ï¼Œä»»ä½•Javaåº”ç”¨éƒ½å¯ä»¥ä»Springä¸­å—ç›Šã€‚Spring æ¡†æ¶é™¤äº†è‡ªå·±æä¾›åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›æ•´åˆå…¶ä»–æŠ€æœ¯å’Œæ¡†æ¶çš„èƒ½åŠ›ã€‚



Spring è‡ªè¯ç”Ÿä»¥æ¥å¤‡å—é’çï¼Œä¸€ç›´è¢«å¹¿å¤§å¼€å‘äººå‘˜ä½œä¸º Java ä¼ä¸šçº§åº”ç”¨ç¨‹åºå¼€å‘çš„é¦–é€‰ã€‚æ—¶è‡³ä»Šæ—¥ï¼ŒSpring ä¿¨ç„¶æˆä¸ºäº† Java EE ä»£åè¯ï¼Œæˆä¸ºäº†æ„å»º Java EE åº”ç”¨çš„äº‹å®æ ‡å‡†ã€‚



è‡ª 2004 å¹´ 4 æœˆï¼ŒSpring 1.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒä»¥æ¥ï¼ŒSpring å·²ç»æ­¥å…¥åˆ°äº†ç¬¬ 6 ä¸ªå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ Spring 6ã€‚æœ¬è¯¾ç¨‹é‡‡ç”¨Springå½“å‰æœ€æ–°å‘å¸ƒçš„æ­£å¼ç‰ˆæœ¬**6.0.2**ã€‚



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221201102513199.png)



### 1.2ã€Spring çš„ç‹­ä¹‰å’Œå¹¿ä¹‰


åœ¨ä¸åŒçš„è¯­å¢ƒä¸­ï¼ŒSpring æ‰€ä»£è¡¨çš„å«ä¹‰æ˜¯ä¸åŒçš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±åˆ†åˆ«ä»â€œå¹¿ä¹‰â€å’Œâ€œç‹­ä¹‰â€ä¸¤ä¸ªè§’åº¦ï¼Œå¯¹ Spring è¿›è¡Œä»‹ç»ã€‚



**å¹¿ä¹‰çš„ Springï¼šSpring æŠ€æœ¯æ ˆ**



å¹¿ä¹‰ä¸Šçš„ Spring æ³›æŒ‡ä»¥ Spring Framework ä¸ºæ ¸å¿ƒçš„ Spring æŠ€æœ¯æ ˆã€‚



ç»è¿‡åå¤šå¹´çš„å‘å±•ï¼ŒSpring å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„åº”ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯é€æ¸å‘å±•æˆä¸ºä¸€ä¸ªç”±å¤šä¸ªä¸åŒå­é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰ç»„æˆçš„æˆç†ŸæŠ€æœ¯ï¼Œä¾‹å¦‚ Spring Frameworkã€Spring MVCã€SpringBootã€Spring Cloudã€Spring Dataã€Spring Security ç­‰ï¼Œå…¶ä¸­ Spring Framework æ˜¯å…¶ä»–å­é¡¹ç›®çš„åŸºç¡€ã€‚



è¿™äº›å­é¡¹ç›®æ¶µç›–äº†ä»ä¼ä¸šçº§åº”ç”¨å¼€å‘åˆ°äº‘è®¡ç®—ç­‰å„æ–¹é¢çš„å†…å®¹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è§£å†³è½¯ä»¶å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­äº§ç”Ÿçš„å„ç§å®é™…é—®é¢˜ï¼Œç»™å¼€å‘äººå‘˜å¸¦æ¥äº†æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚



**ç‹­ä¹‰çš„ Springï¼šSpring Framework**



ç‹­ä¹‰çš„ Spring ç‰¹æŒ‡ Spring Frameworkï¼Œé€šå¸¸æˆ‘ä»¬å°†å®ƒç§°ä¸º Spring æ¡†æ¶ã€‚



Spring æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ã€é¢å‘åˆ‡é¢çš„ Java åº”ç”¨ç¨‹åºçš„ä¸€ç«™å¼è½»é‡çº§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ Spring æŠ€æœ¯æ ˆçš„æ ¸å¿ƒå’ŒåŸºç¡€ï¼Œæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§åº”ç”¨å¼€å‘çš„å¤æ‚æ€§è€Œåˆ›å»ºçš„ã€‚



Spring æœ‰ä¸¤ä¸ªæœ€æ ¸å¿ƒæ¨¡å—ï¼š IoC å’Œ AOPã€‚



**IoC**ï¼šInverse of Control çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€ï¼ŒæŒ‡æŠŠåˆ›å»ºå¯¹è±¡è¿‡ç¨‹äº¤ç»™ Spring è¿›è¡Œç®¡ç†ã€‚



**AOP**ï¼šAspect Oriented Programming çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œé¢å‘åˆ‡é¢ç¼–ç¨‹â€ã€‚AOP ç”¨æ¥å°è£…å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºï¼Œå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘å°è£…èµ·æ¥ï¼Œå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ã€‚å¦å¤–ï¼ŒAOP è¿˜è§£å†³ä¸€äº›ç³»ç»Ÿå±‚é¢ä¸Šçš„é—®é¢˜ï¼Œæ¯”å¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™ç­‰ã€‚



### 1.3ã€Spring Frameworkç‰¹ç‚¹


+  **éä¾µå…¥å¼**ï¼šä½¿ç”¨ Spring Framework å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼ŒSpring å¯¹åº”ç”¨ç¨‹åºæœ¬èº«çš„ç»“æ„å½±å“éå¸¸å°ã€‚å¯¹é¢†åŸŸæ¨¡å‹å¯ä»¥åšåˆ°é›¶æ±¡æŸ“ï¼›å¯¹åŠŸèƒ½æ€§ç»„ä»¶ä¹Ÿåªéœ€è¦ä½¿ç”¨å‡ ä¸ªç®€å•çš„æ³¨è§£è¿›è¡Œæ ‡è®°ï¼Œå®Œå…¨ä¸ä¼šç ´ååŸæœ‰ç»“æ„ï¼Œåè€Œèƒ½å°†ç»„ä»¶ç»“æ„è¿›ä¸€æ­¥ç®€åŒ–ã€‚è¿™å°±ä½¿å¾—åŸºäº Spring Framework å¼€å‘åº”ç”¨ç¨‹åºæ—¶ç»“æ„æ¸…æ™°ã€ç®€æ´ä¼˜é›…ã€‚ 
+  **æ§åˆ¶åè½¬**ï¼šIoCâ€”â€”Inversion of Controlï¼Œç¿»è½¬èµ„æºè·å–æ–¹å‘ã€‚æŠŠè‡ªå·±åˆ›å»ºèµ„æºã€å‘ç¯å¢ƒç´¢å–èµ„æºå˜æˆç¯å¢ƒå°†èµ„æºå‡†å¤‡å¥½ï¼Œæˆ‘ä»¬äº«å—èµ„æºæ³¨å…¥ã€‚ 
+ **é¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼šAOPâ€”â€”Aspect Oriented Programmingï¼Œåœ¨ä¸ä¿®æ”¹æºä»£ç çš„åŸºç¡€ä¸Šå¢å¼ºä»£ç åŠŸèƒ½ã€‚ 
+  **å®¹å™¨**ï¼šSpring IoC æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå› ä¸ºå®ƒåŒ…å«å¹¶ä¸”ç®¡ç†ç»„ä»¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ç»„ä»¶äº«å—åˆ°äº†å®¹å™¨åŒ–çš„ç®¡ç†ï¼Œæ›¿ç¨‹åºå‘˜å±è”½äº†ç»„ä»¶åˆ›å»ºè¿‡ç¨‹ä¸­çš„å¤§é‡ç»†èŠ‚ï¼Œæå¤§çš„é™ä½äº†ä½¿ç”¨é—¨æ§›ï¼Œå¤§å¹…åº¦æé«˜äº†å¼€å‘æ•ˆç‡ã€‚ 
+  **ç»„ä»¶åŒ–**ï¼šSpring å®ç°äº†ä½¿ç”¨ç®€å•çš„ç»„ä»¶é…ç½®ç»„åˆæˆä¸€ä¸ªå¤æ‚çš„åº”ç”¨ã€‚åœ¨ Spring ä¸­å¯ä»¥ä½¿ç”¨ XML å’Œ Java æ³¨è§£ç»„åˆè¿™äº›å¯¹è±¡ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åŸºäºä¸€ä¸ªä¸ªåŠŸèƒ½æ˜ç¡®ã€è¾¹ç•Œæ¸…æ™°çš„ç»„ä»¶æœ‰æ¡ä¸ç´Šçš„æ­å»ºè¶…å¤§å‹å¤æ‚åº”ç”¨ç³»ç»Ÿã€‚ 
+  **ä¸€ç«™å¼**ï¼šåœ¨ IoC å’Œ AOP çš„åŸºç¡€ä¸Šå¯ä»¥æ•´åˆå„ç§ä¼ä¸šåº”ç”¨çš„å¼€æºæ¡†æ¶å’Œä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ç±»åº“ã€‚è€Œä¸” Spring æ——ä¸‹çš„é¡¹ç›®å·²ç»è¦†ç›–äº†å¹¿æ³›é¢†åŸŸï¼Œå¾ˆå¤šæ–¹é¢çš„åŠŸèƒ½æ€§éœ€æ±‚å¯ä»¥åœ¨ Spring Framework çš„åŸºç¡€ä¸Šå…¨éƒ¨ä½¿ç”¨ Spring æ¥å®ç°ã€‚ 



### 1.4ã€Springæ¨¡å—ç»„æˆ


å®˜ç½‘åœ°å€ï¼š[https://spring.io/](https://spring.io/)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207142746771.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/2097896352.png)



ä¸Šå›¾ä¸­åŒ…å«äº† Spring æ¡†æ¶çš„æ‰€æœ‰æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥æ»¡è¶³ä¸€åˆ‡ä¼ä¸šçº§åº”ç”¨å¼€å‘çš„éœ€æ±‚ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚æœ‰é€‰æ‹©æ€§åœ°ä½¿ç”¨æ‰€éœ€è¦çš„æ¨¡å—ã€‚ä¸‹é¢åˆ†åˆ«å¯¹è¿™äº›æ¨¡å—çš„ä½œç”¨è¿›è¡Œç®€å•ä»‹ç»ã€‚



**â‘ Spring Coreï¼ˆæ ¸å¿ƒå®¹å™¨ï¼‰**



spring coreæä¾›äº†IOC,DI,Beané…ç½®è£…è½½åˆ›å»ºçš„æ ¸å¿ƒå®ç°ã€‚æ ¸å¿ƒæ¦‚å¿µï¼š Beansã€BeanFactoryã€BeanDefinitionsã€ApplicationContextã€‚



+  spring-core ï¼šIOCå’ŒDIçš„åŸºæœ¬å®ç° 
+  spring-beansï¼šBeanFactoryå’ŒBeançš„è£…é…ç®¡ç†(BeanFactory) 
+  spring-contextï¼šSpring contextä¸Šä¸‹æ–‡ï¼Œå³IOCå®¹å™¨(AppliactionContext) 
+  spring-expressionï¼šspringè¡¨è¾¾å¼è¯­è¨€ 



**â‘¡Spring AOP**



+ spring-aopï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹çš„åº”ç”¨æ¨¡å—ï¼Œæ•´åˆASMï¼ŒCGLibï¼ŒJDK Proxy
+ spring-aspectsï¼šé›†æˆAspectJï¼ŒAOPåº”ç”¨æ¡†æ¶
+ spring-instrumentï¼šåŠ¨æ€Class Loadingæ¨¡å—



**â‘¢Spring Data Access**



+ spring-jdbcï¼šspringå¯¹JDBCçš„å°è£…ï¼Œç”¨äºç®€åŒ–jdbcæ“ä½œ
+ spring-ormï¼šjavaå¯¹è±¡ä¸æ•°æ®åº“æ•°æ®çš„æ˜ å°„æ¡†æ¶
+ spring-oxmï¼šå¯¹è±¡ä¸xmlæ–‡ä»¶çš„æ˜ å°„æ¡†æ¶
+ spring-jmsï¼š Springå¯¹Java Message Service(javaæ¶ˆæ¯æœåŠ¡)çš„å°è£…ï¼Œç”¨äºæœåŠ¡ä¹‹é—´ç›¸äº’é€šä¿¡
+ spring-txï¼šspring jdbcäº‹åŠ¡ç®¡ç†



**â‘£Spring Web**



+ spring-webï¼šæœ€åŸºç¡€çš„webæ”¯æŒï¼Œå»ºç«‹äºspring-contextä¹‹ä¸Šï¼Œé€šè¿‡servletæˆ–listeneræ¥åˆå§‹åŒ–IOCå®¹å™¨
+ spring-webmvcï¼šå®ç°web mvc
+ spring-websocketï¼šä¸å‰ç«¯çš„å…¨åŒå·¥é€šä¿¡åè®®
+ spring-webfluxï¼šSpring 5.0æä¾›çš„ï¼Œç”¨äºå–ä»£ä¼ ç»Ÿjava servletï¼Œéé˜»å¡å¼Reactive Webæ¡†æ¶ï¼Œå¼‚æ­¥ï¼Œéé˜»å¡ï¼Œäº‹ä»¶é©±åŠ¨çš„æœåŠ¡



**â‘¤Spring Message**



+ Spring-messagingï¼šspring 4.0æä¾›çš„ï¼Œä¸ºSpringé›†æˆä¸€äº›åŸºç¡€çš„æŠ¥æ–‡ä¼ é€æœåŠ¡



**â‘¥Spring test**



+ spring-testï¼šé›†æˆæµ‹è¯•æ”¯æŒï¼Œä¸»è¦æ˜¯å¯¹junitçš„å°è£…



### 1.5ã€Spring6ç‰¹ç‚¹


#### 1.5.1ã€ç‰ˆæœ¬è¦æ±‚


**ï¼ˆ1ï¼‰Spring6è¦æ±‚JDKæœ€ä½ç‰ˆæœ¬æ˜¯JDK17**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221201103138194.png)



#### 1.5.2ã€æœ¬è¯¾ç¨‹è½¯ä»¶ç‰ˆæœ¬


ï¼ˆ1ï¼‰IDEAå¼€å‘å·¥å…·ï¼š2022.1.2



ï¼ˆ2ï¼‰JDKï¼šJava17**ï¼ˆSpring6è¦æ±‚JDKæœ€ä½ç‰ˆæœ¬æ˜¯Java17ï¼‰**



ï¼ˆ3ï¼‰Springï¼š6.0.2



## 2ã€å…¥é—¨


### 2.1ã€ç¯å¢ƒè¦æ±‚


+  JDKï¼šJava17+**ï¼ˆSpring6è¦æ±‚JDKæœ€ä½ç‰ˆæœ¬æ˜¯Java17ï¼‰** 
+  Mavenï¼š3.6+ 
+  Springï¼š6.0.2 



### 2.2ã€æ„å»ºæ¨¡å—


**ï¼ˆ1ï¼‰æ„å»ºçˆ¶æ¨¡å—spring6**



åœ¨ideaä¸­ï¼Œä¾æ¬¡å•å‡» File -> New -> Project -> New Project



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221205201741893.png)



ç‚¹å‡»â€œCreateâ€



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221205202000198.png)



åˆ é™¤srcç›®å½•



**ï¼ˆ2ï¼‰æ„å»ºå­æ¨¡å—spring6-first**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221205202117383.png)



ç‚¹å‡» Create å®Œæˆ



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221205202154225.png)



### 2.3ã€ç¨‹åºå¼€å‘


#### 2.3.1ã€å¼•å…¥ä¾èµ–


[https://spring.io/projects/spring-framework#learn](https://spring.io/projects/spring-framework#learn)



**æ·»åŠ ä¾èµ–ï¼š**



```xml
<dependencies>
    <!--spring contextä¾èµ–-->
    <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>6.0.2</version>
    </dependency>

    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>
</dependencies>
```



**æŸ¥çœ‹ä¾èµ–ï¼š**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221201105416558.png)



#### 2.3.2ã€åˆ›å»ºjavaç±»


```java
package com.atguigu.spring6.bean;

public class HelloWorld {
    
    public void sayHello(){
        System.out.println("helloworld");
    }
}
```



#### 2.3.3ã€åˆ›å»ºé…ç½®æ–‡ä»¶


åœ¨resourcesç›®å½•åˆ›å»ºä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ beans.xmlï¼ˆé…ç½®æ–‡ä»¶åç§°å¯éšæ„å‘½åï¼Œå¦‚ï¼šsprings.xmï¼‰



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img007.png)



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!--
    é…ç½®HelloWorldæ‰€å¯¹åº”çš„beanï¼Œå³å°†HelloWorldçš„å¯¹è±¡äº¤ç»™Springçš„IOCå®¹å™¨ç®¡ç†
    é€šè¿‡beanæ ‡ç­¾é…ç½®IOCå®¹å™¨æ‰€ç®¡ç†çš„bean
    å±æ€§ï¼š
        idï¼šè®¾ç½®beançš„å”¯ä¸€æ ‡è¯†
        classï¼šè®¾ç½®beanæ‰€å¯¹åº”ç±»å‹çš„å…¨ç±»å
	-->
    <bean id="helloWorld" class="com.atguigu.spring6.bean.HelloWorld"></bean>
    
</beans>
```



#### 2.3.4ã€åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•


```java
package com.atguigu.spring6.bean;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class HelloWorldTest {

    @Test
    public void testHelloWorld(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
        HelloWorld helloworld = (HelloWorld) ac.getBean("helloWorld");
        helloworld.sayHello();
    }
}
```



#### 2.3.5ã€è¿è¡Œæµ‹è¯•ç¨‹åº


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221031172354535.png)



:::info
æ­¥éª¤ï¼š

1. å¼•å…¥Springç›¸å…³ä¾èµ–
2. åˆ›å»ºç±»ï¼Œå®šä¹‰å±æ€§å’Œæ–¹æ³•
3. æŒ‰ç…§Springè¦æ±‚åˆ›å»ºé…ç½®æ–‡ä»¶
4. åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ç›¸å…³ä¿¡æ¯
5. è¿›è¡Œæœ€ç»ˆæµ‹è¯•

:::

### 2.4ã€ç¨‹åºåˆ†æ


**1. åº•å±‚æ˜¯æ€ä¹ˆåˆ›å»ºå¯¹è±¡çš„ï¼Œæ˜¯é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨æ— å‚æ•°æ„é€ æ–¹æ³•å—ï¼Ÿ**



ä¿®æ”¹HelloWorldç±»ï¼š



```java
package com.atguigu.spring6.bean;

public class HelloWorld {

    public HelloWorld() {
        System.out.println("æ— å‚æ•°æ„é€ æ–¹æ³•æ‰§è¡Œ");
    }

    public void sayHello(){
        System.out.println("helloworld");
    }
}
```



æ‰§è¡Œç»“æœï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221031181430720.png)



**æµ‹è¯•å¾—çŸ¥ï¼šåˆ›å»ºå¯¹è±¡æ—¶ç¡®å®è°ƒç”¨äº†æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚**



**2. Springæ˜¯å¦‚ä½•åˆ›å»ºå¯¹è±¡çš„å‘¢ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**



```java
// dom4jè§£æbeans.xmlæ–‡ä»¶ï¼Œä»ä¸­è·å–classå±æ€§å€¼ï¼Œç±»çš„å…¨ç±»å
 // é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡
 Class clazz = Class.forName("com.atguigu.spring6.bean.HelloWorld");
 //Object obj = clazz.newInstance();
 Object object = clazz.getDeclaredConstructor().newInstance();
```



**3. æŠŠåˆ›å»ºå¥½çš„å¯¹è±¡å­˜å‚¨åˆ°ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å½“ä¸­äº†å‘¢ï¼Ÿ**



beanå¯¹è±¡æœ€ç»ˆå­˜å‚¨åœ¨springå®¹å™¨ä¸­ï¼Œåœ¨springæºç åº•å±‚å°±æ˜¯ä¸€ä¸ªmapé›†åˆï¼Œå­˜å‚¨beançš„mapåœ¨**DefaultListableBeanFactory**ç±»ä¸­ï¼š



```java
private final Map<String, BeanDefinition> beanDefinitionMap = new ConcurrentHashMap<>(256);
```



Springå®¹å™¨åŠ è½½åˆ°Beanç±»æ—¶ , ä¼šæŠŠè¿™ä¸ªç±»çš„æè¿°ä¿¡æ¯, ä»¥åŒ…ååŠ ç±»åçš„æ–¹å¼å­˜åˆ°beanDefinitionMap ä¸­,  
Map<String,BeanDefinition> , å…¶ä¸­ Stringæ˜¯Key , é»˜è®¤æ˜¯ç±»åé¦–å­—æ¯å°å†™ , BeanDefinition , å­˜çš„æ˜¯ç±»çš„å®šä¹‰(æè¿°ä¿¡æ¯) , æˆ‘ä»¬é€šå¸¸å«BeanDefinitionæ¥å£ä¸º : beançš„å®šä¹‰å¯¹è±¡ã€‚



### 2.5ã€å¯ç”¨Log4j2æ—¥å¿—æ¡†æ¶


#### 2.5.1ã€Log4j2æ—¥å¿—æ¦‚è¿°


åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæ—¥å¿—ååˆ†çš„é‡è¦ï¼Œä¸ç®¡æ˜¯è®°å½•è¿è¡Œæƒ…å†µè¿˜æ˜¯å®šä½çº¿ä¸Šé—®é¢˜ï¼Œéƒ½ç¦»ä¸å¼€å¯¹æ—¥å¿—çš„åˆ†æã€‚æ—¥å¿—è®°å½•äº†ç³»ç»Ÿè¡Œä¸ºçš„æ—¶é—´ã€åœ°ç‚¹ã€çŠ¶æ€ç­‰ç›¸å…³ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬äº†è§£å¹¶ç›‘æ§ç³»ç»ŸçŠ¶æ€ï¼Œåœ¨å‘ç”Ÿé”™è¯¯æˆ–è€…æ¥è¿‘æŸç§å±é™©çŠ¶æ€æ—¶èƒ½å¤ŸåŠæ—¶æé†’æˆ‘ä»¬å¤„ç†ï¼ŒåŒæ—¶åœ¨ç³»ç»Ÿäº§ç”Ÿé—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å®šä½ã€è¯Šæ–­å¹¶è§£å†³é—®é¢˜ã€‚



**Apache Log4j2**æ˜¯ä¸€ä¸ªå¼€æºçš„æ—¥å¿—è®°å½•ç»„ä»¶ï¼Œä½¿ç”¨éå¸¸çš„å¹¿æ³›ã€‚åœ¨å·¥ç¨‹ä¸­ä»¥æ˜“ç”¨æ–¹ä¾¿ä»£æ›¿äº† System.out ç­‰æ‰“å°è¯­å¥ï¼Œå®ƒæ˜¯JAVAä¸‹æœ€æµè¡Œçš„æ—¥å¿—è¾“å…¥å·¥å…·ã€‚



**Log4j2ä¸»è¦ç”±å‡ ä¸ªé‡è¦çš„ç»„ä»¶æ„æˆï¼š**



**ï¼ˆ1ï¼‰æ—¥å¿—ä¿¡æ¯çš„ä¼˜å…ˆçº§**ï¼Œæ—¥å¿—ä¿¡æ¯çš„ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æœ‰**TRACE < DEBUG < INFO < WARN < ERROR < FATAL**  
TRACEï¼šè¿½è¸ªï¼Œæ˜¯æœ€ä½çš„æ—¥å¿—çº§åˆ«ï¼Œç›¸å½“äºè¿½è¸ªç¨‹åºçš„æ‰§è¡Œ  
DEBUGï¼šè°ƒè¯•ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œéƒ½å°†å…¶è®¾ç½®ä¸ºæœ€ä½çš„æ—¥å¿—çº§åˆ«  
INFOï¼šä¿¡æ¯ï¼Œè¾“å‡ºé‡è¦çš„ä¿¡æ¯ï¼Œä½¿ç”¨è¾ƒå¤š  
WARNï¼šè­¦å‘Šï¼Œè¾“å‡ºè­¦å‘Šçš„ä¿¡æ¯  
ERRORï¼šé”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯  
FATALï¼šä¸¥é‡é”™è¯¯



è¿™äº›çº§åˆ«åˆ†åˆ«ç”¨æ¥æŒ‡å®šè¿™æ¡æ—¥å¿—ä¿¡æ¯çš„é‡è¦ç¨‹åº¦ï¼›çº§åˆ«é«˜çš„ä¼šè‡ªåŠ¨å±è”½çº§åˆ«ä½çš„æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾ç½®äº†WARNçš„æ—¥å¿—ï¼Œåˆ™INFOã€DEBUGçš„æ—¥å¿—çº§åˆ«çš„æ—¥å¿—ä¸ä¼šæ˜¾ç¤º



**ï¼ˆ2ï¼‰æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºç›®çš„åœ°**ï¼Œæ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºç›®çš„åœ°æŒ‡å®šäº†æ—¥å¿—å°†æ‰“å°åˆ°**æ§åˆ¶å°**è¿˜æ˜¯**æ–‡ä»¶ä¸­**ï¼›



**ï¼ˆ3ï¼‰æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºæ ¼å¼**ï¼Œè€Œè¾“å‡ºæ ¼å¼åˆ™æ§åˆ¶äº†æ—¥å¿—ä¿¡æ¯çš„æ˜¾ç¤ºå†…å®¹ã€‚



#### 2.5.2ã€å¼•å…¥Log4j2ä¾èµ–


```xml
<!--log4j2çš„ä¾èµ–-->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.19.0</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-slf4j2-impl</artifactId>
    <version>2.19.0</version>
</dependency>
```



#### 2.5.3ã€åŠ å…¥æ—¥å¿—é…ç½®æ–‡ä»¶


åœ¨ç±»çš„æ ¹è·¯å¾„ä¸‹æä¾›log4j2.xmlé…ç½®æ–‡ä»¶ï¼ˆæ–‡ä»¶åå›ºå®šä¸ºï¼šlog4j2.xmlï¼Œæ–‡ä»¶å¿…é¡»æ”¾åˆ°ç±»æ ¹è·¯å¾„ä¸‹ã€‚ï¼‰



```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <loggers>
        <!--
            levelæŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œä»ä½åˆ°é«˜çš„ä¼˜å…ˆçº§ï¼š
                TRACE < DEBUG < INFO < WARN < ERROR < FATAL
                traceï¼šè¿½è¸ªï¼Œæ˜¯æœ€ä½çš„æ—¥å¿—çº§åˆ«ï¼Œç›¸å½“äºè¿½è¸ªç¨‹åºçš„æ‰§è¡Œ
                debugï¼šè°ƒè¯•ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œéƒ½å°†å…¶è®¾ç½®ä¸ºæœ€ä½çš„æ—¥å¿—çº§åˆ«
                infoï¼šä¿¡æ¯ï¼Œè¾“å‡ºé‡è¦çš„ä¿¡æ¯ï¼Œä½¿ç”¨è¾ƒå¤š
                warnï¼šè­¦å‘Šï¼Œè¾“å‡ºè­¦å‘Šçš„ä¿¡æ¯
                errorï¼šé”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯
                fatalï¼šä¸¥é‡é”™è¯¯
        -->
        <root level="DEBUG">
            <appender-ref ref="spring6log"/>
            <appender-ref ref="RollingFile"/>
            <appender-ref ref="log"/>
        </root>
    </loggers>

    <appenders>
        <!--è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ§åˆ¶å°-->
        <console name="spring6log" target="SYSTEM_OUT">
            <!--æ§åˆ¶æ—¥å¿—è¾“å‡ºçš„æ ¼å¼-->
            <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss SSS} [%t] %-3level %logger{1024} - %msg%n"/>
        </console>

        <!--æ–‡ä»¶ä¼šæ‰“å°å‡ºæ‰€æœ‰ä¿¡æ¯ï¼Œè¿™ä¸ªlogæ¯æ¬¡è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ¸…ç©ºï¼Œç”±appendå±æ€§å†³å®šï¼Œé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨-->
        <File name="log" fileName="d:/spring6_log/test.log" append="false">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n"/>
        </File>

        <!-- è¿™ä¸ªä¼šæ‰“å°å‡ºæ‰€æœ‰çš„ä¿¡æ¯ï¼Œ
            æ¯æ¬¡å¤§å°è¶…è¿‡sizeï¼Œ
            åˆ™è¿™sizeå¤§å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å­˜å…¥æŒ‰å¹´ä»½-æœˆä»½å»ºç«‹çš„æ–‡ä»¶å¤¹ä¸‹é¢å¹¶è¿›è¡Œå‹ç¼©ï¼Œ
            ä½œä¸ºå­˜æ¡£-->
        <RollingFile name="RollingFile" fileName="d:/spring6_log/app.log"
                     filePattern="log/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="%d{yyyy-MM-dd 'at' HH:mm:ss z} %-5level %class{36} %L %M - %msg%xEx%n"/>
            <SizeBasedTriggeringPolicy size="50MB"/>
            <!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œ
            åˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œè®¾ç½®äº†20 -->
            <DefaultRolloverStrategy max="20"/>
        </RollingFile>
    </appenders>
</configuration>
```



#### 2.5.4ã€æµ‹è¯•


è¿è¡ŒåŸæµ‹è¯•ç¨‹åº



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221031214305224.png)



è¿è¡ŒåŸæµ‹è¯•ç¨‹åºï¼Œå¤šäº†springæ‰“å°æ—¥å¿—



#### 2.5.5ã€ä½¿ç”¨æ—¥å¿—


```java
public class HelloWorldTest {

    private Logger logger = LoggerFactory.getLogger(HelloWorldTest.class);

    @Test
    public void testHelloWorld(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
        HelloWorld helloworld = (HelloWorld) ac.getBean("helloWorld");
        helloworld.sayHello();
        logger.info("æ‰§è¡ŒæˆåŠŸ");
    }
}
```



æ§åˆ¶å°ï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221031214547501.png)



## 3ã€å®¹å™¨ï¼šIoC


IoC æ˜¯ Inversion of Control çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€ï¼Œå®ƒä¸æ˜¯ä¸€é—¨æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ˜¯ä¸€ä¸ªé‡è¦çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æ³•åˆ™ï¼Œèƒ½å¤ŸæŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•è®¾è®¡å‡ºæ¾è€¦åˆã€æ›´ä¼˜è‰¯çš„ç¨‹åºã€‚



Spring é€šè¿‡ **IoC å®¹å™¨**æ¥ç®¡ç†æ‰€æœ‰ **Java å¯¹è±¡çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–**ï¼Œæ§åˆ¶å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬å°†ç”± IoC å®¹å™¨ç®¡ç†çš„ Java å¯¹è±¡ç§°ä¸º Spring Beanï¼Œå®ƒä¸ä½¿ç”¨å…³é”®å­— new åˆ›å»ºçš„ Java å¯¹è±¡æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚



IoC å®¹å™¨æ˜¯ Spring æ¡†æ¶ä¸­æœ€é‡è¦çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒè´¯ç©¿äº† Spring ä»è¯ç”Ÿåˆ°æˆé•¿çš„æ•´ä¸ªè¿‡ç¨‹ã€‚

> IOCæ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸æ˜¯æŠ€æœ¯
>

### 3.1ã€IoC(<font style="color:rgb(25, 27, 31);">Inversion of Control</font>)å®¹å™¨


#### 3.1.1ã€æ§åˆ¶åè½¬ï¼ˆIoCï¼‰


+  æ§åˆ¶åè½¬æ˜¯ä¸€ç§**æ€æƒ³**ã€‚ 
+  æ§åˆ¶åè½¬æ˜¯ä¸ºäº†é™ä½ç¨‹åºè€¦åˆåº¦ï¼Œæé«˜ç¨‹åºæ‰©å±•åŠ›ã€‚ 
+  æ§åˆ¶åè½¬ï¼Œåè½¬çš„æ˜¯ä»€ä¹ˆï¼Ÿ 
+  
    - å°†å¯¹è±¡çš„åˆ›å»ºæƒåˆ©äº¤å‡ºå»ï¼Œäº¤ç»™ç¬¬ä¸‰æ–¹å®¹å™¨è´Ÿè´£ã€‚
    - å°†å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç»´æŠ¤æƒäº¤å‡ºå»ï¼Œäº¤ç»™ç¬¬ä¸‰æ–¹å®¹å™¨è´Ÿè´£ã€‚
+  æ§åˆ¶åè½¬è¿™ç§æ€æƒ³å¦‚ä½•å®ç°å‘¢ï¼Ÿ 
+  
    - DIï¼ˆDependency Injectionï¼‰ï¼šä¾èµ–æ³¨å…¥

![ç”»æ¿](https://cdn.nlark.com/yuque/0/2024/jpeg/36047305/1706335767152-97aa6e8e-93c8-4f3d-bea7-3b828e83df07.jpeg)

#### 3.1.2ã€ä¾èµ–æ³¨å…¥


DIï¼ˆDependency Injectionï¼‰ï¼šä¾èµ–æ³¨å…¥ï¼Œä¾èµ–æ³¨å…¥**å®ç°äº†æ§åˆ¶åè½¬çš„æ€æƒ³**ã€‚



**ä¾èµ–æ³¨å…¥ï¼š**



+ **æŒ‡Springåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œå°†****<font style="color:#DF2A3F;">å¯¹è±¡ä¾èµ–å±æ€§é€šè¿‡é…ç½®</font>****è¿›è¡Œæ³¨å…¥**



ä¾èµ–æ³¨å…¥å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ä¸¤ç§ï¼š



+ ç¬¬ä¸€ç§ï¼šsetæ³¨å…¥
+ ç¬¬äºŒç§ï¼šæ„é€ æ³¨å…¥



æ‰€ä»¥ç»“è®ºæ˜¯ï¼šIOC å°±æ˜¯ä¸€ç§æ§åˆ¶åè½¬çš„æ€æƒ³ï¼Œ è€Œ DI æ˜¯å¯¹IoCçš„ä¸€ç§å…·ä½“å®ç°ã€‚



**Beanç®¡ç†è¯´çš„æ˜¯ï¼šBeanå¯¹è±¡çš„åˆ›å»ºï¼Œä»¥åŠBeanå¯¹è±¡ä¸­å±æ€§çš„èµ‹å€¼ï¼ˆæˆ–è€…å«åšBeanå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç»´æŠ¤ï¼‰ã€‚**



#### 3.1.3ã€IoCå®¹å™¨åœ¨Springçš„å®ç°


Spring çš„ IoC å®¹å™¨å°±æ˜¯ IoCæ€æƒ³çš„ä¸€ä¸ªè½åœ°çš„äº§å“å®ç°ã€‚IoCå®¹å™¨ä¸­ç®¡ç†çš„ç»„ä»¶ä¹Ÿå«åš beanã€‚åœ¨åˆ›å»º bean ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºIoC å®¹å™¨ã€‚Spring æä¾›äº†IoC å®¹å™¨çš„ä¸¤ç§å®ç°æ–¹å¼ï¼š



**â‘ BeanFactory**



è¿™æ˜¯ IoC å®¹å™¨çš„åŸºæœ¬å®ç°ï¼Œæ˜¯ Spring å†…éƒ¨ä½¿ç”¨çš„æ¥å£ã€‚é¢å‘ Spring æœ¬èº«ï¼Œä¸æä¾›ç»™å¼€å‘äººå‘˜ä½¿ç”¨ã€‚



**â‘¡ApplicationContext**



BeanFactory çš„å­æ¥å£ï¼Œæä¾›äº†æ›´å¤šé«˜çº§ç‰¹æ€§ã€‚é¢å‘ Spring çš„ä½¿ç”¨è€…ï¼Œå‡ ä¹æ‰€æœ‰åœºåˆéƒ½ä½¿ç”¨ ApplicationContext è€Œä¸æ˜¯åº•å±‚çš„ BeanFactoryã€‚



**â‘¢ApplicationContextçš„ä¸»è¦å®ç°ç±»**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img005.png)

| ç±»å‹å | ç®€ä»‹ |
| --- | --- |
| ClassPathXmlApplicationContext | é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡ |
| FileSystemXmlApplicationContext | é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡ |
| ConfigurableApplicationContext | ApplicationContext çš„å­æ¥å£ï¼ŒåŒ…å«ä¸€äº›æ‰©å±•æ–¹æ³• refresh() å’Œ close() ï¼Œè®© ApplicationContext å…·æœ‰å¯åŠ¨ã€å…³é—­å’Œåˆ·æ–°ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚ |
| WebApplicationContext | ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚ |




### 3.2ã€åŸºäºXMLç®¡ç†Bean


#### 3.2.1ã€æ­å»ºå­æ¨¡å—spring6-ioc-xml


**â‘ æ­å»ºæ¨¡å—**



æ­å»ºæ–¹å¼å¦‚ï¼šspring-first



**â‘¡å¼•å…¥é…ç½®æ–‡ä»¶**



å¼•å…¥spring-firstæ¨¡å—é…ç½®æ–‡ä»¶ï¼šbeans.xmlã€log4j2.xml



**â‘¢æ·»åŠ ä¾èµ–**



```xml
<dependencies>
    <!--spring contextä¾èµ–-->
    <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>6.0.3</version>
    </dependency>

    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>

    <!--log4j2çš„ä¾èµ–-->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>2.19.0</version>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-slf4j2-impl</artifactId>
        <version>2.19.0</version>
    </dependency>
</dependencies>
```



**â‘£å¼•å…¥javaç±»**



å¼•å…¥spring-firstæ¨¡å—javaåŠtestç›®å½•ä¸‹å®ä½“ç±»



```java
package com.atguigu.spring6.bean;

public class HelloWorld {

    public HelloWorld() {
        System.out.println("æ— å‚æ•°æ„é€ æ–¹æ³•æ‰§è¡Œ");
    }

    public void sayHello(){
        System.out.println("helloworld");
    }
}
```



```java
package com.atguigu.spring6.bean;

import org.junit.jupiter.api.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class HelloWorldTest {

    private Logger logger = LoggerFactory.getLogger(HelloWorldTest.class);

    @Test
    public void testHelloWorld(){
        
    }
}
```



#### 3.2.2ã€å®éªŒä¸€ï¼šè·å–bean


##### â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–


ç”±äº id å±æ€§æŒ‡å®šäº† bean çš„å”¯ä¸€æ ‡è¯†ï¼Œæ‰€ä»¥æ ¹æ® bean æ ‡ç­¾çš„ id å±æ€§å¯ä»¥ç²¾ç¡®è·å–åˆ°ä¸€ä¸ªç»„ä»¶å¯¹è±¡ã€‚ä¸Šä¸ªå®éªŒä¸­æˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚



##### â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–


```java
@Test
public void testHelloWorld1(){
	ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
    HelloWorld bean = ac.getBean(HelloWorld.class);
    bean.sayHello();
}
```



##### â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹


```java
@Test
public void testHelloWorld2(){
	ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
    HelloWorld bean = ac.getBean("helloworld", HelloWorld.class);
    bean.sayHello();
}
```



##### â‘£æ³¨æ„çš„åœ°æ–¹


å½“æ ¹æ®ç±»å‹è·å–beanæ—¶ï¼Œè¦æ±‚IOCå®¹å™¨ä¸­æŒ‡å®šç±»å‹çš„beanæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª



å½“IOCå®¹å™¨ä¸­ä¸€å…±é…ç½®äº†ä¸¤ä¸ªï¼š



```xml
<bean id="helloworldOne" class="com.atguigu.spring6.bean.HelloWorld"></bean>
<bean id="helloworldTwo" class="com.atguigu.spring6.bean.HelloWorld"></bean>
```



æ ¹æ®ç±»å‹è·å–æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š



> org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'com.atguigu.spring6.bean.HelloWorld' available: expected single matching bean but found 2: helloworldOne,helloworldTwo
>



##### â‘¤æ‰©å±•çŸ¥è¯†
:::danger
å¦‚æœç»„ä»¶ç±»å®ç°äº†æ¥å£ï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å– bean å—ï¼Ÿ

:::

> å¯ä»¥ï¼Œå‰ææ˜¯beanå”¯ä¸€
>

:::danger
å¦‚æœä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œè¿™äº›å®ç°ç±»éƒ½é…ç½®äº† beanï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å– bean å—ï¼Ÿ

:::

> ä¸è¡Œï¼Œå› ä¸ºbeanä¸å”¯ä¸€
>



**ç»“è®º**



æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ **instanceof** æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œåªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚



javaä¸­ï¼Œinstanceofè¿ç®—ç¬¦ç”¨äºåˆ¤æ–­å‰é¢çš„å¯¹è±¡æ˜¯å¦æ˜¯åé¢çš„ç±»ï¼Œæˆ–å…¶å­ç±»ã€å®ç°ç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šç”¨instanceofå…³é”®å­—åšåˆ¤æ–­æ—¶ï¼Œ instanceof æ“ä½œç¬¦çš„å·¦å³æ“ä½œå¿…é¡»æœ‰ç»§æ‰¿æˆ–å®ç°å…³ç³»



#### 3.2.3ã€å®éªŒäºŒï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥


**â‘ åˆ›å»ºå­¦ç”Ÿç±»Student**



```java
package com.atguigu.spring6.bean;

public class Student {

    private Integer id;

    private String name;

    private Integer age;

    private String sex;

    public Student() {
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    @Override
    public String toString() {
        return "Student{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", age=" + age +
                ", sex='" + sex + '\'' +
                '}';
    }

}
```



**â‘¡é…ç½®beanæ—¶ä¸ºå±æ€§èµ‹å€¼**



spring-di.xml



```xml
<bean id="studentOne" class="com.atguigu.spring6.bean.Student">
    <!-- propertyæ ‡ç­¾ï¼šé€šè¿‡ç»„ä»¶ç±»çš„setXxx()æ–¹æ³•ç»™ç»„ä»¶å¯¹è±¡è®¾ç½®å±æ€§ -->
    <!-- nameå±æ€§ï¼šæŒ‡å®šå±æ€§åï¼ˆè¿™ä¸ªå±æ€§åæ˜¯getXxx()ã€setXxx()æ–¹æ³•å®šä¹‰çš„ï¼Œå’Œæˆå‘˜å˜é‡æ— å…³ï¼‰ -->
    <!-- valueå±æ€§ï¼šæŒ‡å®šå±æ€§å€¼ -->
    <property name="id" value="1001"></property>
    <property name="name" value="å¼ ä¸‰"></property>
    <property name="age" value="23"></property>
    <property name="sex" value="ç”·"></property>
</bean>
```



**â‘¢æµ‹è¯•**



```java
@Test
public void testDIBySet(){
    ApplicationContext ac = new ClassPathXmlApplicationContext("spring-di.xml");
    Student studentOne = ac.getBean("studentOne", Student.class);
    System.out.println(studentOne);
}
```

#### 3.2.4ã€å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥
**â‘ åœ¨Studentç±»ä¸­æ·»åŠ æœ‰å‚æ„é€ **

```java
public Student(Integer id, String name, Integer age, String sex) {
    this.id = id;
    this.name = name;
    this.age = age;
    this.sex = sex;
}
```

**â‘¡é…ç½®bean**

spring-di.xml

```xml
<bean id="studentTwo" class="com.atguigu.spring6.bean.Student">
    <constructor-arg value="1002"></constructor-arg>
    <constructor-arg value="æå››"></constructor-arg>
    <constructor-arg value="33"></constructor-arg>
    <constructor-arg value="å¥³"></constructor-arg>
</bean>
```

> æ³¨æ„ï¼š
>
> constructor-argæ ‡ç­¾è¿˜æœ‰ä¸¤ä¸ªå±æ€§å¯ä»¥è¿›ä¸€æ­¥æè¿°æ„é€ å™¨å‚æ•°ï¼š
>
> + indexå±æ€§ï¼šæŒ‡å®šå‚æ•°æ‰€åœ¨ä½ç½®çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
> + nameå±æ€§ï¼šæŒ‡å®šå‚æ•°å
>

**â‘¢æµ‹è¯•**

```java
@Test
public void testDIByConstructor(){
    ApplicationContext ac = new ClassPathXmlApplicationContext("spring-di.xml");
    Student studentOne = ac.getBean("studentTwo", Student.class);
    System.out.println(studentOne);
}
```

#### 3.2.5ã€å®éªŒå››ï¼šç‰¹æ®Šå€¼å¤„ç†
##### â‘ å­—é¢é‡èµ‹å€¼
> ä»€ä¹ˆæ˜¯å­—é¢é‡ï¼Ÿ
>
> int a = 10;
>
> å£°æ˜ä¸€ä¸ªå˜é‡aï¼Œåˆå§‹åŒ–ä¸º10ï¼Œæ­¤æ—¶aå°±ä¸ä»£è¡¨å­—æ¯aäº†ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå˜é‡çš„åå­—ã€‚å½“æˆ‘ä»¬å¼•ç”¨açš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‹¿åˆ°çš„å€¼æ˜¯10ã€‚
>
> è€Œå¦‚æœaæ˜¯å¸¦å¼•å·çš„ï¼š'a'ï¼Œé‚£ä¹ˆå®ƒç°åœ¨ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå°±æ˜¯ä»£è¡¨aè¿™ä¸ªå­—æ¯æœ¬èº«ï¼Œè¿™å°±æ˜¯å­—é¢é‡ã€‚æ‰€ä»¥å­—é¢é‡æ²¡æœ‰å¼•ç”³å«ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªæ•°æ®æœ¬èº«ã€‚
>



```xml
<!-- ä½¿ç”¨valueå±æ€§ç»™beançš„å±æ€§èµ‹å€¼æ—¶ï¼ŒSpringä¼šæŠŠvalueå±æ€§çš„å€¼çœ‹åšå­—é¢é‡ -->
<property name="name" value="å¼ ä¸‰"/>
```

##### â‘¡nullå€¼
```xml
<property name="name">
    <null />
</property>
```

> æ³¨æ„ï¼š
>
> ä»¥ä¸Šå†™æ³•ï¼Œä¸ºnameæ‰€èµ‹çš„å€¼æ˜¯å­—ç¬¦ä¸²null
>

```xml
<property name="name" value="null"></property>
```

##### â‘¢xmlå®ä½“
```xml
<!-- å°äºå·åœ¨XMLæ–‡æ¡£ä¸­ç”¨æ¥å®šä¹‰æ ‡ç­¾çš„å¼€å§‹ï¼Œä¸èƒ½éšä¾¿ä½¿ç”¨ -->
<!-- è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨XMLå®ä½“æ¥ä»£æ›¿ -->
<property name="expression" value="a &lt; b"/>
```

##### â‘£CDATAèŠ‚
```xml
<property name="expression">
    <!-- è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨CDATAèŠ‚ -->
    <!-- CDATAä¸­çš„Cä»£è¡¨Characterï¼Œæ˜¯æ–‡æœ¬ã€å­—ç¬¦çš„å«ä¹‰ï¼ŒCDATAå°±è¡¨ç¤ºçº¯æ–‡æœ¬æ•°æ® -->
    <!-- XMLè§£æå™¨çœ‹åˆ°CDATAèŠ‚å°±çŸ¥é“è¿™é‡Œæ˜¯çº¯æ–‡æœ¬ï¼Œå°±ä¸ä¼šå½“ä½œXMLæ ‡ç­¾æˆ–å±æ€§æ¥è§£æ -->
    <!-- æ‰€ä»¥CDATAèŠ‚ä¸­å†™ä»€ä¹ˆç¬¦å·éƒ½éšæ„ -->
    <value><![CDATA[a < b]]></value>
</property>
```

#### 3.2.6ã€å®éªŒäº”ï¼šä¸ºå¯¹è±¡ç±»å‹å±æ€§èµ‹å€¼
**â‘ åˆ›å»ºç­çº§ç±»Clazz**

```java
package com.atguigu.spring6.bean
    
public class Clazz {

    private Integer clazzId;

    private String clazzName;

    public Integer getClazzId() {
        return clazzId;
    }

    public void setClazzId(Integer clazzId) {
        this.clazzId = clazzId;
    }

    public String getClazzName() {
        return clazzName;
    }

    public void setClazzName(String clazzName) {
        this.clazzName = clazzName;
    }

    @Override
    public String toString() {
        return "Clazz{" +
                "clazzId=" + clazzId +
                ", clazzName='" + clazzName + '\'' +
                '}';
    }

    public Clazz() {
    }

    public Clazz(Integer clazzId, String clazzName) {
        this.clazzId = clazzId;
        this.clazzName = clazzName;
    }
}
```

**â‘¡ä¿®æ”¹Studentç±»**

åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```java
private Clazz clazz;

public Clazz getClazz() {
	return clazz;
}

public void setClazz(Clazz clazz) {
	this.clazz = clazz;
}
```

##### æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨bean
é…ç½®Clazzç±»å‹çš„beanï¼š

```xml
<bean id="clazzOne" class="com.atguigu.spring6.bean.Clazz">
    <property name="clazzId" value="1111"></property>
    <property name="clazzName" value="è´¢æºæ»šæ»šç­"></property>
</bean>
```

ä¸ºStudentä¸­çš„clazzå±æ€§èµ‹å€¼ï¼š

```xml
<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ -->
    <property name="clazz" ref="clazzOne"></property>
</bean>
```

é”™è¯¯æ¼”ç¤ºï¼š

```xml
<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <property name="clazz" value="clazzOne"></property>
</bean>
```

> å¦‚æœé”™æŠŠrefå±æ€§å†™æˆäº†valueå±æ€§ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š Caused by: java.lang.IllegalStateException: Cannot convert value of type 'java.lang.String' to required type 'com.atguigu.spring6.bean.Clazz' for property 'clazz': no matching editors or conversion strategy found
>
>  
>
> æ„æ€æ˜¯ä¸èƒ½æŠŠStringç±»å‹è½¬æ¢æˆæˆ‘ä»¬è¦çš„Clazzç±»å‹ï¼Œè¯´æ˜æˆ‘ä»¬ä½¿ç”¨valueå±æ€§æ—¶ï¼ŒSpringåªæŠŠè¿™ä¸ªå±æ€§çœ‹åšä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªbeançš„idï¼Œæ›´ä¸ä¼šæ ¹æ®å®ƒå»æ‰¾åˆ°beanæ¥èµ‹å€¼
>

##### æ–¹å¼äºŒï¼šå†…éƒ¨bean
```xml
<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <property name="clazz">
        <!-- åœ¨ä¸€ä¸ªbeanä¸­å†å£°æ˜ä¸€ä¸ªbeanå°±æ˜¯å†…éƒ¨bean -->
        <!-- å†…éƒ¨beanåªèƒ½ç”¨äºç»™å±æ€§èµ‹å€¼ï¼Œä¸èƒ½åœ¨å¤–éƒ¨é€šè¿‡IOCå®¹å™¨è·å–ï¼Œå› æ­¤å¯ä»¥çœç•¥idå±æ€§ -->
        <bean id="clazzInner" class="com.atguigu.spring6.bean.Clazz">
            <property name="clazzId" value="2222"></property>
            <property name="clazzName" value="è¿œå¤§å‰ç¨‹ç­"></property>
        </bean>
    </property>
</bean>
```

##### æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼
```xml
<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <property name="clazz" ref="clazzOne"></property>
    <property name="clazz.clazzId" value="3333"></property>
    <property name="clazz.clazzName" value="æœ€å¼ºç‹è€…ç­"></property>
</bean>
```

#### 3.2.7ã€å®éªŒå…­ï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼
**â‘ ä¿®æ”¹Studentç±»**

åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```java
private String[] hobbies;

public String[] getHobbies() {
    return hobbies;
}

public void setHobbies(String[] hobbies) {
    this.hobbies = hobbies;
}
```

**â‘¡é…ç½®bean**

```xml
<bean id="studentFour" class="com.atguigu.spring.bean6.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ -->
    <property name="clazz" ref="clazzOne"></property>
    <property name="hobbies">
        <array>
            <value>æŠ½çƒŸ</value>
            <value>å–é…’</value>
            <value>çƒ«å¤´</value>
        </array>
    </property>
</bean>
```

#### 3.2.8ã€å®éªŒä¸ƒï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼
##### â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼
åœ¨Clazzç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```java
private List<Student> students;

public List<Student> getStudents() {
    return students;
}

public void setStudents(List<Student> students) {
    this.students = students;
}
```

é…ç½®beanï¼š

```xml
<bean id="clazzTwo" class="com.atguigu.spring6.bean.Clazz">
    <property name="clazzId" value="4444"></property>
    <property name="clazzName" value="Javaee0222"></property>
    <property name="students">
        <list>
            <ref bean="studentOne"></ref>
            <ref bean="studentTwo"></ref>
            <ref bean="studentThree"></ref>
        </list>
    </property>
</bean>
```

> è‹¥ä¸ºSeté›†åˆç±»å‹å±æ€§èµ‹å€¼ï¼Œåªéœ€è¦å°†å…¶ä¸­çš„listæ ‡ç­¾æ”¹ä¸ºsetæ ‡ç­¾å³å¯
>

##### â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼
åˆ›å»ºæ•™å¸ˆç±»Teacherï¼š

```java
package com.atguigu.spring6.bean;
public class Teacher {

    private Integer teacherId;

    private String teacherName;

    public Integer getTeacherId() {
        return teacherId;
    }

    public void setTeacherId(Integer teacherId) {
        this.teacherId = teacherId;
    }

    public String getTeacherName() {
        return teacherName;
    }

    public void setTeacherName(String teacherName) {
        this.teacherName = teacherName;
    }

    public Teacher(Integer teacherId, String teacherName) {
        this.teacherId = teacherId;
        this.teacherName = teacherName;
    }

    public Teacher() {

    }
    
    @Override
    public String toString() {
        return "Teacher{" +
                "teacherId=" + teacherId +
                ", teacherName='" + teacherName + '\'' +
                '}';
    }
}
```

åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```java
private Map<String, Teacher> teacherMap;

public Map<String, Teacher> getTeacherMap() {
    return teacherMap;
}

public void setTeacherMap(Map<String, Teacher> teacherMap) {
    this.teacherMap = teacherMap;
}
```

é…ç½®beanï¼š

```xml
<bean id="teacherOne" class="com.atguigu.spring6.bean.Teacher">
    <property name="teacherId" value="10010"></property>
    <property name="teacherName" value="å¤§å®"></property>
</bean>

<bean id="teacherTwo" class="com.atguigu.spring6.bean.Teacher">
    <property name="teacherId" value="10086"></property>
    <property name="teacherName" value="äºŒå®"></property>
</bean>

<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ -->
    <property name="clazz" ref="clazzOne"></property>
    <property name="hobbies">
        <array>
            <value>æŠ½çƒŸ</value>
            <value>å–é…’</value>
            <value>çƒ«å¤´</value>
        </array>
    </property>
    <property name="teacherMap">
        <map>
            <entry>
                <key>
                    <value>10010</value>
                </key>
                <ref bean="teacherOne"></ref>
            </entry>
            <entry>
                <key>
                    <value>10086</value>
                </key>
                <ref bean="teacherTwo"></ref>
            </entry>
        </map>
    </property>
</bean>
```

##### â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean
```xml
<!--listé›†åˆç±»å‹çš„bean-->
<util:list id="students">
    <ref bean="studentOne"></ref>
    <ref bean="studentTwo"></ref>
    <ref bean="studentThree"></ref>
</util:list>
<!--mapé›†åˆç±»å‹çš„bean-->
<util:map id="teacherMap">
    <entry>
        <key>
            <value>10010</value>
        </key>
        <ref bean="teacherOne"></ref>
    </entry>
    <entry>
        <key>
            <value>10086</value>
        </key>
        <ref bean="teacherTwo"></ref>
    </entry>
</util:map>
<bean id="clazzTwo" class="com.atguigu.spring6.bean.Clazz">
    <property name="clazzId" value="4444"></property>
    <property name="clazzName" value="Javaee0222"></property>
    <property name="students" ref="students"></property>
</bean>
<bean id="studentFour" class="com.atguigu.spring6.bean.Student">
    <property name="id" value="1004"></property>
    <property name="name" value="èµµå…­"></property>
    <property name="age" value="26"></property>
    <property name="sex" value="å¥³"></property>
    <!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ -->
    <property name="clazz" ref="clazzOne"></property>
    <property name="hobbies">
        <array>
            <value>æŠ½çƒŸ</value>
            <value>å–é…’</value>
            <value>çƒ«å¤´</value>
        </array>
    </property>
    <property name="teacherMap" ref="teacherMap"></property>
</bean>
```

> ä½¿ç”¨util:listã€util:mapæ ‡ç­¾å¿…é¡»å¼•å…¥ç›¸åº”çš„å‘½åç©ºé—´
>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/util
       http://www.springframework.org/schema/util/spring-util.xsd
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd">
```



ä»¥ä¸Šéƒ½å¤ªç®€å•å•¦ï¼ï¼ï¼ğŸ˜ğŸ˜„ğŸ˜„ğŸ˜„





#### 3.2.9ã€å®éªŒå…«ï¼špå‘½åç©ºé—´
å¼•å…¥på‘½åç©ºé—´

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/util
       http://www.springframework.org/schema/util/spring-util.xsd
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd">
```

å¼•å…¥på‘½åç©ºé—´åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºbeançš„å„ä¸ªå±æ€§èµ‹å€¼

```xml
<bean id="studentSix" class="com.atguigu.spring6.bean.Student"
    p:id="1006" p:name="å°æ˜" p:clazz-ref="clazzOne" p:teacherMap-ref="teacherMap"></bean>
```



#### 3.2.10ã€å®éªŒä¹ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶


**â‘ åŠ å…¥ä¾èµ–**



```xml
 <!-- MySQLé©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.30</version>
</dependency>

<!-- æ•°æ®æº -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.2.15</version>
</dependency>
```



**â‘¡åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img010.png)



```properties
jdbc.user=root
jdbc.password=atguigu
jdbc.url=jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC
jdbc.driver=com.mysql.cj.jdbc.Driver
```



**â‘¢å¼•å…¥å±æ€§æ–‡ä»¶**



å¼•å…¥context åç§°ç©ºé—´



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd">

</beans>
```



```xml
<!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
<context:property-placeholder location="classpath:jdbc.properties"/>
```



æ³¨æ„ï¼šåœ¨ä½¿ç”¨ context:property-placeholder å…ƒç´ åŠ è½½å¤–åŒ…é…ç½®æ–‡ä»¶åŠŸèƒ½å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨ XML é…ç½®çš„ä¸€çº§æ ‡ç­¾ Â ä¸­æ·»åŠ  context ç›¸å…³çš„çº¦æŸã€‚



**â‘£é…ç½®bean**



```xml
<bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <property name="url" value="${jdbc.url}"/>
    <property name="driverClassName" value="${jdbc.driver}"/>
    <property name="username" value="${jdbc.user}"/>
    <property name="password" value="${jdbc.password}"/>
</bean>
```

**â‘¤æµ‹è¯•**

```java
@Test
public void testDataSource() throws SQLException {
    ApplicationContext ac = new ClassPathXmlApplicationContext("spring-datasource.xml");
    DataSource dataSource = ac.getBean(DataSource.class);
    Connection connection = dataSource.getConnection();
    System.out.println(connection);
}
```



#### 3.2.11ã€å®éªŒåï¼šbeançš„ä½œç”¨åŸŸ


**â‘ æ¦‚å¿µ**

åœ¨Springä¸­å¯ä»¥é€šè¿‡é…ç½®beanæ ‡ç­¾çš„scopeå±æ€§æ¥æŒ‡å®šbeançš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå„å–å€¼å«ä¹‰å‚åŠ ä¸‹è¡¨ï¼š

| å–å€¼ | å«ä¹‰ | åˆ›å»ºå¯¹è±¡çš„æ—¶æœº |
| --- | --- | --- |
| singletonï¼ˆé»˜è®¤ï¼‰ | åœ¨IOCå®¹å™¨ä¸­ï¼Œè¿™ä¸ªbeançš„å¯¹è±¡å§‹ç»ˆä¸ºå•å®ä¾‹ | IOCå®¹å™¨åˆå§‹åŒ–æ—¶ |
| prototype | è¿™ä¸ªbeanåœ¨IOCå®¹å™¨ä¸­æœ‰å¤šä¸ªå®ä¾‹ | è·å–beanæ—¶ |




å¦‚æœæ˜¯åœ¨WebApplicationContextç¯å¢ƒä¸‹è¿˜ä¼šæœ‰å¦å¤–å‡ ä¸ªä½œç”¨åŸŸï¼ˆä½†ä¸å¸¸ç”¨ï¼‰ï¼š

| å–å€¼ | å«ä¹‰ |
| --- | --- |
| request | åœ¨ä¸€ä¸ªè¯·æ±‚èŒƒå›´å†…æœ‰æ•ˆ |
| session | åœ¨ä¸€ä¸ªä¼šè¯èŒƒå›´å†…æœ‰æ•ˆ |




**â‘¡åˆ›å»ºç±»User**



```java
package com.atguigu.spring6.bean;
public class User {

    private Integer id;

    private String username;

    private String password;

    private Integer age;

    public User() {
    }

    public User(Integer id, String username, String password, Integer age) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.age = age;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", age=" + age +
                '}';
    }
}
```



**â‘¢é…ç½®bean**



```xml
<!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ -->
<!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ -->
<bean class="com.atguigu.spring6.bean.User" scope="prototype"></bean>
```



**â‘£æµ‹è¯•**



```java
@Test
public void testBeanScope(){
    ApplicationContext ac = new ClassPathXmlApplicationContext("spring-scope.xml");
    User user1 = ac.getBean(User.class);
    User user2 = ac.getBean(User.class);
    System.out.println(user1==user2);
}
```



#### 3.2.12ã€å®éªŒåä¸€ï¼šbeanç”Ÿå‘½å‘¨æœŸ


**â‘ å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹**



1. beanå¯¹è±¡åˆ›å»ºï¼ˆè°ƒç”¨æ— å‚æ„é€ å™¨ï¼‰ 
2. ç»™beanå¯¹è±¡è®¾ç½®å±æ€§ 
3. beançš„åç½®å¤„ç†å™¨ï¼ˆåˆå§‹åŒ–ä¹‹å‰ï¼‰ 
4. beanå¯¹è±¡åˆå§‹åŒ–ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼‰ 
5. beançš„åç½®å¤„ç†å™¨ï¼ˆåˆå§‹åŒ–ä¹‹åï¼‰ 
6. beanå¯¹è±¡å°±ç»ªå¯ä»¥ä½¿ç”¨ 
7. beanå¯¹è±¡é”€æ¯ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šé”€æ¯æ–¹æ³•ï¼‰
8. IOCå®¹å™¨å…³é—­ 



**â‘¡ä¿®æ”¹ç±»User**



```java
public class User {

    private Integer id;

    private String username;

    private String password;

    private Integer age;

    public User() {
        System.out.println("ç”Ÿå‘½å‘¨æœŸï¼š1ã€åˆ›å»ºå¯¹è±¡");
    }

    public User(Integer id, String username, String password, Integer age) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.age = age;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        System.out.println("ç”Ÿå‘½å‘¨æœŸï¼š2ã€ä¾èµ–æ³¨å…¥");
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public void initMethod(){
        System.out.println("ç”Ÿå‘½å‘¨æœŸï¼š3ã€åˆå§‹åŒ–");
    }

    public void destroyMethod(){
        System.out.println("ç”Ÿå‘½å‘¨æœŸï¼š5ã€é”€æ¯");
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", age=" + age +
                '}';
    }
}
```



> æ³¨æ„å…¶ä¸­çš„initMethod()å’ŒdestroyMethod()ï¼Œå¯ä»¥é€šè¿‡é…ç½®beanæŒ‡å®šä¸ºåˆå§‹åŒ–å’Œé”€æ¯çš„æ–¹æ³•
>



**â‘¢é…ç½®bean**



```xml
<!-- ä½¿ç”¨init-methodå±æ€§æŒ‡å®šåˆå§‹åŒ–æ–¹æ³• -->
<!-- ä½¿ç”¨destroy-methodå±æ€§æŒ‡å®šé”€æ¯æ–¹æ³• -->
<bean class="com.atguigu.spring6.bean.User" scope="prototype" init-method="initMethod" destroy-method="destroyMethod">
    <property name="id" value="1001"></property>
    <property name="username" value="admin"></property>
    <property name="password" value="123456"></property>
    <property name="age" value="23"></property>
</bean>
```



**â‘£æµ‹è¯•**



```java
@Test
public void testLife(){
    ClassPathXmlApplicationContext ac = new ClassPathXmlApplicationContext("spring-lifecycle.xml");
    User bean = ac.getBean(User.class);
    System.out.println("ç”Ÿå‘½å‘¨æœŸï¼š4ã€é€šè¿‡IOCå®¹å™¨è·å–beanå¹¶ä½¿ç”¨");
    ac.close();
}
```



**â‘¤beançš„åç½®å¤„ç†å™¨**



beançš„åç½®å¤„ç†å™¨ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–å‰åæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œéœ€è¦å®ç°BeanPostProcessoræ¥å£ï¼Œä¸”é…ç½®åˆ°IOCå®¹å™¨ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbeanåç½®å¤„ç†å™¨ä¸æ˜¯å•ç‹¬é’ˆå¯¹æŸä¸€ä¸ªbeanç”Ÿæ•ˆï¼Œè€Œæ˜¯é’ˆå¯¹IOCå®¹å™¨ä¸­æ‰€æœ‰beanéƒ½ä¼šæ‰§è¡Œ



åˆ›å»ºbeançš„åç½®å¤„ç†å™¨ï¼š



```java
package com.atguigu.spring6.process;
    
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;

public class MyBeanProcessor implements BeanPostProcessor {
    
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("â˜†â˜†â˜†" + beanName + " = " + bean);
        return bean;
    }
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("â˜…â˜…â˜…" + beanName + " = " + bean);
        return bean;
    }
}
```



åœ¨IOCå®¹å™¨ä¸­é…ç½®åç½®å¤„ç†å™¨ï¼š



```xml
<!-- beançš„åç½®å¤„ç†å™¨è¦æ”¾å…¥IOCå®¹å™¨æ‰èƒ½ç”Ÿæ•ˆ -->
<bean id="myBeanProcessor" class="com.atguigu.spring6.process.MyBeanProcessor"/>
```



#### 3.2.13ã€å®éªŒåäºŒï¼šFactoryBean


**â‘ ç®€ä»‹**



FactoryBeanæ˜¯Springæä¾›çš„ä¸€ç§æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶çš„å¸¸ç”¨æœºåˆ¶ã€‚å’Œæ™®é€šçš„beanä¸åŒï¼Œé…ç½®ä¸€ä¸ªFactoryBeanç±»å‹çš„beanï¼Œåœ¨è·å–beançš„æ—¶å€™å¾—åˆ°çš„å¹¶ä¸æ˜¯classå±æ€§ä¸­é…ç½®çš„è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯getObject()æ–¹æ³•çš„è¿”å›å€¼ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒSpringå¯ä»¥å¸®æˆ‘ä»¬æŠŠå¤æ‚ç»„ä»¶åˆ›å»ºçš„è¯¦ç»†è¿‡ç¨‹å’Œç¹çç»†èŠ‚éƒ½å±è”½èµ·æ¥ï¼ŒåªæŠŠæœ€ç®€æ´çš„ä½¿ç”¨ç•Œé¢å±•ç¤ºç»™æˆ‘ä»¬ã€‚



å°†æ¥æˆ‘ä»¬æ•´åˆMybatisæ—¶ï¼ŒSpringå°±æ˜¯é€šè¿‡FactoryBeanæœºåˆ¶æ¥å¸®æˆ‘ä»¬åˆ›å»ºSqlSessionFactoryå¯¹è±¡çš„ã€‚



```java
/*
 * Copyright 2002-2020 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.springframework.beans.factory;

import org.springframework.lang.Nullable;

/**
 * Interface to be implemented by objects used within a {@link BeanFactory} which
 * are themselves factories for individual objects. If a bean implements this
 * interface, it is used as a factory for an object to expose, not directly as a
 * bean instance that will be exposed itself.
 *
 * <p><b>NB: A bean that implements this interface cannot be used as a normal bean.</b>
 * A FactoryBean is defined in a bean style, but the object exposed for bean
 * references ({@link #getObject()}) is always the object that it creates.
 *
 * <p>FactoryBeans can support singletons and prototypes, and can either create
 * objects lazily on demand or eagerly on startup. The {@link SmartFactoryBean}
 * interface allows for exposing more fine-grained behavioral metadata.
 *
 * <p>This interface is heavily used within the framework itself, for example for
 * the AOP {@link org.springframework.aop.framework.ProxyFactoryBean} or the
 * {@link org.springframework.jndi.JndiObjectFactoryBean}. It can be used for
 * custom components as well; however, this is only common for infrastructure code.
 *
 * <p><b>{@code FactoryBean} is a programmatic contract. Implementations are not
 * supposed to rely on annotation-driven injection or other reflective facilities.</b>
 * {@link #getObjectType()} {@link #getObject()} invocations may arrive early in the
 * bootstrap process, even ahead of any post-processor setup. If you need access to
 * other beans, implement {@link BeanFactoryAware} and obtain them programmatically.
 *
 * <p><b>The container is only responsible for managing the lifecycle of the FactoryBean
 * instance, not the lifecycle of the objects created by the FactoryBean.</b> Therefore,
 * a destroy method on an exposed bean object (such as {@link java.io.Closeable#close()}
 * will <i>not</i> be called automatically. Instead, a FactoryBean should implement
 * {@link DisposableBean} and delegate any such close call to the underlying object.
 *
 * <p>Finally, FactoryBean objects participate in the containing BeanFactory's
 * synchronization of bean creation. There is usually no need for internal
 * synchronization other than for purposes of lazy initialization within the
 * FactoryBean itself (or the like).
 *
 * @author Rod Johnson
 * @author Juergen Hoeller
 * @since 08.03.2003
 * @param <T> the bean type
 * @see org.springframework.beans.factory.BeanFactory
 * @see org.springframework.aop.framework.ProxyFactoryBean
 * @see org.springframework.jndi.JndiObjectFactoryBean
 */
public interface FactoryBean<T> {

    /**
     * The name of an attribute that can be
     * {@link org.springframework.core.AttributeAccessor#setAttribute set} on a
     * {@link org.springframework.beans.factory.config.BeanDefinition} so that
     * factory beans can signal their object type when it can't be deduced from
     * the factory bean class.
     * @since 5.2
     */
    String OBJECT_TYPE_ATTRIBUTE = "factoryBeanObjectType";

    /**
     * Return an instance (possibly shared or independent) of the object
     * managed by this factory.
     * <p>As with a {@link BeanFactory}, this allows support for both the
     * Singleton and Prototype design pattern.
     * <p>If this FactoryBean is not fully initialized yet at the time of
     * the call (for example because it is involved in a circular reference),
     * throw a corresponding {@link FactoryBeanNotInitializedException}.
     * <p>As of Spring 2.0, FactoryBeans are allowed to return {@code null}
     * objects. The factory will consider this as normal value to be used; it
     * will not throw a FactoryBeanNotInitializedException in this case anymore.
     * FactoryBean implementations are encouraged to throw
     * FactoryBeanNotInitializedException themselves now, as appropriate.
     * @return an instance of the bean (can be {@code null})
     * @throws Exception in case of creation errors
     * @see FactoryBeanNotInitializedException
     */
    @Nullable
    T getObject() throws Exception;

    /**
     * Return the type of object that this FactoryBean creates,
     * or {@code null} if not known in advance.
     * <p>This allows one to check for specific types of beans without
     * instantiating objects, for example on autowiring.
     * <p>In the case of implementations that are creating a singleton object,
     * this method should try to avoid singleton creation as far as possible;
     * it should rather estimate the type in advance.
     * For prototypes, returning a meaningful type here is advisable too.
     * <p>This method can be called <i>before</i> this FactoryBean has
     * been fully initialized. It must not rely on state created during
     * initialization; of course, it can still use such state if available.
     * <p><b>NOTE:</b> Autowiring will simply ignore FactoryBeans that return
     * {@code null} here. Therefore it is highly recommended to implement
     * this method properly, using the current state of the FactoryBean.
     * @return the type of object that this FactoryBean creates,
     * or {@code null} if not known at the time of the call
     * @see ListableBeanFactory#getBeansOfType
     */
    @Nullable
    Class<?> getObjectType();

    /**
     * Is the object managed by this factory a singleton? That is,
     * will {@link #getObject()} always return the same object
     * (a reference that can be cached)?
     * <p><b>NOTE:</b> If a FactoryBean indicates to hold a singleton object,
     * the object returned from {@code getObject()} might get cached
     * by the owning BeanFactory. Hence, do not return {@code true}
     * unless the FactoryBean always exposes the same reference.
     * <p>The singleton status of the FactoryBean itself will generally
     * be provided by the owning BeanFactory; usually, it has to be
     * defined as singleton there.
     * <p><b>NOTE:</b> This method returning {@code false} does not
     * necessarily indicate that returned objects are independent instances.
     * An implementation of the extended {@link SmartFactoryBean} interface
     * may explicitly indicate independent instances through its
     * {@link SmartFactoryBean#isPrototype()} method. Plain {@link FactoryBean}
     * implementations which do not implement this extended interface are
     * simply assumed to always return independent instances if the
     * {@code isSingleton()} implementation returns {@code false}.
     * <p>The default implementation returns {@code true}, since a
     * {@code FactoryBean} typically manages a singleton instance.
     * @return whether the exposed object is a singleton
     * @see #getObject()
     * @see SmartFactoryBean#isPrototype()
     */
    default boolean isSingleton() {
        return true;
    }
}
```



**â‘¡åˆ›å»ºç±»UserFactoryBean**



```java
package com.atguigu.spring6.bean;
public class UserFactoryBean implements FactoryBean<User> {
    @Override
    public User getObject() throws Exception {
        return new User();
    }

    @Override
    public Class<?> getObjectType() {
        return User.class;
    }
}
```



**â‘¢é…ç½®bean**



```xml
<bean id="user" class="com.atguigu.spring6.bean.UserFactoryBean"></bean>
```



**â‘£æµ‹è¯•**



```java
@Test
public void testUserFactoryBean(){
    //è·å–IOCå®¹å™¨
    ApplicationContext ac = new ClassPathXmlApplicationContext("spring-factorybean.xml");
    User user = (User) ac.getBean("user");
    System.out.println(user);
}
```



#### 3.2.14ã€å®éªŒåä¸‰ï¼šåŸºäºxmlè‡ªåŠ¨è£…é…


> è‡ªåŠ¨è£…é…ï¼š
>
> æ ¹æ®æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨IOCå®¹å™¨ä¸­åŒ¹é…æŸä¸€ä¸ªbeanï¼Œè‡ªåŠ¨ä¸ºæŒ‡å®šçš„beanä¸­æ‰€ä¾èµ–çš„ç±»ç±»å‹æˆ–æ¥å£ç±»å‹å±æ€§èµ‹å€¼
>



**â‘ åœºæ™¯æ¨¡æ‹Ÿ**



åˆ›å»ºç±»UserController



```java
package com.atguigu.spring6.autowire.controller
public class UserController {

    private UserService userService;

    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    public void saveUser(){
        userService.saveUser();
    }

}
```



åˆ›å»ºæ¥å£UserService



```java
package com.atguigu.spring6.autowire.service
public interface UserService {

    void saveUser();

}
```



åˆ›å»ºç±»UserServiceImplå®ç°æ¥å£UserService



```java
package com.atguigu.spring6.autowire.service.impl
public class UserServiceImpl implements UserService {

    private UserDao userDao;

    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void saveUser() {
        userDao.saveUser();
    }

}
```



åˆ›å»ºæ¥å£UserDao



```java
package com.atguigu.spring6.autowire.dao
public interface UserDao {

    void saveUser();

}
```



åˆ›å»ºç±»UserDaoImplå®ç°æ¥å£UserDao



```java
package com.atguigu.spring6.autowire.dao.impl
public class UserDaoImpl implements UserDao {

    @Override
    public void saveUser() {
        System.out.println("ä¿å­˜æˆåŠŸ");
    }

}
```



**â‘¡é…ç½®bean**



> ä½¿ç”¨beanæ ‡ç­¾çš„autowireå±æ€§è®¾ç½®è‡ªåŠ¨è£…é…æ•ˆæœ
>
>  
>
> è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyType
>
>  
>
> byTypeï¼šæ ¹æ®ç±»å‹åŒ¹é…IOCå®¹å™¨ä¸­çš„æŸä¸ªå…¼å®¹ç±»å‹çš„beanï¼Œä¸ºå±æ€§è‡ªåŠ¨èµ‹å€¼
>
>  
>
> **è‹¥åœ¨IOCä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™è¯¥å±æ€§ä¸è£…é…ï¼Œå³å€¼ä¸ºé»˜è®¤å€¼null**
>
>  
>
> **è‹¥åœ¨IOCä¸­ï¼Œæœ‰å¤šä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸NoUniqueBeanDefinitionException**
>

****

```xml
<bean id="userController" class="com.atguigu.spring6.autowire.controller.UserController" autowire="byType"></bean>

<bean id="userService" class="com.atguigu.spring6.autowire.service.impl.UserServiceImpl" autowire="byType"></bean>

<bean id="userDao" class="com.atguigu.spring6.autowire.dao.impl.UserDaoImpl"></bean>
```



> è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyName
>
> byNameï¼šå°†è‡ªåŠ¨è£…é…çš„å±æ€§çš„å±æ€§åï¼Œä½œä¸ºbeançš„idåœ¨IOCå®¹å™¨ä¸­åŒ¹é…ç›¸å¯¹åº”çš„beanè¿›è¡Œèµ‹å€¼
>



```xml
<bean id="userController" class="com.atguigu.spring6.autowire.controller.UserController" autowire="byName"></bean>

<bean id="userService" class="com.atguigu.spring6.autowire.service.impl.UserServiceImpl" autowire="byName"></bean>
<bean id="userServiceImpl" class="com.atguigu.spring6.autowire.service.impl.UserServiceImpl" autowire="byName"></bean>

<bean id="userDao" class="com.atguigu.spring6.autowire.dao.impl.UserDaoImpl"></bean>
<bean id="userDaoImpl" class="com.atguigu.spring6.autowire.dao.impl.UserDaoImpl"></bean>
```



**â‘¢æµ‹è¯•**



```java
@Test
public void testAutoWireByXML(){
    ApplicationContext ac = new ClassPathXmlApplicationContext("autowire-xml.xml");
    UserController userController = ac.getBean(UserController.class);
    userController.saveUser();
}
```



### 3.3ã€åŸºäºæ³¨è§£ç®¡ç†Beanï¼ˆâ˜†ï¼‰


ä» Java 5 å¼€å§‹ï¼ŒJava å¢åŠ äº†å¯¹æ³¨è§£ï¼ˆAnnotationï¼‰çš„æ”¯æŒï¼Œå®ƒæ˜¯ä»£ç ä¸­çš„ä¸€ç§ç‰¹æ®Šæ ‡è®°ï¼Œå¯ä»¥åœ¨ç¼–è¯‘ã€ç±»åŠ è½½å’Œè¿è¡Œæ—¶è¢«è¯»å–ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ³¨è§£åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç å’Œé€»è¾‘çš„æƒ…å†µä¸‹ï¼Œåœ¨æºä»£ç ä¸­åµŒå…¥è¡¥å……ä¿¡æ¯ã€‚



Spring ä» 2.5 ç‰ˆæœ¬å¼€å§‹æä¾›äº†å¯¹æ³¨è§£æŠ€æœ¯çš„å…¨é¢æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®ç°è‡ªåŠ¨è£…é…ï¼Œç®€åŒ– Spring çš„ XML é…ç½®ã€‚



Spring é€šè¿‡æ³¨è§£å®ç°è‡ªåŠ¨è£…é…çš„æ­¥éª¤å¦‚ä¸‹ï¼š



1. å¼•å…¥ä¾èµ–
2. å¼€å¯ç»„ä»¶æ‰«æ
3. ä½¿ç”¨æ³¨è§£å®šä¹‰ Bean
4. ä¾èµ–æ³¨å…¥



#### 3.3.1ã€æ­å»ºå­æ¨¡å—spring6-ioc-annotation


**â‘ æ­å»ºæ¨¡å—**



æ­å»ºæ–¹å¼å¦‚ï¼šspring6-ioc-xml



**â‘¡å¼•å…¥é…ç½®æ–‡ä»¶**



å¼•å…¥spring-ioc-xmlæ¨¡å—æ—¥å¿—log4j2.xml



**â‘¢æ·»åŠ ä¾èµ–**



```xml
<dependencies>
    <!--spring contextä¾èµ–-->
    <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>6.0.3</version>
    </dependency>

    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
    </dependency>

    <!--log4j2çš„ä¾èµ–-->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>2.19.0</version>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-slf4j2-impl</artifactId>
        <version>2.19.0</version>
    </dependency>
</dependencies>
```



#### 3.3.2ã€å¼€å¯ç»„ä»¶æ‰«æ


Spring é»˜è®¤ä¸ä½¿ç”¨æ³¨è§£è£…é… Beanï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ Spring çš„ XML é…ç½®ä¸­ï¼Œé€šè¿‡ context:component-scan å…ƒç´ å¼€å¯ Spring Beansçš„è‡ªåŠ¨æ‰«æåŠŸèƒ½ã€‚å¼€å¯æ­¤åŠŸèƒ½åï¼ŒSpring ä¼šè‡ªåŠ¨ä»æ‰«ææŒ‡å®šçš„åŒ…ï¼ˆbase-package å±æ€§è®¾ç½®ï¼‰åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç±»ï¼Œå¦‚æœç±»ä¸Šä½¿ç”¨äº† [@Component ](/Component ) æ³¨è§£ï¼Œå°±å°†è¯¥ç±»è£…é…åˆ°å®¹å™¨ä¸­ã€‚ 



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd">
    <!--å¼€å¯ç»„ä»¶æ‰«æåŠŸèƒ½-->
    <context:component-scan base-package="com.atguigu.spring6"></context:component-scan>
</beans>
```



æ³¨æ„ï¼šåœ¨ä½¿ç”¨ context:component-scan å…ƒç´ å¼€å¯è‡ªåŠ¨æ‰«æåŠŸèƒ½å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨ XML é…ç½®çš„ä¸€çº§æ ‡ç­¾ Â ä¸­æ·»åŠ  context ç›¸å…³çš„çº¦æŸã€‚



**æƒ…å†µä¸€ï¼šæœ€åŸºæœ¬çš„æ‰«ææ–¹å¼**



```xml
<context:component-scan base-package="com.atguigu.spring6">
</context:component-scan>
```



**æƒ…å†µäºŒï¼šæŒ‡å®šè¦æ’é™¤çš„ç»„ä»¶**



```xml
<context:component-scan base-package="com.atguigu.spring6">
    <!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ -->
    <!-- 
 		typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®
		type="annotation"ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å
		type="assignable"ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å
	-->
    <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
        <!--<context:exclude-filter type="assignable" expression="com.atguigu.spring6.controller.UserController"/>-->
</context:component-scan>
```



**æƒ…å†µä¸‰ï¼šä»…æ‰«ææŒ‡å®šç»„ä»¶**



```xml
<context:component-scan base-package="com.atguigu" use-default-filters="false">
    <!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ -->
    <!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ -->
    <!-- æ­¤æ—¶å¿…é¡»è®¾ç½®use-default-filters="false"ï¼Œå› ä¸ºé»˜è®¤è§„åˆ™å³æ‰«ææŒ‡å®šåŒ…ä¸‹æ‰€æœ‰ç±» -->
    <!-- 
 		typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®
		type="annotation"ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å
		type="assignable"ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å
	-->
    <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
	<!--<context:include-filter type="assignable" expression="com.atguigu.spring6.controller.UserController"/>-->
</context:component-scan>
```



#### 3.3.3ã€ä½¿ç”¨æ³¨è§£å®šä¹‰ Bean


Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚

| æ³¨è§£ | è¯´æ˜ |
| --- | --- |
| [@Component ](/Component ) | è¯¥æ³¨è§£ç”¨äºæè¿° Spring ä¸­çš„ Beanï¼Œå®ƒæ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºå®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼ˆBeanï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½œç”¨åœ¨åº”ç”¨çš„ä»»ä½•å±‚æ¬¡ï¼Œä¾‹å¦‚ Service å±‚ã€Dao å±‚ç­‰ã€‚ Â ä½¿ç”¨æ—¶åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ç›¸åº”ç±»ä¸Šå³å¯ã€‚ |
| [@Repository ](/Repository ) | è¯¥æ³¨è§£ç”¨äºå°†æ•°æ®è®¿é—®å±‚ï¼ˆDao å±‚ï¼‰çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ [@Component ](/Component )<br/> ç›¸åŒã€‚  |
| [@Service ](/Service ) | è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨ä¸šåŠ¡å±‚ï¼ˆService å±‚ï¼‰ï¼Œç”¨äºå°†ä¸šåŠ¡å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ [@Component ](/Component )<br/> ç›¸åŒã€‚  |
| [@Controller ](/Controller ) | è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨æ§åˆ¶å±‚ï¼ˆå¦‚SpringMVC çš„ Controllerï¼‰ï¼Œç”¨äºå°†æ§åˆ¶å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ [@Component ](/Component )<br/> ç›¸åŒã€‚  |




#### 3.3.4ã€å®éªŒä¸€ï¼š@Autowiredæ³¨å…¥


å•ç‹¬ä½¿ç”¨@Autowiredæ³¨è§£ï¼Œ**é»˜è®¤æ ¹æ®ç±»å‹è£…é…**ã€‚ã€é»˜è®¤æ˜¯byTypeã€‘



æŸ¥çœ‹æºç ï¼š



```java
package org.springframework.beans.factory.annotation;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Autowired {
    boolean required() default true;
}
```



æºç ä¸­æœ‰ä¸¤å¤„éœ€è¦æ³¨æ„ï¼š



+  ç¬¬ä¸€å¤„ï¼šè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨å“ªé‡Œï¼Ÿ 
+  
    - æ„é€ æ–¹æ³•ä¸Š
    - æ–¹æ³•ä¸Š
    - å½¢å‚ä¸Š
    - å±æ€§ä¸Š
    - æ³¨è§£ä¸Š
+  ç¬¬äºŒå¤„ï¼šè¯¥æ³¨è§£æœ‰ä¸€ä¸ªrequiredå±æ€§ï¼Œé»˜è®¤å€¼æ˜¯trueï¼Œè¡¨ç¤ºåœ¨æ³¨å…¥çš„æ—¶å€™è¦æ±‚è¢«æ³¨å…¥çš„Beanå¿…é¡»æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ¥é”™ã€‚å¦‚æœrequiredå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ³¨å…¥çš„Beanå­˜åœ¨æˆ–è€…ä¸å­˜åœ¨éƒ½æ²¡å…³ç³»ï¼Œå­˜åœ¨çš„è¯å°±æ³¨å…¥ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œä¹Ÿä¸æŠ¥é”™ã€‚ 



##### â‘ åœºæ™¯ä¸€ï¼šå±æ€§æ³¨å…¥


åˆ›å»ºUserDaoæ¥å£



```java
package com.atguigu.spring6.dao;

public interface UserDao {

    public void print();
}
```



åˆ›å»ºUserDaoImplå®ç°



```java
package com.atguigu.spring6.dao.impl;

import com.atguigu.spring6.dao.UserDao;
import org.springframework.stereotype.Repository;

@Repository
public class UserDaoImpl implements UserDao {

    @Override
    public void print() {
        System.out.println("Daoå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



åˆ›å»ºUserServiceæ¥å£



```java
package com.atguigu.spring6.service;

public interface UserService {

    public void out();
}
```



åˆ›å»ºUserServiceImplå®ç°ç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserDao userDao;

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



åˆ›å»ºUserControllerç±»



```java
package com.atguigu.spring6.controller;

import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

@Controller
public class UserController {

    @Autowired
    private UserService userService;

    public void out() {
        userService.out();
        System.out.println("Controllerå±‚æ‰§è¡Œç»“æŸã€‚");
    }

}
```



**æµ‹è¯•ä¸€**



```java
package com.atguigu.spring6.bean;

import com.atguigu.spring6.controller.UserController;
import org.junit.jupiter.api.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class UserTest {

    private Logger logger = LoggerFactory.getLogger(UserTest.class);

    @Test
    public void testAnnotation(){
        ApplicationContext context = new ClassPathXmlApplicationContext("Beans.xml");
        UserController userController = context.getBean("userController", UserController.class);
        userController.out();
        logger.info("æ‰§è¡ŒæˆåŠŸ");
    }


}
```



æµ‹è¯•ç»“æœï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221101153556681.png)



ä»¥ä¸Šæ„é€ æ–¹æ³•å’Œsetteræ–¹æ³•éƒ½æ²¡æœ‰æä¾›ï¼Œç»è¿‡æµ‹è¯•ï¼Œä»ç„¶å¯ä»¥æ³¨å…¥æˆåŠŸã€‚



##### â‘¡åœºæ™¯äºŒï¼šsetæ³¨å…¥


ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    private UserDao userDao;

    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



ä¿®æ”¹UserControllerç±»



```java
package com.atguigu.spring6.controller;

import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

@Controller
public class UserController {

    private UserService userService;

    @Autowired
    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    public void out() {
        userService.out();
        System.out.println("Controllerå±‚æ‰§è¡Œç»“æŸã€‚");
    }

}
```



æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨



##### â‘¢åœºæ™¯ä¸‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥


ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    private UserDao userDao;

    @Autowired
    public UserServiceImpl(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



ä¿®æ”¹UserControllerç±»



```java
package com.atguigu.spring6.controller;

import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

@Controller
public class UserController {

    private UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    public void out() {
        userService.out();
        System.out.println("Controllerå±‚æ‰§è¡Œç»“æŸã€‚");
    }

}
```



æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨



##### â‘£åœºæ™¯å››ï¼šå½¢å‚ä¸Šæ³¨å…¥


ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    private UserDao userDao;

    public UserServiceImpl(@Autowired UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



ä¿®æ”¹UserControllerç±»



```java
package com.atguigu.spring6.controller;

import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

@Controller
public class UserController {

    private UserService userService;

    public UserController(@Autowired UserService userService) {
        this.userService = userService;
    }

    public void out() {
        userService.out();
        System.out.println("Controllerå±‚æ‰§è¡Œç»“æŸã€‚");
    }

}
```



æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨



##### â‘¤åœºæ™¯äº”ï¼šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ— æ³¨è§£


ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserDao userDao;

    public UserServiceImpl(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æµ‹è¯•é€šè¿‡



**å½“æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªæ—¶ï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚**



è¯´æ˜ï¼šæœ‰å¤šä¸ªæ„é€ æ–¹æ³•æ—¶å‘¢ï¼Ÿå¤§å®¶å¯ä»¥æµ‹è¯•ï¼ˆå†æ·»åŠ ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼‰ï¼Œæµ‹è¯•æŠ¥é”™



##### â‘¥åœºæ™¯å…­ï¼š@Autowiredæ³¨è§£å’Œ@Qualifieræ³¨è§£è”åˆ


æ·»åŠ daoå±‚å®ç°



```java
package com.atguigu.spring6.dao.impl;

import com.atguigu.spring6.dao.UserDao;
import org.springframework.stereotype.Repository;

@Repository
public class UserDaoRedisImpl implements UserDao {

    @Override
    public void print() {
        System.out.println("Redis Daoå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æµ‹è¯•ï¼šæµ‹è¯•å¼‚å¸¸



é”™è¯¯ä¿¡æ¯ä¸­è¯´ï¼šä¸èƒ½è£…é…ï¼ŒUserDaoè¿™ä¸ªBeançš„æ•°é‡ç­‰äº2



æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ**å½“ç„¶è¦byNameï¼Œæ ¹æ®åç§°è¿›è¡Œè£…é…äº†ã€‚**



ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    @Qualifier("userDaoImpl") // æŒ‡å®šbeançš„åå­—
    private UserDao userDao;

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



**æ€»ç»“**



+ @Autowiredæ³¨è§£å¯ä»¥å‡ºç°åœ¨ï¼šå±æ€§ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•çš„å‚æ•°ä¸Šã€setteræ–¹æ³•ä¸Šã€‚
+ å½“å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚ï¼ˆï¼‰
+ @Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹æ³¨å…¥ã€‚å¦‚æœè¦æ ¹æ®åç§°æ³¨å…¥çš„è¯ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚



#### 3.3.5ã€å®éªŒäºŒï¼š@Resourceæ³¨å…¥


@Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆå±æ€§æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ



+ @Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)
+ @Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚
+ **@Resourceæ³¨è§£é»˜è®¤æ ¹æ®åç§°è£…é…byNameï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹byTypeè£…é…ã€‚**
+ **@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…byTypeï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚**
+ @Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚
+ @Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚



@Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€**å¦‚æœæ˜¯JDK8çš„è¯ä¸éœ€è¦é¢å¤–å¼•å…¥ä¾èµ–ã€‚é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–ã€‚**ã€‘



```xml
<dependency>
    <groupId>jakarta.annotation</groupId>
    <artifactId>jakarta.annotation-api</artifactId>
    <version>2.1.1</version>
</dependency>
```



æºç ï¼š



```java
package jakarta.annotation;

import java.lang.annotation.ElementType;
import java.lang.annotation.Repeatable;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.TYPE, ElementType.FIELD, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Repeatable(Resources.class)
public @interface Resource {
    String name() default "";

    String lookup() default "";

    Class<?> type() default Object.class;

    Resource.AuthenticationType authenticationType() default Resource.AuthenticationType.CONTAINER;

    boolean shareable() default true;

    String mappedName() default "";

    String description() default "";

    public static enum AuthenticationType {
        CONTAINER,
        APPLICATION;

        private AuthenticationType() {
        }
    }
}
```



##### â‘ åœºæ™¯ä¸€ï¼šæ ¹æ®nameæ³¨å…¥


ä¿®æ”¹UserDaoImplç±»



```java
package com.atguigu.spring6.dao.impl;

import com.atguigu.spring6.dao.UserDao;
import org.springframework.stereotype.Repository;

@Repository("myUserDao")
public class UserDaoImpl implements UserDao {

    @Override
    public void print() {
        System.out.println("Daoå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import jakarta.annotation.Resource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Resource(name = "myUserDao")
    private UserDao myUserDao;

    @Override
    public void out() {
        myUserDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æµ‹è¯•é€šè¿‡



##### â‘¡åœºæ™¯äºŒï¼šnameæœªçŸ¥æ³¨å…¥


ä¿®æ”¹UserDaoImplç±»



```java
package com.atguigu.spring6.dao.impl;

import com.atguigu.spring6.dao.UserDao;
import org.springframework.stereotype.Repository;

@Repository("myUserDao")
public class UserDaoImpl implements UserDao {

    @Override
    public void print() {
        System.out.println("Daoå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



ä¿®æ”¹UserServiceImplç±»



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import jakarta.annotation.Resource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Resource
    private UserDao myUserDao;

    @Override
    public void out() {
        myUserDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æµ‹è¯•é€šè¿‡



å½“@Resourceæ³¨è§£ä½¿ç”¨æ—¶æ²¡æœ‰æŒ‡å®šnameçš„æ—¶å€™ï¼Œè¿˜æ˜¯æ ¹æ®nameè¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¸ªnameæ˜¯å±æ€§åã€‚



##### â‘¢åœºæ™¯ä¸‰ å…¶ä»–æƒ…å†µ


ä¿®æ”¹UserServiceImplç±»ï¼ŒuserDao1å±æ€§åä¸å­˜åœ¨



```java
package com.atguigu.spring6.service.impl;

import com.atguigu.spring6.dao.UserDao;
import com.atguigu.spring6.service.UserService;
import jakarta.annotation.Resource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Resource
    private UserDao userDao1;

    @Override
    public void out() {
        userDao1.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æµ‹è¯•å¼‚å¸¸



æ ¹æ®å¼‚å¸¸ä¿¡æ¯å¾—çŸ¥ï¼šæ˜¾ç„¶å½“é€šè¿‡nameæ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œè‡ªç„¶ä¼šå¯åŠ¨byTypeè¿›è¡Œæ³¨å…¥ï¼Œä»¥ä¸Šçš„é”™è¯¯æ˜¯å› ä¸ºUserDaoæ¥å£ä¸‹æœ‰ä¸¤ä¸ªå®ç°ç±»å¯¼è‡´çš„ã€‚æ‰€ä»¥æ ¹æ®ç±»å‹æ³¨å…¥å°±ä¼šæŠ¥é”™ã€‚



@Resourceçš„setæ³¨å…¥å¯ä»¥è‡ªè¡Œæµ‹è¯•



**æ€»ç»“ï¼š**



@Resourceæ³¨è§£ï¼šé»˜è®¤byNameæ³¨å…¥ï¼Œæ²¡æœ‰æŒ‡å®šnameæ—¶æŠŠå±æ€§åå½“åšnameï¼Œæ ¹æ®nameæ‰¾ä¸åˆ°æ—¶ï¼Œæ‰ä¼šbyTypeæ³¨å…¥ã€‚byTypeæ³¨å…¥æ—¶ï¼ŒæŸç§ç±»å‹çš„Beanåªèƒ½æœ‰ä¸€ä¸ª



#### 3.3.6ã€Springå…¨æ³¨è§£å¼€å‘


å…¨æ³¨è§£å¼€å‘å°±æ˜¯ä¸å†ä½¿ç”¨springé…ç½®æ–‡ä»¶äº†ï¼Œå†™ä¸€ä¸ªé…ç½®ç±»æ¥ä»£æ›¿é…ç½®æ–‡ä»¶ã€‚



```java
package com.atguigu.spring6.config;

import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@Configuration
//@ComponentScan({"com.atguigu.spring6.controller", "com.atguigu.spring6.service","com.atguigu.spring6.dao"})
@ComponentScan("com.atguigu.spring6")
public class Spring6Config {
}
```



æµ‹è¯•ç±»



```java
@Test
public void testAllAnnotation(){
    ApplicationContext context = new AnnotationConfigApplicationContext(Spring6Config.class);
    UserController userController = context.getBean("userController", UserController.class);
    userController.out();
    logger.info("æ‰§è¡ŒæˆåŠŸ");
}
```



## 4ã€åŸç†-æ‰‹å†™IoC


æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒSpringæ¡†æ¶çš„IOCæ˜¯åŸºäºJavaåå°„æœºåˆ¶å®ç°çš„ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹javaåå°„ã€‚



### 4.1ã€å›é¡¾Javaåå°„


`Java`åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º`Java`è¯­è¨€çš„åå°„æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œåå°„æœºåˆ¶æŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè·å–è‡ªèº«çš„ä¿¡æ¯ã€‚



è¦æƒ³è§£å‰–ä¸€ä¸ªç±»ï¼Œå¿…é¡»å…ˆè¦**è·å–åˆ°è¯¥ç±»çš„Classå¯¹è±¡**ã€‚è€Œå‰–æä¸€ä¸ªç±»æˆ–ç”¨åå°„è§£å†³å…·ä½“çš„é—®é¢˜å°±æ˜¯ä½¿ç”¨ç›¸å…³API**ï¼ˆ1ï¼‰java.lang.Classï¼ˆ2ï¼‰java.lang.reflect**ï¼Œæ‰€ä»¥ï¼Œ**Classå¯¹è±¡æ˜¯åå°„çš„æ ¹æº**ã€‚



**è‡ªå®šä¹‰ç±»**



```java
package com.atguigu.reflect;

public class Car {

    //å±æ€§
    private String name;
    private int age;
    private String color;

    //æ— å‚æ•°æ„é€ 
    public Car() {
    }

    //æœ‰å‚æ•°æ„é€ 
    public Car(String name, int age, String color) {
        this.name = name;
        this.age = age;
        this.color = color;
    }

    //æ™®é€šæ–¹æ³•
    private void run() {
        System.out.println("ç§æœ‰æ–¹æ³•-run.....");
    }

    //getå’Œsetæ–¹æ³•
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getColor() {
        return color;
    }
    public void setColor(String color) {
        this.color = color;
    }

    @Override
    public String toString() {
        return "Car{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", color='" + color + '\'' +
                '}';
    }
}
```



**ç¼–å†™æµ‹è¯•ç±»**



```java
package com.atguigu.reflect;

import org.junit.jupiter.api.Test;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class TestCar {

    //1ã€è·å–Classå¯¹è±¡å¤šç§æ–¹å¼
    @Test
    public void test01() throws Exception {
        //1 ç±»å.class
        Class clazz1 = Car.class;

        //2 å¯¹è±¡.getClass()
        Class clazz2 = new Car().getClass();

        //3 Class.forName("å…¨è·¯å¾„")
        Class clazz3 = Class.forName("com.atguigu.reflect.Car");

        //å®ä¾‹åŒ–
        Car car = (Car)clazz3.getConstructor().newInstance();
        System.out.println(car);
    }

    //2ã€è·å–æ„é€ æ–¹æ³•
    @Test
    public void test02() throws Exception {
        Class clazz = Car.class;
        //è·å–æ‰€æœ‰æ„é€ 
        // getConstructors()è·å–æ‰€æœ‰publicçš„æ„é€ æ–¹æ³•
//        Constructor[] constructors = clazz.getConstructors();
        // getDeclaredConstructors()è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•public  private
        Constructor[] constructors = clazz.getDeclaredConstructors();
        for (Constructor c:constructors) {
            System.out.println("æ–¹æ³•åç§°ï¼š"+c.getName()+" å‚æ•°ä¸ªæ•°ï¼š"+c.getParameterCount());
        }

        //æŒ‡å®šæœ‰å‚æ•°æ„é€ åˆ›å»ºå¯¹è±¡
        //1 æ„é€ public
//        Constructor c1 = clazz.getConstructor(String.class, int.class, String.class);
//        Car car1 = (Car)c1.newInstance("å¤åˆ©", 10, "çº¢è‰²");
//        System.out.println(car1);
        
        //2 æ„é€ private
        Constructor c2 = clazz.getDeclaredConstructor(String.class, int.class, String.class);
        c2.setAccessible(true);
        Car car2 = (Car)c2.newInstance("æ·è¾¾", 15, "ç™½è‰²");
        System.out.println(car2);
    }

    //3ã€è·å–å±æ€§
    @Test
    public void test03() throws Exception {
        Class clazz = Car.class;
        Car car = (Car)clazz.getDeclaredConstructor().newInstance();
        //è·å–æ‰€æœ‰publicå±æ€§
        //Field[] fields = clazz.getFields();
        //è·å–æ‰€æœ‰å±æ€§ï¼ˆåŒ…å«ç§æœ‰å±æ€§ï¼‰
        Field[] fields = clazz.getDeclaredFields();
        for (Field field:fields) {
            if(field.getName().equals("name")) {
                //è®¾ç½®å…è®¸è®¿é—®
                field.setAccessible(true);
                field.set(car,"äº”è±å®å…‰");
                System.out.println(car);
            }
            System.out.println(field.getName());
        }
    }

    //4ã€è·å–æ–¹æ³•
    @Test
    public void test04() throws Exception {
        Car car = new Car("å¥”é©°",10,"é»‘è‰²");
        Class clazz = car.getClass();
        //1 publicæ–¹æ³•
        Method[] methods = clazz.getMethods();
        for (Method m1:methods) {
            //System.out.println(m1.getName());
            //æ‰§è¡Œæ–¹æ³• toString
            if(m1.getName().equals("toString")) {
                String invoke = (String)m1.invoke(car);
                //System.out.println("toStringæ‰§è¡Œäº†ï¼š"+invoke);
            }
        }

        //2 privateæ–¹æ³•
        Method[] methodsAll = clazz.getDeclaredMethods();
        for (Method m:methodsAll) {
            //æ‰§è¡Œæ–¹æ³• run
            if(m.getName().equals("run")) {
                m.setAccessible(true);
                m.invoke(car);
            }
        }
    }
}
```



### 4.2ã€å®ç°Springçš„IoC


æˆ‘ä»¬çŸ¥é“ï¼ŒIoCï¼ˆæ§åˆ¶åè½¬ï¼‰å’ŒDIï¼ˆä¾èµ–æ³¨å…¥ï¼‰æ˜¯Springé‡Œé¢æ ¸å¿ƒçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è‡ªå·±æ‰‹å†™å‡ºè¿™æ ·çš„ä»£ç å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±ä¸€æ­¥ä¸€æ­¥å†™å‡ºSpringæ¡†æ¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚



**â‘ æ­å»ºå­æ¨¡å—**



æ­å»ºæ¨¡å—ï¼šguigu-springï¼Œæ­å»ºæ–¹å¼å¦‚å…¶ä»–springå­æ¨¡å—



**â‘¡å‡†å¤‡æµ‹è¯•éœ€è¦çš„bean**



æ·»åŠ ä¾èµ–



```xml
<dependencies>
    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>
</dependencies>
```



åˆ›å»ºUserDaoæ¥å£



```java
package com.atguigu.spring6.test.dao;

public interface UserDao {

    public void print();
}
```



åˆ›å»ºUserDaoImplå®ç°



```java
package com.atguigu.spring6.test.dao.impl;

import com.atguigu.spring.dao.UserDao;

public class UserDaoImpl implements UserDao {

    @Override
    public void print() {
        System.out.println("Daoå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



åˆ›å»ºUserServiceæ¥å£



```java
package com.atguigu.spring6.test.service;

public interface UserService {

    public void out();
}
```



åˆ›å»ºUserServiceImplå®ç°ç±»



```java
package com.atguigu.spring.test.service.impl;

import com.atguigu.spring.core.annotation.Bean;
import com.atguigu.spring.service.UserService;

@Bean
public class UserServiceImpl implements UserService {

//    private UserDao userDao;

    @Override
    public void out() {
        //userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



**â‘¢å®šä¹‰æ³¨è§£**



æˆ‘ä»¬é€šè¿‡æ³¨è§£çš„å½¢å¼åŠ è½½beanä¸å®ç°ä¾èµ–æ³¨å…¥



beanæ³¨è§£



```java
package com.atguigu.spring.core.annotation;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Bean {
}
```



ä¾èµ–æ³¨å…¥æ³¨è§£



```java
package com.atguigu.spring.core.annotation;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
public @interface Di {
}
```



è¯´æ˜ï¼šä¸Šé¢ä¸¤ä¸ªæ³¨è§£å¯ä»¥éšæ„å–å



**â‘£å®šä¹‰beanå®¹å™¨æ¥å£**



```java
package com.atguigu.spring.core;

public interface ApplicationContext {

    Object getBean(Class clazz);
}
```



**â‘¤ç¼–å†™æ³¨è§£beanå®¹å™¨æ¥å£å®ç°**



AnnotationApplicationContextåŸºäºæ³¨è§£æ‰«æbean



```java
package com.atguigu.spring.core;

import java.util.HashMap;

public class AnnotationApplicationContext implements ApplicationContext {

    //å­˜å‚¨beançš„å®¹å™¨
    private HashMap<Class, Object> beanFactory = new HashMap<>();

    @Override
    public Object getBean(Class clazz) {
        return beanFactory.get(clazz);
    }

    /**
     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean
     * @param basePackage
     */
    public AnnotationApplicationContext(String basePackage) {
        
    }
}
```



**â‘¥ç¼–å†™æ‰«æbeané€»è¾‘**



æˆ‘ä»¬é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥åŒ…çš„baseè·¯å¾„ï¼Œæ‰«æè¢«@Beanæ³¨è§£çš„javaå¯¹è±¡ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š



```java
package com.atguigu.spring.core;

import com.atguigu.spring.core.annotation.Bean;

import java.io.File;
import java.util.HashMap;

public class AnnotationApplicationContext implements ApplicationContext {

    //å­˜å‚¨beançš„å®¹å™¨
    private HashMap<Class, Object> beanFactory = new HashMap<>();
    private static String rootPath;

    @Override
    public Object getBean(Class clazz) {
        return beanFactory.get(clazz);
    }

    /**
     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean
     * @param basePackage
     */
    public AnnotationApplicationContext(String basePackage) {
       try {
            String packageDirName = basePackage.replaceAll("\\.", "\\\\");
            Enumeration<URL> dirs =Thread.currentThread().getContextClassLoader().getResources(packageDirName);
            while (dirs.hasMoreElements()) {
                URL url = dirs.nextElement();
                String filePath = URLDecoder.decode(url.getFile(),"utf-8");
                rootPath = filePath.substring(0, filePath.length()-packageDirName.length());
                loadBean(new File(filePath));
            }

        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    private  void loadBean(File fileParent) {
        if (fileParent.isDirectory()) {
            File[] childrenFiles = fileParent.listFiles();
            if(childrenFiles == null || childrenFiles.length == 0){
                return;
            }
            for (File child : childrenFiles) {
                if (child.isDirectory()) {
                    //å¦‚æœæ˜¯ä¸ªæ–‡ä»¶å¤¹å°±ç»§ç»­è°ƒç”¨è¯¥æ–¹æ³•,ä½¿ç”¨äº†é€’å½’
                    loadBean(child);
                } else {
                    //é€šè¿‡æ–‡ä»¶è·¯å¾„è½¬å˜æˆå…¨ç±»å,ç¬¬ä¸€æ­¥æŠŠç»å¯¹è·¯å¾„éƒ¨åˆ†å»æ‰
                    String pathWithClass = child.getAbsolutePath().substring(rootPath.length() - 1);
                    //é€‰ä¸­classæ–‡ä»¶
                    if (pathWithClass.contains(".class")) {
                        //    com.xinzhi.dao.UserDao
                        //å»æ‰.classåç¼€ï¼Œå¹¶ä¸”æŠŠ \ æ›¿æ¢æˆ .
                        String fullName = pathWithClass.replaceAll("\\\\", ".").replace(".class", "");
                        try {
                            Class<?> aClass = Class.forName(fullName);
                            //æŠŠéæ¥å£çš„ç±»å®ä¾‹åŒ–æ”¾åœ¨mapä¸­
                            if(!aClass.isInterface()){
                                Bean annotation = aClass.getAnnotation(Bean.class);
                                if(annotation != null){
                                    Object instance = aClass.newInstance();
                                    //åˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰æ¥å£
                                    if(aClass.getInterfaces().length > 0) {
                                        //å¦‚æœæœ‰æ¥å£æŠŠæ¥å£çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue
                                        System.out.println("æ­£åœ¨åŠ è½½ã€"+ aClass.getInterfaces()[0] +"ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š" + instance.getClass().getName());
                                        beanFactory.put(aClass.getInterfaces()[0], instance);
                                    }else{
                                        //å¦‚æœæœ‰æ¥å£æŠŠè‡ªå·±çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue
                                        System.out.println("æ­£åœ¨åŠ è½½ã€"+ aClass.getName() +"ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š" + instance.getClass().getName());
                                        beanFactory.put(aClass, instance);
                                    }
                                }
                            }
                        } catch (ClassNotFoundException | IllegalAccessException | InstantiationException e) {
                            e.printStackTrace();
                        }
                    }
                }
            }
        }
    }

}
```



**â‘¦javaç±»æ ‡è¯†Beanæ³¨è§£**



```java
@Bean
public class UserServiceImpl implements UserService
```



```java
@Bean
public class UserDaoImpl implements UserDao
```



**â‘§æµ‹è¯•BeanåŠ è½½**



```java
package com.atguigu.spring;

import com.atguigu.spring.core.AnnotationApplicationContext;
import com.atguigu.spring.core.ApplicationContext;
import com.atguigu.spring.test.service.UserService;
import org.junit.jupiter.api.Test;

public class SpringIocTest {

    @Test
    public void testIoc() {
        ApplicationContext applicationContext = new AnnotationApplicationContext("com.atguigu.spring.test");
        UserService userService = (UserService)applicationContext.getBean(UserService.class);
        userService.out();
        System.out.println("run success");
    }
}
```



æ§åˆ¶å°æ‰“å°æµ‹è¯•



**â‘¨ä¾èµ–æ³¨å…¥**



åªè¦userDao.print();è°ƒç”¨æˆåŠŸï¼Œè¯´æ˜å°±æ³¨å…¥æˆåŠŸ



```java
package com.atguigu.spring.test.service.impl;

import com.atguigu.spring.core.annotation.Bean;
import com.atguigu.spring.core.annotation.Di;
import com.atguigu.spring.dao.UserDao;
import com.atguigu.spring.service.UserService;

@Bean
public class UserServiceImpl implements UserService {

    @Di
    private UserDao userDao;

    @Override
    public void out() {
        userDao.print();
        System.out.println("Serviceå±‚æ‰§è¡Œç»“æŸ");
    }
}
```



æ‰§è¡Œç¬¬å…«æ­¥ï¼šæŠ¥é”™äº†ï¼Œè¯´æ˜å½“å‰userDaoæ˜¯ä¸ªç©ºå¯¹è±¡



**â‘©ä¾èµ–æ³¨å…¥å®ç°**



```java
package com.atguigu.spring.core;

import com.atguigu.spring.core.annotation.Bean;
import com.atguigu.spring.core.annotation.Di;

import java.io.File;
import java.lang.reflect.Field;
import java.util.HashMap;
import java.util.Map;

public class AnnotationApplicationContext implements ApplicationContext {

    //å­˜å‚¨beançš„å®¹å™¨
    private HashMap<Class, Object> beanFactory = new HashMap<>();
    private static String rootPath;

    @Override
    public Object getBean(Class clazz) {
        return beanFactory.get(clazz);
    }

    /**
     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean
     * @param basePackage
     */
    public AnnotationApplicationContext(String basePackage) {
        try {
            String packageDirName = basePackage.replaceAll("\\.", "\\\\");
            Enumeration<URL> dirs =Thread.currentThread().getContextClassLoader().getResources(packageDirName);
            while (dirs.hasMoreElements()) {
                URL url = dirs.nextElement();
                String filePath = URLDecoder.decode(url.getFile(),"utf-8");
                rootPath = filePath.substring(0, filePath.length()-packageDirName.length());
                loadBean(new File(filePath));
            }

        } catch (Exception e) {
            throw new RuntimeException(e);
        }
        
        //ä¾èµ–æ³¨å…¥
        loadDi();
    }
    
    private  void loadBean(File fileParent) {
        if (fileParent.isDirectory()) {
            File[] childrenFiles = fileParent.listFiles();
            if(childrenFiles == null || childrenFiles.length == 0){
                return;
            }
            for (File child : childrenFiles) {
                if (child.isDirectory()) {
                    //å¦‚æœæ˜¯ä¸ªæ–‡ä»¶å¤¹å°±ç»§ç»­è°ƒç”¨è¯¥æ–¹æ³•,ä½¿ç”¨äº†é€’å½’
                    loadBean(child);
                } else {
                    //é€šè¿‡æ–‡ä»¶è·¯å¾„è½¬å˜æˆå…¨ç±»å,ç¬¬ä¸€æ­¥æŠŠç»å¯¹è·¯å¾„éƒ¨åˆ†å»æ‰
                    String pathWithClass = child.getAbsolutePath().substring(rootPath.length() - 1);
                    //é€‰ä¸­classæ–‡ä»¶
                    if (pathWithClass.contains(".class")) {
                        //    com.xinzhi.dao.UserDao
                        //å»æ‰.classåç¼€ï¼Œå¹¶ä¸”æŠŠ \ æ›¿æ¢æˆ .
                        String fullName = pathWithClass.replaceAll("\\\\", ".").replace(".class", "");
                        try {
                            Class<?> aClass = Class.forName(fullName);
                            //æŠŠéæ¥å£çš„ç±»å®ä¾‹åŒ–æ”¾åœ¨mapä¸­
                            if(!aClass.isInterface()){
                                Bean annotation = aClass.getAnnotation(Bean.class);
                                if(annotation != null){
                                    Object instance = aClass.newInstance();
                                    //åˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰æ¥å£
                                    if(aClass.getInterfaces().length > 0) {
                                        //å¦‚æœæœ‰æ¥å£æŠŠæ¥å£çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue
                                        System.out.println("æ­£åœ¨åŠ è½½ã€"+ aClass.getInterfaces()[0] +"ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š" + instance.getClass().getName());
                                        beanFactory.put(aClass.getInterfaces()[0], instance);
                                    }else{
                                        //å¦‚æœæœ‰æ¥å£æŠŠè‡ªå·±çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue
                                        System.out.println("æ­£åœ¨åŠ è½½ã€"+ aClass.getName() +"ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š" + instance.getClass().getName());
                                        beanFactory.put(aClass, instance);
                                    }
                                }
                            }
                        } catch (ClassNotFoundException | IllegalAccessException | InstantiationException e) {
                            e.printStackTrace();
                        }
                    }
                }
            }
        }
    }

    private void loadDi() {
        for(Map.Entry<Class,Object> entry : beanFactory.entrySet()){
            //å°±æ˜¯å’±ä»¬æ”¾åœ¨å®¹å™¨çš„å¯¹è±¡
            Object obj = entry.getValue();
            Class<?> aClass = obj.getClass();
            Field[] declaredFields = aClass.getDeclaredFields();
            for (Field field : declaredFields){
                Di annotation = field.getAnnotation(Di.class);
                if( annotation != null ){
                    field.setAccessible(true);
                    try {
                        System.out.println("æ­£åœ¨ç»™ã€"+obj.getClass().getName()+"ã€‘å±æ€§ã€" + field.getName() + "ã€‘æ³¨å…¥å€¼ã€"+ beanFactory.get(field.getType()).getClass().getName() +"ã€‘");
                        field.set(obj,beanFactory.get(field.getType()));
                    } catch (IllegalAccessException e) {
                        e.printStackTrace();
                    }
                }
            }
        }
    }

}
```



æ‰§è¡Œç¬¬å…«æ­¥ï¼šæ‰§è¡ŒæˆåŠŸï¼Œä¾èµ–æ³¨å…¥æˆåŠŸ



## 5ã€é¢å‘åˆ‡é¢ï¼šAOP


### 5.1ã€åœºæ™¯æ¨¡æ‹Ÿ
**æ­å»ºå­æ¨¡å—ï¼šspring6-aop**

#### 5.1.1ã€å£°æ˜æ¥å£
å£°æ˜è®¡ç®—å™¨æ¥å£Calculatorï¼ŒåŒ…å«åŠ å‡ä¹˜é™¤çš„æŠ½è±¡æ–¹æ³•

```java
public interface Calculator {
    
    int add(int i, int j);
    
    int sub(int i, int j);
    
    int mul(int i, int j);
    
    int div(int i, int j);
    
}
```

#### 5.1.2ã€åˆ›å»ºå®ç°ç±»
![](https://cdn.jsdelivr.net/gh/czlifetime/img/img014.png)

```java
public class CalculatorImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
    
        int result = i + j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int sub(int i, int j) {
    
        int result = i - j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int mul(int i, int j) {
    
        int result = i * j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int div(int i, int j) {
    
        int result = i / j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
}
```

#### 5.1.3ã€åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»
![](https://cdn.jsdelivr.net/gh/czlifetime/img/img015.png)

```java
public class CalculatorLogImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
    
        System.out.println("[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š" + i + "," + j);
    
        int result = i + j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        System.out.println("[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š" + result);
    
        return result;
    }
    
    @Override
    public int sub(int i, int j) {
    
        System.out.println("[æ—¥å¿—] sub æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š" + i + "," + j);
    
        int result = i - j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        System.out.println("[æ—¥å¿—] sub æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š" + result);
    
        return result;
    }
    
    @Override
    public int mul(int i, int j) {
    
        System.out.println("[æ—¥å¿—] mul æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š" + i + "," + j);
    
        int result = i * j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        System.out.println("[æ—¥å¿—] mul æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š" + result);
    
        return result;
    }
    
    @Override
    public int div(int i, int j) {
    
        System.out.println("[æ—¥å¿—] div æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š" + i + "," + j);
    
        int result = i / j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        System.out.println("[æ—¥å¿—] div æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š" + result);
    
        return result;
    }
}
```

#### 5.1.4ã€æå‡ºé—®é¢˜


**â‘ ç°æœ‰ä»£ç ç¼ºé™·**



é’ˆå¯¹å¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»ï¼Œæˆ‘ä»¬å‘ç°æœ‰å¦‚ä¸‹ç¼ºé™·ï¼š



+ å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›
+ é™„åŠ åŠŸèƒ½åˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼Œä¸åˆ©äºç»Ÿä¸€ç»´æŠ¤



**â‘¡è§£å†³æ€è·¯**



è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚



**â‘¢å›°éš¾**



è§£å†³é—®é¢˜çš„å›°éš¾ï¼šè¦æŠ½å–çš„ä»£ç åœ¨æ–¹æ³•å†…éƒ¨ï¼Œé ä»¥å‰æŠŠå­ç±»ä¸­çš„é‡å¤ä»£ç æŠ½å–åˆ°çˆ¶ç±»çš„æ–¹å¼æ²¡æ³•è§£å†³ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥æ–°çš„æŠ€æœ¯ã€‚



### 5.2ã€ä»£ç†æ¨¡å¼


#### 5.2.1ã€æ¦‚å¿µ


**â‘ ä»‹ç»**



äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»**é—´æ¥**è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”**è§£è€¦**ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img016.png)



ä½¿ç”¨ä»£ç†åï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img017.png)



**â‘¡ç”Ÿæ´»ä¸­çš„ä»£ç†**



+ å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº
+ åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦
+ æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†



**â‘¢ç›¸å…³æœ¯è¯­**



+ ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚
+ ç›®æ ‡ï¼šè¢«ä»£ç†â€œå¥—ç”¨â€äº†éæ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚



#### 5.2.2ã€é™æ€ä»£ç†


åˆ›å»ºé™æ€ä»£ç†ç±»ï¼š



```java
public class CalculatorStaticProxy implements Calculator {
    
    // å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡
    private Calculator target;
    
    public CalculatorStaticProxy(Calculator target) {
        this.target = target;
    }
    
    @Override
    public int add(int i, int j) {
    
        // é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°
        System.out.println("[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š" + i + "," + j);
    
        // é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        int addResult = target.add(i, j);
    
        System.out.println("[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š" + addResult);
    
        return addResult;
    }
}
```



> é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½å†™æ­»äº†ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚
>
>  
>
> æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚
>



#### 5.2.3ã€åŠ¨æ€ä»£ç†


![](https://cdn.jsdelivr.net/gh/czlifetime/img/img018.png)



ç”Ÿäº§ä»£ç†å¯¹è±¡çš„å·¥å‚ç±»ï¼š



```java
public class ProxyFactory {

    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    public Object getProxy(){

        /**
         * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹
         * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
         * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨
         * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„
         * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•
         */
        ClassLoader classLoader = target.getClass().getClassLoader();
        Class<?>[] interfaces = target.getClass().getInterfaces();
        InvocationHandler invocationHandler = new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                /**
                 * proxyï¼šä»£ç†å¯¹è±¡
                 * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•
                 * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°
                 */
                Object result = null;
                try {
                    System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå‚æ•°ï¼š"+ Arrays.toString(args));
                    result = method.invoke(target, args);
                    System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œç»“æœï¼š"+ result);
                } catch (Exception e) {
                    e.printStackTrace();
                    System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå¼‚å¸¸ï¼š"+e.getMessage());
                } finally {
                    System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•");
                }
                return result;
            }
        };

        return Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);
    }
}
```



#### 5.2.4ã€æµ‹è¯•


```java
@Test
public void testDynamicProxy(){
    ProxyFactory factory = new ProxyFactory(new CalculatorLogImpl());
    Calculator proxy = (Calculator) factory.getProxy();
    proxy.div(1,0);
    //proxy.div(1,1);
}
```



### 5.3ã€AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­


#### 5.3.1ã€æ¦‚è¿°


AOPï¼ˆAspect Oriented Programmingï¼‰->**é¢å‘åˆ‡ç‰‡ç¼–ç¨‹**æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ˜¯è½¯ä»¶è®¾è®¡é¢†åŸŸä¸­çš„é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……å’Œå®Œå–„ï¼Œå®ƒä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†æ–¹å¼å®ç°ï¼Œåœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ é¢å¤–åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚



#### 5.3.2ã€ç›¸å…³æœ¯è¯­
##### â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹
åˆ†æ•£åœ¨æ¯ä¸ªå„ä¸ªæ¨¡å—ä¸­è§£å†³åŒä¸€æ ·çš„é—®é¢˜ï¼Œå¦‚ç”¨æˆ·éªŒè¯ã€æ—¥å¿—ç®¡ç†ã€äº‹åŠ¡å¤„ç†ã€æ•°æ®ç¼“å­˜éƒ½å±äºæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚



ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚



è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼šæœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img019.png)



##### â‘¡é€šçŸ¥ï¼ˆå¢å¼ºï¼‰
**å¢å¼ºï¼Œé€šä¿—è¯´ï¼Œå°±æ˜¯ä½ æƒ³è¦å¢å¼ºçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ å®‰å…¨ï¼Œäº‹åŠ¡ï¼Œæ—¥å¿—ç­‰ã€‚**

æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«é€šçŸ¥æ–¹æ³•ã€‚

+ å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**å‰**æ‰§è¡Œ
+ è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**æˆåŠŸç»“æŸ**åæ‰§è¡Œï¼ˆ**å¯¿ç»ˆæ­£å¯**ï¼‰
+ å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**å¼‚å¸¸ç»“æŸ**åæ‰§è¡Œï¼ˆ**æ­»äºéå‘½**ï¼‰
+ åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**æœ€ç»ˆç»“æŸ**åæ‰§è¡Œï¼ˆ**ç›–æ£ºå®šè®º**ï¼‰
+ ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•**æ•´ä¸ª**è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img020.png)

##### â‘¢åˆ‡é¢
å°è£…é€šçŸ¥æ–¹æ³•çš„ç±»ã€‚

![](https://cdn.jsdelivr.net/gh/czlifetime/img/img021.png)

##### â‘£ç›®æ ‡
è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚

##### â‘¤ä»£ç†
å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚

##### â‘¥è¿æ¥ç‚¹
è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚

æŠŠæ–¹æ³•æ’æˆä¸€æ’ï¼Œæ¯ä¸€ä¸ªæ¨ªåˆ‡ä½ç½®çœ‹æˆxè½´æ–¹å‘ï¼ŒæŠŠæ–¹æ³•ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„é¡ºåºçœ‹æˆyè½´ï¼Œxè½´å’Œyè½´çš„äº¤å‰ç‚¹å°±æ˜¯è¿æ¥ç‚¹ã€‚**é€šä¿—è¯´ï¼Œå°±æ˜¯springå…è®¸ä½ ä½¿ç”¨é€šçŸ¥çš„åœ°æ–¹**

![](https://cdn.jsdelivr.net/gh/czlifetime/img/img022.png)

##### â‘¦åˆ‡å…¥ç‚¹
å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ã€‚

æ¯ä¸ªç±»çš„æ–¹æ³•ä¸­éƒ½åŒ…å«å¤šä¸ªè¿æ¥ç‚¹ï¼Œæ‰€ä»¥è¿æ¥ç‚¹æ˜¯ç±»ä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©ï¼ˆä»é€»è¾‘ä¸Šæ¥è¯´ï¼‰ã€‚

å¦‚æœæŠŠè¿æ¥ç‚¹çœ‹ä½œæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé‚£ä¹ˆåˆ‡å…¥ç‚¹å°±æ˜¯æŸ¥è¯¢è®°å½•çš„ SQL è¯­å¥ã€‚

**Spring çš„ AOP æŠ€æœ¯å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹å®šä½åˆ°ç‰¹å®šçš„è¿æ¥ç‚¹ã€‚é€šä¿—è¯´ï¼Œè¦å®é™…å»å¢å¼ºçš„æ–¹æ³•**

åˆ‡ç‚¹é€šè¿‡ org.springframework.aop.Pointcut æ¥å£è¿›è¡Œæè¿°ï¼Œå®ƒä½¿ç”¨ç±»å’Œæ–¹æ³•ä½œä¸ºè¿æ¥ç‚¹çš„æŸ¥è¯¢æ¡ä»¶ã€‚

#### 5.3.3ã€ä½œç”¨
 

+  ç®€åŒ–ä»£ç ï¼šæŠŠæ–¹æ³•ä¸­å›ºå®šä½ç½®çš„é‡å¤çš„ä»£ç **æŠ½å–**å‡ºæ¥ï¼Œè®©è¢«æŠ½å–çš„æ–¹æ³•æ›´ä¸“æ³¨äºè‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæé«˜å†…èšæ€§ã€‚ 
+  ä»£ç å¢å¼ºï¼šæŠŠç‰¹å®šçš„åŠŸèƒ½å°è£…åˆ°åˆ‡é¢ç±»ä¸­ï¼Œçœ‹å“ªé‡Œæœ‰éœ€è¦ï¼Œå°±å¾€ä¸Šå¥—ï¼Œè¢«**å¥—ç”¨**äº†åˆ‡é¢é€»è¾‘çš„æ–¹æ³•å°±è¢«åˆ‡é¢ç»™å¢å¼ºäº†ã€‚ 



### 5.4ã€åŸºäºæ³¨è§£çš„AOP


#### 5.4.1ã€æŠ€æœ¯è¯´æ˜


![](https://cdn.jsdelivr.net/gh/czlifetime/img/img023.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221216132844066.png)



+ åŠ¨æ€ä»£ç†åˆ†ä¸ºJDKåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†
+ å½“ç›®æ ‡ç±»æœ‰æ¥å£çš„æƒ…å†µä½¿ç”¨JDKåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†ï¼Œæ²¡æœ‰æ¥å£æ—¶åªèƒ½ä½¿ç”¨cglibåŠ¨æ€ä»£ç†
+ JDKåŠ¨æ€ä»£ç†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¼šåœ¨com.sun.proxyåŒ…ä¸‹ï¼Œç±»åä¸º$proxy1ï¼Œå’Œç›®æ ‡ç±»å®ç°ç›¸åŒçš„æ¥å£
+ cglibåŠ¨æ€ä»£ç†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¼šå’Œç›®æ ‡åœ¨åœ¨ç›¸åŒçš„åŒ…ä¸‹ï¼Œä¼šç»§æ‰¿ç›®æ ‡ç±»
+ åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚**ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£**ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚
+ cglibï¼šé€šè¿‡**ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»**ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚
+ AspectJï¼šæ˜¯AOPæ€æƒ³çš„ä¸€ç§å®ç°ã€‚æœ¬è´¨ä¸Šæ˜¯é™æ€ä»£ç†ï¼Œ**å°†ä»£ç†é€»è¾‘â€œç»‡å…¥â€è¢«ä»£ç†çš„ç›®æ ‡ç±»ç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶**ï¼Œæ‰€ä»¥æœ€ç»ˆæ•ˆæœæ˜¯åŠ¨æ€çš„ã€‚weaverå°±æ˜¯ç»‡å…¥å™¨ã€‚Springåªæ˜¯å€Ÿç”¨äº†AspectJä¸­çš„æ³¨è§£ã€‚



#### 5.4.2ã€å‡†å¤‡å·¥ä½œ


**â‘ æ·»åŠ ä¾èµ–**



åœ¨IOCæ‰€éœ€ä¾èµ–åŸºç¡€ä¸Šå†åŠ å…¥ä¸‹é¢ä¾èµ–å³å¯ï¼š



```xml
<dependencies>
    <!--spring contextä¾èµ–-->
    <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>6.0.2</version>
    </dependency>

    <!--spring aopä¾èµ–-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aop</artifactId>
        <version>6.0.2</version>
    </dependency>
    <!--spring aspectsä¾èµ–-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aspects</artifactId>
        <version>6.0.2</version>
    </dependency>

    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>

    <!--log4j2çš„ä¾èµ–-->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>2.19.0</version>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-slf4j2-impl</artifactId>
        <version>2.19.0</version>
    </dependency>
</dependencies>
```



**â‘¡å‡†å¤‡è¢«ä»£ç†çš„ç›®æ ‡èµ„æº**



æ¥å£ï¼š



```java
public interface Calculator {
    
    int add(int i, int j);
    
    int sub(int i, int j);
    
    int mul(int i, int j);
    
    int div(int i, int j);
    
}
```



å®ç°ç±»ï¼š



```java
@Component
public class CalculatorImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
    
        int result = i + j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int sub(int i, int j) {
    
        int result = i - j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int mul(int i, int j) {
    
        int result = i * j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
    
    @Override
    public int div(int i, int j) {
    
        int result = i / j;
    
        System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
    
        return result;
    }
}
```



#### 5.4.3ã€åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®


```java
// @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
@Aspect
// @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨
@Component
public class LogAspect {
    
    @Before("execution(public int com.atguigu.aop.annotation.CalculatorImpl.*(..))")
    public void beforeMethod(JoinPoint joinPoint){
        String methodName = joinPoint.getSignature().getName();
        String args = Arrays.toString(joinPoint.getArgs());
        System.out.println("Logger-->å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå‚æ•°ï¼š"+args);
    }

    @After("execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))")
    public void afterMethod(JoinPoint joinPoint){
        String methodName = joinPoint.getSignature().getName();
        System.out.println("Logger-->åç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName);
    }

    @AfterReturning(value = "execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))", returning = "result")
    public void afterReturningMethod(JoinPoint joinPoint, Object result){
        String methodName = joinPoint.getSignature().getName();
        System.out.println("Logger-->è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œç»“æœï¼š"+result);
    }

    @AfterThrowing(value = "execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))", throwing = "ex")
    public void afterThrowingMethod(JoinPoint joinPoint, Throwable ex){
        String methodName = joinPoint.getSignature().getName();
        System.out.println("Logger-->å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå¼‚å¸¸ï¼š"+ex);
    }
    
    @Around("execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))")
    public Object aroundMethod(ProceedingJoinPoint joinPoint){
        String methodName = joinPoint.getSignature().getName();
        String args = Arrays.toString(joinPoint.getArgs());
        Object result = null;
        try {
            System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰");
            //ç›®æ ‡å¯¹è±¡ï¼ˆè¿æ¥ç‚¹ï¼‰æ–¹æ³•çš„æ‰§è¡Œ
            result = joinPoint.proceed();
            System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å");
        } catch (Throwable throwable) {
            throwable.printStackTrace();
            System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶");
        } finally {
            System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•");
        }
        return result;
    }
    
}
```



åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd">
    <!--
        åŸºäºæ³¨è§£çš„AOPçš„å®ç°ï¼š
        1ã€å°†ç›®æ ‡å¯¹è±¡å’Œåˆ‡é¢äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼ˆæ³¨è§£+æ‰«æï¼‰
        2ã€å¼€å¯AspectJçš„è‡ªåŠ¨ä»£ç†ï¼Œä¸ºç›®æ ‡å¯¹è±¡è‡ªåŠ¨ç”Ÿæˆä»£ç†
        3ã€å°†åˆ‡é¢ç±»é€šè¿‡æ³¨è§£@Aspectæ ‡è¯†
    -->
    <context:component-scan base-package="com.atguigu.aop.annotation"></context:component-scan>

    <aop:aspectj-autoproxy />
</beans>
```



æ‰§è¡Œæµ‹è¯•ï¼š



```java
public class CalculatorTest {

    private Logger logger = LoggerFactory.getLogger(CalculatorTest.class);

    @Test
    public void testAdd(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
        Calculator calculator = ac.getBean( Calculator.class);
        int add = calculator.add(1, 1);
        logger.info("æ‰§è¡ŒæˆåŠŸ:"+add);
    }

}
```



æ‰§è¡Œç»“æœï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221102155523983.png)



#### 5.4.4ã€å„ç§é€šçŸ¥


+ å‰ç½®é€šçŸ¥ï¼šä½¿ç”¨@Beforeæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**å‰**æ‰§è¡Œ
+ è¿”å›é€šçŸ¥ï¼šä½¿ç”¨@AfterReturningæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**æˆåŠŸç»“æŸ**åæ‰§è¡Œï¼ˆ**å¯¿ç»ˆæ­£å¯**ï¼‰
+ å¼‚å¸¸é€šçŸ¥ï¼šä½¿ç”¨@AfterThrowingæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**å¼‚å¸¸ç»“æŸ**åæ‰§è¡Œï¼ˆ**æ­»äºéå‘½**ï¼‰
+ åç½®é€šçŸ¥ï¼šä½¿ç”¨@Afteræ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•**æœ€ç»ˆç»“æŸ**åæ‰§è¡Œï¼ˆ**ç›–æ£ºå®šè®º**ï¼‰
+ ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨@Aroundæ³¨è§£æ ‡è¯†ï¼Œä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•**æ•´ä¸ª**è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®



> å„ç§é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š
>
>  
>
> + Springç‰ˆæœ¬5.3.xä»¥å‰ï¼š 
>     - å‰ç½®é€šçŸ¥
>     - ç›®æ ‡æ“ä½œ
>     - åç½®é€šçŸ¥
>     - è¿”å›é€šçŸ¥æˆ–å¼‚å¸¸é€šçŸ¥
>
>  
>
> + Springç‰ˆæœ¬5.3.xä»¥åï¼š 
>     - å‰ç½®é€šçŸ¥
>     - ç›®æ ‡æ“ä½œ
>     - è¿”å›é€šçŸ¥æˆ–å¼‚å¸¸é€šçŸ¥
>     - åç½®é€šçŸ¥
>
>  
>



#### 5.4.5ã€åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•


**â‘ ä½œç”¨**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img024.png)



**â‘¡è¯­æ³•ç»†èŠ‚**



+  ç”¨*å·ä»£æ›¿â€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€éƒ¨åˆ†è¡¨ç¤ºâ€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€ä¸é™ 
+  åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä¸€ä¸ªâ€œ*â€å·åªèƒ½ä»£è¡¨åŒ…çš„å±‚æ¬¡ç»“æ„ä¸­çš„ä¸€å±‚ï¼Œè¡¨ç¤ºè¿™ä¸€å±‚æ˜¯ä»»æ„çš„ã€‚ 
    - ä¾‹å¦‚ï¼š*.HelloåŒ¹é…com.Helloï¼Œä¸åŒ¹é…com.atguigu.Hello
+  åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä½¿ç”¨â€œ*..â€è¡¨ç¤ºåŒ…åä»»æ„ã€åŒ…çš„å±‚æ¬¡æ·±åº¦ä»»æ„ 
+  åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œç±»åéƒ¨åˆ†æ•´ä½“ç”¨*å·ä»£æ›¿ï¼Œè¡¨ç¤ºç±»åä»»æ„ 
+  åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ç±»åçš„ä¸€éƒ¨åˆ† 
    - ä¾‹å¦‚ï¼š*ServiceåŒ¹é…æ‰€æœ‰åç§°ä»¥Serviceç»“å°¾çš„ç±»æˆ–æ¥å£
+  åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·è¡¨ç¤ºæ–¹æ³•åä»»æ„ 
+  åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿æ–¹æ³•åçš„ä¸€éƒ¨åˆ† 
    - ä¾‹å¦‚ï¼š*OperationåŒ¹é…æ‰€æœ‰æ–¹æ³•åä»¥Operationç»“å°¾çš„æ–¹æ³•
+  åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»»æ„ 
+  åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(int,..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»¥ä¸€ä¸ªintç±»å‹çš„å‚æ•°å¼€å¤´ 
+  åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹åº”çš„åŒ…è£…ç±»å‹æ˜¯ä¸ä¸€æ ·çš„ 
    - åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨ int å’Œå®é™…æ–¹æ³•ä¸­ Integer æ˜¯ä¸åŒ¹é…çš„
+  åœ¨æ–¹æ³•è¿”å›å€¼éƒ¨åˆ†ï¼Œå¦‚æœæƒ³è¦æ˜ç¡®æŒ‡å®šä¸€ä¸ªè¿”å›å€¼ç±»å‹ï¼Œé‚£ä¹ˆå¿…é¡»åŒæ—¶å†™æ˜æƒé™ä¿®é¥°ç¬¦ 
    - ä¾‹å¦‚ï¼šexecution(public int _.._Service.*(.., int))	æ­£ç¡®  
ä¾‹å¦‚ï¼šexecution(_ int _.._Service._(.., int))	é”™è¯¯



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img025.png)



#### 5.4.6ã€é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼


**â‘ å£°æ˜**



```java
@Pointcut("execution(* com.atguigu.aop.annotation.*.*(..))")
public void pointCut(){}
```



**â‘¡åœ¨åŒä¸€ä¸ªåˆ‡é¢ä¸­ä½¿ç”¨**



```java
@Before("pointCut()")
public void beforeMethod(JoinPoint joinPoint){
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println("Logger-->å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå‚æ•°ï¼š"+args);
}
```



**â‘¢åœ¨ä¸åŒåˆ‡é¢ä¸­ä½¿ç”¨**



```java
@Before("com.atguigu.aop.CommonPointCut.pointCut()")
public void beforeMethod(JoinPoint joinPoint){
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println("Logger-->å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå‚æ•°ï¼š"+args);
}
```



#### 5.4.7ã€è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯


**â‘ è·å–è¿æ¥ç‚¹ä¿¡æ¯**



è·å–è¿æ¥ç‚¹ä¿¡æ¯å¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•çš„å‚æ•°ä½ç½®è®¾ç½®JoinPointç±»å‹çš„å½¢å‚



```java
@Before("execution(public int com.atguigu.aop.annotation.CalculatorImpl.*(..))")
public void beforeMethod(JoinPoint joinPoint){
    //è·å–è¿æ¥ç‚¹çš„ç­¾åä¿¡æ¯
    String methodName = joinPoint.getSignature().getName();
    //è·å–ç›®æ ‡æ–¹æ³•åˆ°çš„å®å‚ä¿¡æ¯
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println("Logger-->å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå‚æ•°ï¼š"+args);
}
```



**â‘¡è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼**



@AfterReturningä¸­çš„å±æ€§returningï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼



```java
@AfterReturning(value = "execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))", returning = "result")
public void afterReturningMethod(JoinPoint joinPoint, Object result){
    String methodName = joinPoint.getSignature().getName();
    System.out.println("Logger-->è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œç»“æœï¼š"+result);
}
```



**â‘¢è·å–ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸**



@AfterThrowingä¸­çš„å±æ€§throwingï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸



```java
@AfterThrowing(value = "execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))", throwing = "ex")
public void afterThrowingMethod(JoinPoint joinPoint, Throwable ex){
    String methodName = joinPoint.getSignature().getName();
    System.out.println("Logger-->å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š"+methodName+"ï¼Œå¼‚å¸¸ï¼š"+ex);
}
```



#### 5.4.8ã€ç¯ç»•é€šçŸ¥


```java
@Around("execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))")
public Object aroundMethod(ProceedingJoinPoint joinPoint){
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    Object result = null;
    try {
        System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰");
        //ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šè¦è¿”å›ç»™å¤–ç•Œè°ƒç”¨è€…
        result = joinPoint.proceed();
        System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å");
    } catch (Throwable throwable) {
        throwable.printStackTrace();
        System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶");
    } finally {
        System.out.println("ç¯ç»•é€šçŸ¥-->ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•");
    }
    return result;
}
```



#### 5.4.9ã€åˆ‡é¢çš„ä¼˜å…ˆçº§


ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶åˆ‡é¢çš„**å†…å¤–åµŒå¥—**é¡ºåºã€‚



+ ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢
+ ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢



ä½¿ç”¨@Orderæ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š



+ @Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜
+ @Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½



![](https://cdn.jsdelivr.net/gh/czlifetime/img/img026.png)



### 5.5ã€åŸºäºXMLçš„AOP


#### 5.5.1ã€å‡†å¤‡å·¥ä½œ


å‚è€ƒåŸºäºæ³¨è§£çš„AOPç¯å¢ƒ



#### 5.5.2ã€å®ç°


```xml
<context:component-scan base-package="com.atguigu.aop.xml"></context:component-scan>

<aop:config>
    <!--é…ç½®åˆ‡é¢ç±»-->
    <aop:aspect ref="loggerAspect">
        <aop:pointcut id="pointCut" 
                   expression="execution(* com.atguigu.aop.xml.CalculatorImpl.*(..))"/>
        <aop:before method="beforeMethod" pointcut-ref="pointCut"></aop:before>
        <aop:after method="afterMethod" pointcut-ref="pointCut"></aop:after>
        <aop:after-returning method="afterReturningMethod" returning="result" pointcut-ref="pointCut"></aop:after-returning>
        <aop:after-throwing method="afterThrowingMethod" throwing="ex" pointcut-ref="pointCut"></aop:after-throwing>
        <aop:around method="aroundMethod" pointcut-ref="pointCut"></aop:around>
    </aop:aspect>
</aop:config>
```



## 6ã€å•å…ƒæµ‹è¯•ï¼šJUnit


åœ¨ä¹‹å‰çš„æµ‹è¯•æ–¹æ³•ä¸­ï¼Œå‡ ä¹éƒ½èƒ½çœ‹åˆ°ä»¥ä¸‹çš„ä¸¤è¡Œä»£ç ï¼š



```java
ApplicationContext context = new ClassPathXmlApplicationContext("xxx.xml");
Xxxx xxx = context.getBean(Xxxx.class);
```



è¿™ä¸¤è¡Œä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºSpringå®¹å™¨ï¼Œæœ€ç»ˆè·å–åˆ°å¯¹è±¡ï¼Œä½†æ˜¯æ¯æ¬¡æµ‹è¯•éƒ½éœ€è¦é‡å¤ç¼–å†™ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç¨‹åºèƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå®¹å™¨ã€‚æˆ‘ä»¬éƒ½çŸ¥é“JUnitæ— æ³•çŸ¥æ™“æˆ‘ä»¬æ˜¯å¦ä½¿ç”¨äº† Spring æ¡†æ¶ï¼Œæ›´ä¸ç”¨è¯´å¸®æˆ‘ä»¬åˆ›å»º Spring å®¹å™¨äº†ã€‚Springæä¾›äº†ä¸€ä¸ªè¿è¡Œå™¨ï¼Œå¯ä»¥è¯»å–é…ç½®æ–‡ä»¶ï¼ˆæˆ–æ³¨è§£ï¼‰æ¥åˆ›å»ºå®¹å™¨ã€‚æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å®ƒé…ç½®æ–‡ä»¶ä½ç½®å°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡Springæ•´åˆJUnitå¯ä»¥ä½¿ç¨‹åºåˆ›å»ºspringå®¹å™¨äº†



### 6.1ã€æ•´åˆJUnit5


#### 6.1.1ã€æ­å»ºå­æ¨¡å—


æ­å»ºspring-junitæ¨¡å—



#### 6.1.2ã€å¼•å…¥ä¾èµ–


```xml
<dependencies>
    <!--spring contextä¾èµ–-->
    <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>6.0.2</version>
    </dependency>

    <!--springå¯¹junitçš„æ”¯æŒç›¸å…³ä¾èµ–-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>6.0.2</version>
    </dependency>

    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.9.0</version>
    </dependency>

    <!--log4j2çš„ä¾èµ–-->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>2.19.0</version>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-slf4j2-impl</artifactId>
        <version>2.19.0</version>
    </dependency>
</dependencies>
```



#### 6.1.3ã€æ·»åŠ é…ç½®æ–‡ä»¶


beans.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
    <context:component-scan base-package="com.atguigu.spring6.bean"/>
</beans>
```



copyæ—¥å¿—æ–‡ä»¶ï¼šlog4j2.xml



#### 6.1.4ã€æ·»åŠ javaç±»


```java
package com.atguigu.spring6.bean;

import org.springframework.stereotype.Component;

@Component
public class User {

    public User() {
        System.out.println("run user");
    }
}
```



#### 6.1.5ã€æµ‹è¯•


```java
import com.atguigu.spring6.bean.User;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

//ä¸¤ç§æ–¹å¼å‡å¯
//æ–¹å¼ä¸€
//@ExtendWith(SpringExtension.class)
//@ContextConfiguration("classpath:beans.xml")
//æ–¹å¼äºŒ
@SpringJUnitConfig(locations = "classpath:beans.xml")
public class SpringJUnit5Test {

    @Autowired
    private User user;

    @Test
    public void testUser(){
        System.out.println(user);
    }
}
```



### 6.2ã€æ•´åˆJUnit4


JUnit4åœ¨å…¬å¸ä¹Ÿä¼šç»å¸¸ç”¨åˆ°ï¼Œåœ¨æ­¤ä¹Ÿå­¦ä¹ ä¸€ä¸‹



#### 6.2.1ã€æ·»åŠ ä¾èµ–


```xml
<!-- junitæµ‹è¯• -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.12</version>
</dependency>
```



#### 6.2.2ã€æµ‹è¯•


```java
import com.atguigu.spring6.bean.User;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:beans.xml")
public class SpringJUnit4Test {

    @Autowired
    private User user;

    @Test
    public void testUser(){
        System.out.println(user);
    }
}
```



## 7ã€äº‹åŠ¡


### 7.1ã€JdbcTemplate


#### 7.1.1ã€ç®€ä»‹


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221217115515670.png)



Spring æ¡†æ¶å¯¹ JDBC è¿›è¡Œå°è£…ï¼Œä½¿ç”¨ JdbcTemplate æ–¹ä¾¿å®ç°å¯¹æ•°æ®åº“æ“ä½œ



#### 7.1.2ã€å‡†å¤‡å·¥ä½œ


**â‘ æ­å»ºå­æ¨¡å—**



æ­å»ºå­æ¨¡å—ï¼šspring-jdbc-tx



**â‘¡åŠ å…¥ä¾èµ–**



```xml
<dependencies>
    <!--spring jdbc  Spring æŒä¹…åŒ–å±‚æ”¯æŒjaråŒ…-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>6.0.2</version>
    </dependency>
    <!-- MySQLé©±åŠ¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.30</version>
    </dependency>
    <!-- æ•°æ®æº -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid</artifactId>
        <version>1.2.15</version>
    </dependency>
</dependencies>
```



**â‘¢åˆ›å»ºjdbc.properties**



```properties
jdbc.user=root
jdbc.password=root
jdbc.url=jdbc:mysql://localhost:3306/spring?characterEncoding=utf8&useSSL=false
jdbc.driver=com.mysql.cj.jdbc.Driver
```



**â‘£é…ç½®Springçš„é…ç½®æ–‡ä»¶**



beans.xml



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd">

    <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <context:property-placeholder location="classpath:jdbc.properties" />

    <!-- é…ç½®æ•°æ®æº -->
    <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <property name="url" value="${jdbc.url}"/>
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="username" value="${jdbc.user}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

    <!-- é…ç½® JdbcTemplate -->
    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <!-- è£…é…æ•°æ®æº -->
        <property name="dataSource" ref="druidDataSource"/>
    </bean>

</beans>
```



**â‘¤å‡†å¤‡æ•°æ®åº“ä¸æµ‹è¯•è¡¨**



```java
CREATE DATABASE `spring`;

use `spring`;

CREATE TABLE `t_emp` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL COMMENT 'å§“å',
  `age` int(11) DEFAULT NULL COMMENT 'å¹´é¾„',
  `sex` varchar(2) DEFAULT NULL COMMENT 'æ€§åˆ«',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```



#### 7.1.3ã€å®ç°CURD


##### â‘ è£…é… JdbcTemplate


**åˆ›å»ºæµ‹è¯•ç±»ï¼Œæ•´åˆJUnitï¼Œæ³¨å…¥JdbcTemplate**



```java
package com.atguigu.spring6;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

@SpringJUnitConfig(locations = "classpath:beans.xml")
public class JDBCTemplateTest {

    @Autowired
    private JdbcTemplate jdbcTemplate;
    
}
```



##### â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½


```java
@Test
//æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½
public void testUpdate(){
    //æ·»åŠ åŠŸèƒ½
	String sql = "insert into t_emp values(null,?,?,?)";
	int result = jdbcTemplate.update(sql, "å¼ ä¸‰", 23, "ç”·");
    
    //ä¿®æ”¹åŠŸèƒ½
	//String sql = "update t_emp set name=? where id=?";
    //int result = jdbcTemplate.update(sql, "å¼ ä¸‰atguigu", 1);

    //åˆ é™¤åŠŸèƒ½
	//String sql = "delete from t_emp where id=?";
	//int result = jdbcTemplate.update(sql, 1);
}
```



##### â‘¢æŸ¥è¯¢æ•°æ®è¿”å›å¯¹è±¡


```java
public class Emp {

    private Integer id;
    private String name;
    private Integer age;
    private String sex;

    //ç”Ÿæˆgetå’Œsetæ–¹æ³•
    //......

    @Override
    public String toString() {
        return "Emp{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", age=" + age +
                ", sex='" + sex + '\'' +
                '}';
    }
}
```



```java
//æŸ¥è¯¢ï¼šè¿”å›å¯¹è±¡
@Test
public void testSelectObject() {
    //å†™æ³•ä¸€
//        String sql = "select * from t_emp where id=?";
//        Emp empResult = jdbcTemplate.queryForObject(sql,
//                (rs, rowNum) -> {
//                    Emp emp = new Emp();
//                    emp.setId(rs.getInt("id"));
//                    emp.setName(rs.getString("name"));
//                    emp.setAge(rs.getInt("age"));
//                    emp.setSex(rs.getString("sex"));
//                    return emp;
//                }, 1);
//        System.out.println(empResult);

    //å†™æ³•äºŒ
    String sql = "select * from t_emp where id=?";
    Emp emp = jdbcTemplate.queryForObject(sql,
                  new BeanPropertyRowMapper<>(Emp.class),1);
    System.out.println(emp);
}
```



##### â‘£æŸ¥è¯¢æ•°æ®è¿”å›listé›†åˆ


```java
@Test
//æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºä¸€ä¸ªlisté›†åˆ
public void testSelectList(){
    String sql = "select * from t_emp";
    List<Emp> list = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Emp.class));
    System.out.println(list);
}
```



##### â‘¤æŸ¥è¯¢è¿”å›å•ä¸ªçš„å€¼


```java
@Test
//æŸ¥è¯¢å•è¡Œå•åˆ—çš„å€¼
public void selectCount(){
    String sql = "select count(id) from t_emp";
    Integer count = jdbcTemplate.queryForObject(sql, Integer.class);
    System.out.println(count);
}
```



### 7.2ã€å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ


#### 7.2.1ã€äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ


##### â‘ ä»€ä¹ˆæ˜¯äº‹åŠ¡


æ•°æ®åº“äº‹åŠ¡( transaction)æ˜¯è®¿é—®å¹¶å¯èƒ½æ“ä½œå„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚äº‹åŠ¡ç”±äº‹åŠ¡å¼€å§‹ä¸äº‹åŠ¡ç»“æŸä¹‹é—´æ‰§è¡Œçš„å…¨éƒ¨æ•°æ®åº“æ“ä½œç»„æˆã€‚



##### â‘¡äº‹åŠ¡çš„ç‰¹æ€§


**Aï¼šåŸå­æ€§(Atomicity)**



ä¸€ä¸ªäº‹åŠ¡(transaction)ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚



**Cï¼šä¸€è‡´æ€§(Consistency)**



äº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚



å¦‚æœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºæœ‰æ•ˆçŠ¶æ€ã€‚



å¦‚æœåœ¨äº‹åŠ¡ä¸­å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›æ»šï¼Œç³»ç»Ÿè¿”å›åˆ°åŸå§‹çŠ¶æ€ã€‚



**Iï¼šéš”ç¦»æ€§(Isolation)**



æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚



**Dï¼šæŒä¹…æ€§(Durability)**



æŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿåï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚



#### 7.2.2ã€ç¼–ç¨‹å¼äº‹åŠ¡


äº‹åŠ¡åŠŸèƒ½çš„ç›¸å…³æ“ä½œå…¨éƒ¨é€šè¿‡è‡ªå·±ç¼–å†™ä»£ç æ¥å®ç°ï¼š



```java
Connection conn = ...;
    
try {
    
    // å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤
    conn.setAutoCommit(false);
    
    // æ ¸å¿ƒæ“ä½œ
    
    // æäº¤äº‹åŠ¡
    conn.commit();
    
}catch(Exception e){
    
    // å›æ»šäº‹åŠ¡
    conn.rollBack();
    
}finally{
    
    // é‡Šæ”¾æ•°æ®åº“è¿æ¥
    conn.close();
    
}
```



ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·ï¼š



+ ç»†èŠ‚æ²¡æœ‰è¢«å±è”½ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚
+ ä»£ç å¤ç”¨æ€§ä¸é«˜ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚



#### 7.2.3ã€å£°æ˜å¼äº‹åŠ¡


æ—¢ç„¶äº‹åŠ¡æ§åˆ¶çš„ä»£ç æœ‰è§„å¾‹å¯å¾ªï¼Œä»£ç çš„ç»“æ„åŸºæœ¬æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æ¡†æ¶å°±å¯ä»¥å°†å›ºå®šæ¨¡å¼çš„ä»£ç æŠ½å–å‡ºæ¥ï¼Œè¿›è¡Œç›¸å…³çš„å°è£…ã€‚



å°è£…èµ·æ¥åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç®€å•çš„é…ç½®å³å¯å®Œæˆæ“ä½œã€‚



+ å¥½å¤„1ï¼šæé«˜å¼€å‘æ•ˆç‡
+ å¥½å¤„2ï¼šæ¶ˆé™¤äº†å†—ä½™çš„ä»£ç 
+ å¥½å¤„3ï¼šæ¡†æ¶ä¼šç»¼åˆè€ƒè™‘ç›¸å…³é¢†åŸŸä¸­åœ¨å®é™…å¼€å‘ç¯å¢ƒä¸‹æœ‰å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œè¿›è¡Œäº†å¥å£®æ€§ã€æ€§èƒ½ç­‰å„ä¸ªæ–¹é¢çš„ä¼˜åŒ–



æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸‹é¢ä¸¤ä¸ªæ¦‚å¿µï¼š



+ **ç¼–ç¨‹å¼**ï¼š**è‡ªå·±å†™ä»£ç **å®ç°åŠŸèƒ½
+ **å£°æ˜å¼**ï¼šé€šè¿‡**é…ç½®**è®©**æ¡†æ¶**å®ç°åŠŸèƒ½



### 7.3ã€åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡


#### 7.3.1ã€å‡†å¤‡å·¥ä½œ


**â‘ æ·»åŠ é…ç½®**



åœ¨beans.xmlæ·»åŠ é…ç½®



```xml
<!--æ‰«æç»„ä»¶-->
<context:component-scan base-package="com.atguigu.spring6"></context:component-scan>
```



**â‘¡åˆ›å»ºè¡¨**



```sql
CREATE TABLE `t_book` (
  `book_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `book_name` varchar(20) DEFAULT NULL COMMENT 'å›¾ä¹¦åç§°',
  `price` int(11) DEFAULT NULL COMMENT 'ä»·æ ¼',
  `stock` int(10) unsigned DEFAULT NULL COMMENT 'åº“å­˜ï¼ˆæ— ç¬¦å·ï¼‰',
  PRIMARY KEY (`book_id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
insert  into `t_book`(`book_id`,`book_name`,`price`,`stock`) values (1,'æ–—ç ´è‹ç©¹',80,100),(2,'æ–—ç½—å¤§é™†',50,100);
CREATE TABLE `t_user` (
  `user_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `username` varchar(20) DEFAULT NULL COMMENT 'ç”¨æˆ·å',
  `balance` int(10) unsigned DEFAULT NULL COMMENT 'ä½™é¢ï¼ˆæ— ç¬¦å·ï¼‰',
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;
insert  into `t_user`(`user_id`,`username`,`balance`) values (1,'admin',50);
```



**â‘¢åˆ›å»ºç»„ä»¶**



åˆ›å»ºBookControllerï¼š



```java
package com.atguigu.spring6.controller;

@Controller
public class BookController {

    @Autowired
    private BookService bookService;

    public void buyBook(Integer bookId, Integer userId){
        bookService.buyBook(bookId, userId);
    }
}
```



åˆ›å»ºæ¥å£BookServiceï¼š



```java
package com.atguigu.spring6.service;
public interface BookService {
    void buyBook(Integer bookId, Integer userId);
}
```



åˆ›å»ºå®ç°ç±»BookServiceImplï¼š



```java
package com.atguigu.spring6.service.impl;
@Service
public class BookServiceImpl implements BookService {

    @Autowired
    private BookDao bookDao;

    @Override
    public void buyBook(Integer bookId, Integer userId) {
        //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
        Integer price = bookDao.getPriceByBookId(bookId);
        //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
        bookDao.updateStock(bookId);
        //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
        bookDao.updateBalance(userId, price);
    }
}
```



åˆ›å»ºæ¥å£BookDaoï¼š



```java
package com.atguigu.spring6.dao;
public interface BookDao {
    Integer getPriceByBookId(Integer bookId);

    void updateStock(Integer bookId);

    void updateBalance(Integer userId, Integer price);
}
```



åˆ›å»ºå®ç°ç±»BookDaoImplï¼š



```java
package com.atguigu.spring6.dao.impl;
@Repository
public class BookDaoImpl implements BookDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Override
    public Integer getPriceByBookId(Integer bookId) {
        String sql = "select price from t_book where book_id = ?";
        return jdbcTemplate.queryForObject(sql, Integer.class, bookId);
    }

    @Override
    public void updateStock(Integer bookId) {
        String sql = "update t_book set stock = stock - 1 where book_id = ?";
        jdbcTemplate.update(sql, bookId);
    }

    @Override
    public void updateBalance(Integer userId, Integer price) {
        String sql = "update t_user set balance = balance - ? where user_id = ?";
        jdbcTemplate.update(sql, price, userId);
    }
}
```



#### 7.3.2ã€æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ


**â‘ åˆ›å»ºæµ‹è¯•ç±»**



```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

@SpringJUnitConfig(locations = "classpath:beans.xml")
public class TxByAnnotationTest {

    @Autowired
    private BookController bookController;

    @Test
    public void testBuyBook(){
        bookController.buyBook(1, 1);
    }

}
```



**â‘¡æ¨¡æ‹Ÿåœºæ™¯**



ç”¨æˆ·è´­ä¹°å›¾ä¹¦ï¼Œå…ˆæŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼ï¼Œå†æ›´æ–°å›¾ä¹¦çš„åº“å­˜å’Œç”¨æˆ·çš„ä½™é¢



å‡è®¾ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ï¼Œè´­ä¹°idä¸º1çš„å›¾ä¹¦



ç”¨æˆ·ä½™é¢ä¸º50ï¼Œè€Œå›¾ä¹¦ä»·æ ¼ä¸º80



è´­ä¹°å›¾ä¹¦ä¹‹åï¼Œç”¨æˆ·çš„ä½™é¢ä¸º-30ï¼Œæ•°æ®åº“ä¸­ä½™é¢å­—æ®µè®¾ç½®äº†æ— ç¬¦å·ï¼Œå› æ­¤æ— æ³•å°†-30æ’å…¥åˆ°ä½™é¢å­—æ®µ



æ­¤æ—¶æ‰§è¡Œsqlè¯­å¥ä¼šæŠ›å‡ºSQLException



**â‘¢è§‚å¯Ÿç»“æœ**



å› ä¸ºæ²¡æœ‰æ·»åŠ äº‹åŠ¡ï¼Œå›¾ä¹¦çš„åº“å­˜æ›´æ–°äº†ï¼Œä½†æ˜¯ç”¨æˆ·çš„ä½™é¢æ²¡æœ‰æ›´æ–°



æ˜¾ç„¶è¿™æ ·çš„ç»“æœæ˜¯é”™è¯¯çš„ï¼Œè´­ä¹°å›¾ä¹¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥



#### 7.3.3ã€åŠ å…¥äº‹åŠ¡


##### â‘ æ·»åŠ äº‹åŠ¡é…ç½®


åœ¨springé…ç½®æ–‡ä»¶ä¸­å¼•å…¥txå‘½åç©ºé—´



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd">
```



åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼š



```xml
<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <property name="dataSource" ref="druidDataSource"></property>
</bean>

<!--
    å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨
    é€šè¿‡æ³¨è§£@Transactionalæ‰€æ ‡è¯†çš„æ–¹æ³•æˆ–æ ‡è¯†çš„ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«äº‹åŠ¡ç®¡ç†å™¨ç®¡ç†äº‹åŠ¡
-->
<!-- transaction-managerå±æ€§çš„é»˜è®¤å€¼æ˜¯transactionManagerï¼Œå¦‚æœäº‹åŠ¡ç®¡ç†å™¨beançš„idæ­£å¥½å°±æ˜¯è¿™ä¸ªé»˜è®¤å€¼ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸ªå±æ€§ -->
<tx:annotation-driven transaction-manager="transactionManager" />
```



##### â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£


å› ä¸ºserviceå±‚è¡¨ç¤ºä¸šåŠ¡é€»è¾‘å±‚ï¼Œä¸€ä¸ªæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªå®Œæˆçš„åŠŸèƒ½ï¼Œå› æ­¤å¤„ç†äº‹åŠ¡ä¸€èˆ¬åœ¨serviceå±‚å¤„ç†



**åœ¨BookServiceImplçš„buybook()æ·»åŠ æ³¨è§£**[**@Transactional **](/Transactional )** **



##### â‘¢è§‚å¯Ÿç»“æœ


ç”±äºä½¿ç”¨äº†Springçš„å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢éƒ½æ²¡æœ‰æ‰§è¡Œ



#### 7.3.4ã€@Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®


@Transactionalæ ‡è¯†åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™åªä¼šå½±å“è¯¥æ–¹æ³•



@Transactionalæ ‡è¯†çš„ç±»ä¸Šï¼Œåˆ™ä¼šå½±å“ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•



#### 7.3.5ã€äº‹åŠ¡å±æ€§ï¼šåªè¯»


**â‘ ä»‹ç»**

å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚

**â‘¡ä½¿ç”¨æ–¹å¼**

```java
@Transactional(readOnly = true)
public void buyBook(Integer bookId, Integer userId) {
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
    //System.out.println(1/0);
}
```

**â‘¢æ³¨æ„**

å¯¹å¢åˆ æ”¹æ“ä½œè®¾ç½®åªè¯»ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š

:::danger
Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed

:::

#### 7.3.6ã€äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶
**â‘ ä»‹ç»**

äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚

æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼šè¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æºã€‚

**â‘¡ä½¿ç”¨æ–¹å¼**

```java
//è¶…æ—¶æ—¶é—´å•ä½ç§’
@Transactional(timeout = 3)
public void buyBook(Integer bookId, Integer userId) {
    try {
        TimeUnit.SECONDS.sleep(5);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
    //System.out.println(1/0);
}
```

**â‘¢è§‚å¯Ÿç»“æœ**

æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š

:::danger
org.springframework.transaction.**TransactionTimedOutException**: Transaction timed out: deadline was Fri Jun 04 16:25:39 CST 2022

:::

#### 7.3.7ã€äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥
**â‘ ä»‹ç»**

å£°æ˜å¼äº‹åŠ¡é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»šï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚

å¯ä»¥é€šè¿‡@Transactionalä¸­ç›¸å…³å±æ€§è®¾ç½®å›æ»šç­–ç•¥

+  rollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ 
+  rollbackForClassNameå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å 
+  noRollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ 
+  rollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å 

**â‘¡ä½¿ç”¨æ–¹å¼**

```java
@Transactional(noRollbackFor = ArithmeticException.class)
//@Transactional(noRollbackForClassName = "java.lang.ArithmeticException")
public void buyBook(Integer bookId, Integer userId) {
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
    System.out.println(1/0);
}
```

**â‘¢è§‚å¯Ÿç»“æœ**

è™½ç„¶è´­ä¹°å›¾ä¹¦åŠŸèƒ½ä¸­å‡ºç°äº†æ•°å­¦è¿ç®—å¼‚å¸¸ï¼ˆArithmeticExceptionï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è®¾ç½®çš„å›æ»šç­–ç•¥æ˜¯ï¼Œå½“å‡ºç°ArithmeticExceptionä¸å‘ç”Ÿå›æ»šï¼Œå› æ­¤è´­ä¹°å›¾ä¹¦çš„æ“ä½œæ­£å¸¸æ‰§è¡Œ

#### 7.3.8ã€äº‹åŠ¡å±æ€§ï¼šéš”ç¦»çº§åˆ«
**â‘ ä»‹ç»**

æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›ï¼Œä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“ï¼Œé¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚SQLæ ‡å‡†ä¸­è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½ï¼Œä½†å¹¶å‘æ€§è¶Šå¼±ã€‚

éš”ç¦»çº§åˆ«ä¸€å…±æœ‰å››ç§ï¼š

+  è¯»æœªæäº¤ï¼šREAD UNCOMMITTED  
å…è®¸Transaction01è¯»å–Transaction02æœªæäº¤çš„ä¿®æ”¹ã€‚ 
+  è¯»å·²æäº¤ï¼šREAD COMMITTEDã€  
è¦æ±‚Transaction01åªèƒ½è¯»å–Transaction02å·²æäº¤çš„ä¿®æ”¹ã€‚ 
+  å¯é‡å¤è¯»ï¼šREPEATABLE READ  
ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œå³Transaction01æ‰§è¡ŒæœŸé—´ç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªå­—æ®µè¿›è¡Œæ›´æ–°ã€‚ 
+  ä¸²è¡ŒåŒ–ï¼šSERIALIZABLE  
ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–åˆ°ç›¸åŒçš„è¡Œï¼Œåœ¨Transaction01æ‰§è¡ŒæœŸé—´ï¼Œç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªè¡¨è¿›è¡Œæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æ“ä½œã€‚å¯ä»¥é¿å…ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚ 

å„ä¸ªéš”ç¦»çº§åˆ«è§£å†³å¹¶å‘é—®é¢˜çš„èƒ½åŠ›è§ä¸‹è¡¨ï¼š

| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» |
| --- | --- | --- | --- |
| READ UNCOMMITTED | æœ‰ | æœ‰ | æœ‰ |
| READ COMMITTED | æ—  | æœ‰ | æœ‰ |
| REPEATABLE READ | æ—  | æ—  | æœ‰ |
| SERIALIZABLE | æ—  | æ—  | æ—  |




å„ç§æ•°æ®åº“äº§å“å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ”¯æŒç¨‹åº¦ï¼š

| éš”ç¦»çº§åˆ« | Oracle | MySQL |
| --- | --- | --- |
| READ UNCOMMITTED | Ã— | âˆš |
| READ COMMITTED | âˆš(é»˜è®¤) | âˆš |
| REPEATABLE READ | Ã— | âˆš(é»˜è®¤) |
| SERIALIZABLE | âˆš | âˆš |


**â‘¡ä½¿ç”¨æ–¹å¼**

```java
@Transactional(isolation = Isolation.DEFAULT)//ä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«
@Transactional(isolation = Isolation.READ_UNCOMMITTED)//è¯»æœªæäº¤
@Transactional(isolation = Isolation.READ_COMMITTED)//è¯»å·²æäº¤
@Transactional(isolation = Isolation.REPEATABLE_READ)//å¯é‡å¤è¯»
@Transactional(isolation = Isolation.SERIALIZABLE)//ä¸²è¡ŒåŒ–
```

#### 7.3.9ã€äº‹åŠ¡å±æ€§ï¼šä¼ æ’­è¡Œä¸º
**â‘ ä»‹ç»**

ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ

åœ¨serviceç±»ä¸­æœ‰a()æ–¹æ³•å’Œb()æ–¹æ³•ï¼Œa()æ–¹æ³•ä¸Šæœ‰äº‹åŠ¡ï¼Œb()æ–¹æ³•ä¸Šä¹Ÿæœ‰äº‹åŠ¡ï¼Œå½“a()æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†b()æ–¹æ³•ï¼Œäº‹åŠ¡æ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Ÿåˆå¹¶åˆ°ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Ÿè¿˜æ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Ÿè¿™å°±æ˜¯äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚

ä¸€å…±æœ‰ä¸ƒç§ä¼ æ’­è¡Œä¸ºï¼š

+ <font style="color:#DF2A3F;">REQUIRED</font>ï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ–°å»ºä¸€ä¸ª(é»˜è®¤)**ã€æ²¡æœ‰å°±æ–°å»ºï¼Œæœ‰å°±åŠ å…¥ã€‘**
+ SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ**ã€æœ‰å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ä¸ç®¡äº†ã€‘**
+ MANDATORYï¼šå¿…é¡»è¿è¡Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡æ­£åœ¨å‘ç”Ÿï¼Œå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸**ã€æœ‰å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ›å¼‚å¸¸ã€‘**
+ <font style="color:#DF2A3F;">REQUIRES_NEW</font>ï¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å­˜åœ¨ï¼Œåˆ™å°†è¿™ä¸ªå­˜åœ¨çš„äº‹åŠ¡æŒ‚èµ·**ã€ä¸ç®¡æœ‰æ²¡æœ‰ï¼Œç›´æ¥å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¼€å¯çš„æ–°äº‹åŠ¡å’Œä¹‹å‰çš„äº‹åŠ¡ä¸å­˜åœ¨åµŒå¥—å…³ç³»ï¼Œä¹‹å‰äº‹åŠ¡è¢«æŒ‚èµ·ã€‘**
+ NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡**ã€ä¸æ”¯æŒäº‹åŠ¡ï¼Œå­˜åœ¨å°±æŒ‚èµ·ã€‘**
+ NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸**ã€ä¸æ”¯æŒäº‹åŠ¡ï¼Œå­˜åœ¨å°±æŠ›å¼‚å¸¸ã€‘**
+ NESTEDï¼šå¦‚æœå½“å‰æ­£æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿›è¡Œä¸­ï¼Œåˆ™è¯¥æ–¹æ³•åº”å½“è¿è¡Œåœ¨ä¸€ä¸ªåµŒå¥—å¼äº‹åŠ¡ä¸­ã€‚è¢«åµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹äºå¤–å±‚äº‹åŠ¡è¿›è¡Œæäº¤æˆ–å›æ»šã€‚å¦‚æœå¤–å±‚äº‹åŠ¡ä¸å­˜åœ¨ï¼Œè¡Œä¸ºå°±åƒREQUIREDä¸€æ ·ã€‚**ã€æœ‰äº‹åŠ¡çš„è¯ï¼Œå°±åœ¨è¿™ä¸ªäº‹åŠ¡é‡Œå†åµŒå¥—ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„äº‹åŠ¡ï¼ŒåµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹çš„æäº¤å’Œå›æ»šã€‚æ²¡æœ‰äº‹åŠ¡å°±å’ŒREQUIREDä¸€æ ·ã€‚ã€‘**



**â‘¡æµ‹è¯•**



åˆ›å»ºæ¥å£CheckoutServiceï¼š



```java
package com.atguigu.spring6.service;

public interface CheckoutService {
    void checkout(Integer[] bookIds, Integer userId);
}
```



åˆ›å»ºå®ç°ç±»CheckoutServiceImplï¼š



```java
package com.atguigu.spring6.service.impl;

@Service
public class CheckoutServiceImpl implements CheckoutService {

    @Autowired
    private BookService bookService;

    @Override
    @Transactional
    //ä¸€æ¬¡è´­ä¹°å¤šæœ¬å›¾ä¹¦
    public void checkout(Integer[] bookIds, Integer userId) {
        for (Integer bookId : bookIds) {
            bookService.buyBook(bookId, userId);
        }
    }
}
```



åœ¨BookControllerä¸­æ·»åŠ æ–¹æ³•ï¼š



```java
@Autowired
private CheckoutService checkoutService;

public void checkout(Integer[] bookIds, Integer userId){
    checkoutService.checkout(bookIds, userId);
}
```



åœ¨æ•°æ®åº“ä¸­å°†ç”¨æˆ·çš„ä½™é¢ä¿®æ”¹ä¸º100å…ƒ



**â‘¢è§‚å¯Ÿç»“æœ**



å¯ä»¥é€šè¿‡@Transactionalä¸­çš„propagationå±æ€§è®¾ç½®äº‹åŠ¡ä¼ æ’­è¡Œä¸º



ä¿®æ”¹BookServiceImplä¸­buyBook()ä¸Šï¼Œæ³¨è§£@Transactionalçš„propagationå±æ€§



[@Transactional(propagation ](/Transactional(propagation ) = Propagation.REQUIRED)ï¼Œé»˜è®¤æƒ…å†µï¼Œè¡¨ç¤ºå¦‚æœå½“å‰çº¿ç¨‹ä¸Šæœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚ç»è¿‡è§‚å¯Ÿï¼Œè´­ä¹°å›¾ä¹¦çš„æ–¹æ³•buyBook()åœ¨checkout()ä¸­è¢«è°ƒç”¨ï¼Œcheckout()ä¸Šæœ‰äº‹åŠ¡æ³¨è§£ï¼Œå› æ­¤åœ¨æ­¤äº‹åŠ¡ä¸­æ‰§è¡Œã€‚æ‰€è´­ä¹°çš„ä¸¤æœ¬å›¾ä¹¦çš„ä»·æ ¼ä¸º80å’Œ50ï¼Œè€Œç”¨æˆ·çš„ä½™é¢ä¸º100ï¼Œå› æ­¤åœ¨è´­ä¹°ç¬¬äºŒæœ¬å›¾ä¹¦æ—¶ä½™é¢ä¸è¶³å¤±è´¥ï¼Œå¯¼è‡´æ•´ä¸ªcheckout()å›æ»šï¼Œå³åªè¦æœ‰ä¸€æœ¬ä¹¦ä¹°ä¸äº†ï¼Œå°±éƒ½ä¹°ä¸äº† 



[@Transactional(propagation ](/Transactional(propagation ) = Propagation.REQUIRES_NEW)ï¼Œè¡¨ç¤ºä¸ç®¡å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œéƒ½è¦å¼€å¯æ–°äº‹åŠ¡ã€‚åŒæ ·çš„åœºæ™¯ï¼Œæ¯æ¬¡è´­ä¹°å›¾ä¹¦éƒ½æ˜¯åœ¨buyBook()çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå› æ­¤ç¬¬ä¸€æœ¬å›¾ä¹¦è´­ä¹°æˆåŠŸï¼Œäº‹åŠ¡ç»“æŸï¼Œç¬¬äºŒæœ¬å›¾ä¹¦è´­ä¹°å¤±è´¥ï¼Œåªåœ¨ç¬¬äºŒæ¬¡çš„buyBook()ä¸­å›æ»šï¼Œè´­ä¹°ç¬¬ä¸€æœ¬å›¾ä¹¦ä¸å—å½±å“ï¼Œå³èƒ½ä¹°å‡ æœ¬å°±ä¹°å‡ æœ¬ã€‚ 



#### 7.3.10ã€å…¨æ³¨è§£é…ç½®äº‹åŠ¡


**â‘ æ·»åŠ é…ç½®ç±»**



```java
package com.atguigu.spring6.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import javax.sql.DataSource;

@Configuration
@ComponentScan("com.atguigu.spring6")
@EnableTransactionManagement
public class SpringConfig {

    @Bean
    public DataSource getDataSource(){
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setUrl("jdbc:mysql://localhost:3306/spring?characterEncoding=utf8&useSSL=false");
        dataSource.setUsername("root");
        dataSource.setPassword("root");
        return dataSource;
    }

    @Bean(name = "jdbcTemplate")
    public JdbcTemplate getJdbcTemplate(DataSource dataSource){
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        jdbcTemplate.setDataSource(dataSource);
        return jdbcTemplate;
    }

    @Bean
    public DataSourceTransactionManager getDataSourceTransactionManager(DataSource dataSource){
        DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager();
        dataSourceTransactionManager.setDataSource(dataSource);
        return dataSourceTransactionManager;
    }
}
```



**â‘¡æµ‹è¯•**



```java
import com.atguigu.spring6.config.SpringConfig;
import com.atguigu.spring6.controller.BookController;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

public class TxByAllAnnotationTest {

    @Test
    public void testTxAllAnnotation(){
        ApplicationContext applicationContext = new AnnotationConfigApplicationContext(SpringConfig.class);
        BookController accountService = applicationContext.getBean("bookController", BookController.class);
        accountService.buyBook(1, 1);
    }
}
```



### 7.4ã€åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡


#### 7.3.1ã€åœºæ™¯æ¨¡æ‹Ÿ


å‚è€ƒåŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡



#### 7.3.2ã€ä¿®æ”¹Springé…ç½®æ–‡ä»¶


å°†Springé…ç½®æ–‡ä»¶ä¸­å»æ‰tx:annotation-driven æ ‡ç­¾ï¼Œå¹¶æ·»åŠ é…ç½®ï¼š



```xml
<aop:config>
    <!-- é…ç½®äº‹åŠ¡é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
    <aop:advisor advice-ref="txAdvice" pointcut="execution(* com.atguigu.spring.tx.xml.service.impl.*.*(..))"></aop:advisor>
</aop:config>
<!-- tx:adviceæ ‡ç­¾ï¼šé…ç½®äº‹åŠ¡é€šçŸ¥ -->
<!-- idå±æ€§ï¼šç»™äº‹åŠ¡é€šçŸ¥æ ‡ç­¾è®¾ç½®å”¯ä¸€æ ‡è¯†ï¼Œä¾¿äºå¼•ç”¨ -->
<!-- transaction-managerå±æ€§ï¼šå…³è”äº‹åŠ¡ç®¡ç†å™¨ -->
<tx:advice id="txAdvice" transaction-manager="transactionManager">
    <tx:attributes>
        <!-- tx:methodæ ‡ç­¾ï¼šé…ç½®å…·ä½“çš„äº‹åŠ¡æ–¹æ³• -->
        <!-- nameå±æ€§ï¼šæŒ‡å®šæ–¹æ³•åï¼Œå¯ä»¥ä½¿ç”¨æ˜Ÿå·ä»£è¡¨å¤šä¸ªå­—ç¬¦ -->
        <tx:method name="get*" read-only="true"/>
        <tx:method name="query*" read-only="true"/>
        <tx:method name="find*" read-only="true"/>
    
        <!-- read-onlyå±æ€§ï¼šè®¾ç½®åªè¯»å±æ€§ -->
        <!-- rollback-forå±æ€§ï¼šè®¾ç½®å›æ»šçš„å¼‚å¸¸ -->
        <!-- no-rollback-forå±æ€§ï¼šè®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸ -->
        <!-- isolationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ« -->
        <!-- timeoutå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„è¶…æ—¶å±æ€§ -->
        <!-- propagationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º -->
        <tx:method name="save*" read-only="false" rollback-for="java.lang.Exception" propagation="REQUIRES_NEW"/>
        <tx:method name="update*" read-only="false" rollback-for="java.lang.Exception" propagation="REQUIRES_NEW"/>
        <tx:method name="delete*" read-only="false" rollback-for="java.lang.Exception" propagation="REQUIRES_NEW"/>
    </tx:attributes>
</tx:advice>
```



> æ³¨æ„ï¼šåŸºäºxmlå®ç°çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå¿…é¡»å¼•å…¥aspectJçš„ä¾èµ–
>
>  
>

```xml
 <dependency>
     <groupId>org.springframework</groupId>
     <artifactId>spring-aspects</artifactId>
     <version>6.0.2</version>
</dependency>
```



## 8ã€èµ„æºæ“ä½œï¼šResources


### 8.1ã€Spring Resourcesæ¦‚è¿°


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221218154945878.png)

![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221206231535991.png)

Javaçš„æ ‡å‡†java.net.URLç±»å’Œå„ç§URLå‰ç¼€çš„æ ‡å‡†å¤„ç†ç¨‹åºæ— æ³•æ»¡è¶³æ‰€æœ‰å¯¹low-levelèµ„æºçš„è®¿é—®ï¼Œæ¯”å¦‚ï¼šæ²¡æœ‰æ ‡å‡†åŒ–çš„ URL å®ç°å¯ç”¨äºè®¿é—®éœ€è¦ä»ç±»è·¯å¾„æˆ–ç›¸å¯¹äº ServletContext è·å–çš„èµ„æºã€‚å¹¶ä¸”ç¼ºå°‘æŸäº›Springæ‰€éœ€è¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ£€æµ‹æŸèµ„æºæ˜¯å¦å­˜åœ¨ç­‰ã€‚**è€ŒSpringçš„Resourceå£°æ˜äº†è®¿é—®low-levelèµ„æºçš„èƒ½åŠ›ã€‚**

### 8.2ã€Resourceæ¥å£


Spring çš„ Resource æ¥å£ä½äº org.springframework.core.io ä¸­ã€‚ æ—¨åœ¨æˆä¸ºä¸€ä¸ªæ›´å¼ºå¤§çš„æ¥å£ï¼Œç”¨äºæŠ½è±¡å¯¹ä½çº§èµ„æºçš„è®¿é—®ã€‚ä»¥ä¸‹æ˜¾ç¤ºäº†Resourceæ¥å£å®šä¹‰çš„æ–¹æ³•



```java
public interface Resource extends InputStreamSource {

    boolean exists();

    boolean isReadable();

    boolean isOpen();

    boolean isFile();

    URL getURL() throws IOException;

    URI getURI() throws IOException;

    File getFile() throws IOException;

    ReadableByteChannel readableChannel() throws IOException;

    long contentLength() throws IOException;

    long lastModified() throws IOException;

    Resource createRelative(String relativePath) throws IOException;

    String getFilename();

    String getDescription();
}
```



Resourceæ¥å£ç»§æ‰¿äº†InputStreamSourceæ¥å£ï¼Œæä¾›äº†å¾ˆå¤šInputStreamSourceæ‰€æ²¡æœ‰çš„æ–¹æ³•ã€‚InputStreamSourceæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š



```java
public interface InputStreamSource {

    InputStream getInputStream() throws IOException;

}
```



**å…¶ä¸­ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼š**



getInputStream(): æ‰¾åˆ°å¹¶æ‰“å¼€èµ„æºï¼Œè¿”å›ä¸€ä¸ªInputStreamä»¥ä»èµ„æºä¸­è¯»å–ã€‚é¢„è®¡æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„InputStream()ï¼Œè°ƒç”¨è€…æœ‰è´£ä»»å…³é—­æ¯ä¸ªæµ  
exists(): è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨æ˜æŸä¸ªèµ„æºæ˜¯å¦ä»¥ç‰©ç†å½¢å¼å­˜åœ¨  
isOpen: è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ­¤èµ„æºæ˜¯å¦å…·æœ‰å¼€æ”¾æµçš„å¥æŸ„ã€‚å¦‚æœä¸ºtrueï¼ŒInputStreamå°±ä¸èƒ½å¤Ÿå¤šæ¬¡è¯»å–ï¼Œåªèƒ½å¤Ÿè¯»å–ä¸€æ¬¡å¹¶ä¸”åŠæ—¶å…³é—­ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚å¯¹äºæ‰€æœ‰å¸¸è§„èµ„æºå®ç°ï¼Œè¿”å›falseï¼Œä½†æ˜¯InputStreamResourceé™¤å¤–ã€‚  
getDescription(): è¿”å›èµ„æºçš„æè¿°ï¼Œç”¨æ¥è¾“å‡ºé”™è¯¯çš„æ—¥å¿—ã€‚è¿™é€šå¸¸æ˜¯å®Œå…¨é™å®šçš„æ–‡ä»¶åæˆ–èµ„æºçš„å®é™…URLã€‚



**å…¶ä»–æ–¹æ³•ï¼š**



isReadable(): è¡¨æ˜èµ„æºçš„ç›®å½•è¯»å–æ˜¯å¦é€šè¿‡getInputStream()è¿›è¡Œè¯»å–ã€‚  
isFile(): è¡¨æ˜è¿™ä¸ªèµ„æºæ˜¯å¦ä»£è¡¨äº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ã€‚  
getURL(): è¿”å›ä¸€ä¸ªURLå¥æŸ„ï¼Œå¦‚æœèµ„æºä¸èƒ½å¤Ÿè¢«è§£æä¸ºURLï¼Œå°†æŠ›å‡ºIOException  
getURI(): è¿”å›ä¸€ä¸ªèµ„æºçš„URIå¥æŸ„  
getFile(): è¿”å›æŸä¸ªæ–‡ä»¶ï¼Œå¦‚æœèµ„æºä¸èƒ½å¤Ÿè¢«è§£æç§°ä¸ºç»å¯¹è·¯å¾„ï¼Œå°†ä¼šæŠ›å‡ºFileNotFoundException  
lastModified(): èµ„æºæœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´æˆ³  
createRelative(): åˆ›å»ºæ­¤èµ„æºçš„ç›¸å…³èµ„æº  
getFilename(): èµ„æºçš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆ ä¾‹å¦‚ï¼šæœ€åä¸€éƒ¨åˆ†çš„æ–‡ä»¶å myfile.txt



### 8.3ã€Resourceçš„å®ç°ç±»


Resource æ¥å£æ˜¯ Spring èµ„æºè®¿é—®ç­–ç•¥çš„æŠ½è±¡ï¼Œå®ƒæœ¬èº«å¹¶ä¸æä¾›ä»»ä½•èµ„æºè®¿é—®å®ç°ï¼Œå…·ä½“çš„èµ„æºè®¿é—®ç”±è¯¥æ¥å£çš„å®ç°ç±»å®Œæˆâ€”â€”æ¯ä¸ªå®ç°ç±»ä»£è¡¨ä¸€ç§èµ„æºè®¿é—®ç­–ç•¥ã€‚Resourceä¸€èˆ¬åŒ…æ‹¬è¿™äº›å®ç°ç±»ï¼šUrlResourceã€ClassPathResourceã€FileSystemResourceã€ServletContextResourceã€InputStreamResourceã€ByteArrayResource



#### 8.3.1ã€UrlResourceè®¿é—®ç½‘ç»œèµ„æº


Resourceçš„ä¸€ä¸ªå®ç°ç±»ï¼Œç”¨æ¥è®¿é—®ç½‘ç»œèµ„æºï¼Œå®ƒæ”¯æŒURLçš„ç»å¯¹è·¯å¾„ã€‚



http:------è¯¥å‰ç¼€ç”¨äºè®¿é—®åŸºäºHTTPåè®®çš„ç½‘ç»œèµ„æºã€‚



ftp:------è¯¥å‰ç¼€ç”¨äºè®¿é—®åŸºäºFTPåè®®çš„ç½‘ç»œèµ„æº



file: ------è¯¥å‰ç¼€ç”¨äºä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–èµ„æº



**å®éªŒï¼šè®¿é—®åŸºäºHTTPåè®®çš„ç½‘ç»œèµ„æº**



**åˆ›å»ºä¸€ä¸ªmavenå­æ¨¡å—spring6-resourcesï¼Œé…ç½®Springä¾èµ–ï¼ˆå‚è€ƒå‰é¢ï¼‰**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207102315185.png)



```java
package com.atguigu.spring6.resources;

import org.springframework.core.io.UrlResource;

public class UrlResourceDemo {

    public static void loadAndReadUrlResource(String path){
        // åˆ›å»ºä¸€ä¸ª Resource å¯¹è±¡
        UrlResource url = null;
        try {
            url = new UrlResource(path);
            // è·å–èµ„æºå
            System.out.println(url.getFilename());
            System.out.println(url.getURI());
            // è·å–èµ„æºæè¿°
            System.out.println(url.getDescription());
            //è·å–èµ„æºå†…å®¹
            System.out.println(url.getInputStream().read());
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
    
    public static void main(String[] args) {
        //è®¿é—®ç½‘ç»œèµ„æº
        loadAndReadUrlResource("http://www.baidu.com");
    }
}
```



**å®éªŒäºŒï¼šåœ¨é¡¹ç›®æ ¹è·¯å¾„ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–èµ„æº**



æ–¹æ³•ä¸å˜ï¼Œä¿®æ”¹è°ƒç”¨ä¼ é€’è·¯å¾„



```java
public static void main(String[] args) {
    //1 è®¿é—®ç½‘ç»œèµ„æº
	//loadAndReadUrlResource("http://www.atguigu.com");
    
    //2 è®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æº
    loadAndReadUrlResource("file:atguigu.txt");
}
```



#### 8.3.2ã€ClassPathResource è®¿é—®ç±»è·¯å¾„ä¸‹èµ„æº


ClassPathResource ç”¨æ¥è®¿é—®ç±»åŠ è½½è·¯å¾„ä¸‹çš„èµ„æºï¼Œç›¸å¯¹äºå…¶ä»–çš„ Resource å®ç°ç±»ï¼Œå…¶ä¸»è¦ä¼˜åŠ¿æ˜¯æ–¹ä¾¿è®¿é—®ç±»åŠ è½½è·¯å¾„é‡Œçš„èµ„æºï¼Œå°¤å…¶å¯¹äº Web åº”ç”¨ï¼ŒClassPathResource å¯è‡ªåŠ¨æœç´¢ä½äº classes ä¸‹çš„èµ„æºæ–‡ä»¶ï¼Œæ— é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„è®¿é—®ã€‚



**å®éªŒï¼šåœ¨ç±»è·¯å¾„ä¸‹åˆ›å»ºæ–‡ä»¶atguigu.txtï¼Œä½¿ç”¨ClassPathResource è®¿é—®**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207103020854.png)



```java
package com.atguigu.spring6.resources;

import org.springframework.core.io.ClassPathResource;
import java.io.InputStream;

public class ClassPathResourceDemo {

    public static void loadAndReadUrlResource(String path) throws Exception{
        // åˆ›å»ºä¸€ä¸ª Resource å¯¹è±¡
        ClassPathResource resource = new ClassPathResource(path);
        // è·å–æ–‡ä»¶å
        System.out.println("resource.getFileName = " + resource.getFilename());
        // è·å–æ–‡ä»¶æè¿°
        System.out.println("resource.getDescription = "+ resource.getDescription());
        //è·å–æ–‡ä»¶å†…å®¹
        InputStream in = resource.getInputStream();
        byte[] b = new byte[1024];
        while(in.read(b)!=-1) {
            System.out.println(new String(b));
        }
    }

    public static void main(String[] args) throws Exception {
        loadAndReadUrlResource("atguigu.txt");
    }
}
```



ClassPathResourceå®ä¾‹å¯ä½¿ç”¨ClassPathResourceæ„é€ å™¨æ˜¾å¼åœ°åˆ›å»ºï¼Œä½†æ›´å¤šçš„æ—¶å€™å®ƒéƒ½æ˜¯éšå¼åœ°åˆ›å»ºçš„ã€‚å½“æ‰§è¡ŒSpringçš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªä»£è¡¨èµ„æºè·¯å¾„çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå½“Springè¯†åˆ«è¯¥å­—ç¬¦ä¸²å‚æ•°ä¸­åŒ…å«classpath:å‰ç¼€åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºClassPathResourceå¯¹è±¡ã€‚



#### 8.3.3ã€FileSystemResource è®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æº


Spring æä¾›çš„ FileSystemResource ç±»ç”¨äºè®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æºï¼Œä½¿ç”¨ FileSystemResource æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æºå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼Œå› ä¸º Java æä¾›çš„ File ç±»ä¹Ÿå¯ç”¨äºè®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æºã€‚



**å®éªŒï¼šä½¿ç”¨FileSystemResource è®¿é—®æ–‡ä»¶ç³»ç»Ÿèµ„æº**



```java
package com.atguigu.spring6.resources;

import org.springframework.core.io.FileSystemResource;

import java.io.InputStream;

public class FileSystemResourceDemo {

    public static void loadAndReadUrlResource(String path) throws Exception{
        //ç›¸å¯¹è·¯å¾„
        FileSystemResource resource = new FileSystemResource("atguigu.txt");
        //ç»å¯¹è·¯å¾„
        //FileSystemResource resource = new FileSystemResource("C:\\atguigu.txt");
        // è·å–æ–‡ä»¶å
        System.out.println("resource.getFileName = " + resource.getFilename());
        // è·å–æ–‡ä»¶æè¿°
        System.out.println("resource.getDescription = "+ resource.getDescription());
        //è·å–æ–‡ä»¶å†…å®¹
        InputStream in = resource.getInputStream();
        byte[] b = new byte[1024];
        while(in.read(b)!=-1) {
            System.out.println(new String(b));
        }
    }

    public static void main(String[] args) throws Exception {
        loadAndReadUrlResource("atguigu.txt");
    }
}
```



FileSystemResourceå®ä¾‹å¯ä½¿ç”¨FileSystemResourceæ„é€ å™¨æ˜¾ç¤ºåœ°åˆ›å»ºï¼Œä½†æ›´å¤šçš„æ—¶å€™å®ƒéƒ½æ˜¯éšå¼åˆ›å»ºã€‚æ‰§è¡ŒSpringçš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªä»£è¡¨èµ„æºè·¯å¾„çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå½“Springè¯†åˆ«è¯¥å­—ç¬¦ä¸²å‚æ•°ä¸­åŒ…å«file:å‰ç¼€åï¼Œç³»ç»Ÿå°†ä¼šè‡ªåŠ¨åˆ›å»ºFileSystemResourceå¯¹è±¡ã€‚



#### 8.3.4ã€ServletContextResource


è¿™æ˜¯ServletContextèµ„æºçš„Resourceå®ç°ï¼Œå®ƒè§£é‡Šç›¸å…³Webåº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸­çš„ç›¸å¯¹è·¯å¾„ã€‚å®ƒå§‹ç»ˆæ”¯æŒæµ(stream)è®¿é—®å’ŒURLè®¿é—®ï¼Œä½†åªæœ‰åœ¨æ‰©å±•Webåº”ç”¨ç¨‹åºå­˜æ¡£ä¸”èµ„æºå®é™…ä½äºæ–‡ä»¶ç³»ç»Ÿä¸Šæ—¶æ‰å…è®¸java.io.Fileè®¿é—®ã€‚æ— è®ºå®ƒæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ‰©å±•è¿˜æ˜¯ç›´æ¥ä»JARæˆ–å…¶ä»–åœ°æ–¹ï¼ˆå¦‚æ•°æ®åº“ï¼‰è®¿é—®ï¼Œå®é™…ä¸Šéƒ½ä¾èµ–äºServletå®¹å™¨ã€‚



#### 8.3.5ã€InputStreamResource


InputStreamResource æ˜¯ç»™å®šçš„è¾“å…¥æµ(InputStream)çš„Resourceå®ç°ã€‚å®ƒçš„ä½¿ç”¨åœºæ™¯åœ¨æ²¡æœ‰ç‰¹å®šçš„èµ„æºå®ç°çš„æ—¶å€™ä½¿ç”¨(æ„Ÿè§‰å’Œ[@Component ](/Component ) çš„é€‚ç”¨åœºæ™¯å¾ˆç›¸ä¼¼)ã€‚ä¸å…¶ä»–Resourceå®ç°ç›¸æ¯”ï¼Œè¿™æ˜¯å·²æ‰“å¼€èµ„æºçš„æè¿°ç¬¦ã€‚ å› æ­¤ï¼Œå®ƒçš„isOpen()æ–¹æ³•è¿”å›trueã€‚å¦‚æœéœ€è¦å°†èµ„æºæè¿°ç¬¦ä¿ç•™åœ¨æŸå¤„æˆ–è€…éœ€è¦å¤šæ¬¡è¯»å–æµï¼Œè¯·ä¸è¦ä½¿ç”¨å®ƒã€‚ 



#### 8.3.6ã€ByteArrayResource


å­—èŠ‚æ•°ç»„çš„Resourceå®ç°ç±»ã€‚é€šè¿‡ç»™å®šçš„æ•°ç»„åˆ›å»ºäº†ä¸€ä¸ªByteArrayInputStreamã€‚å®ƒå¯¹äºä»ä»»ä½•ç»™å®šçš„å­—èŠ‚æ•°ç»„åŠ è½½å†…å®¹éå¸¸æœ‰ç”¨ï¼Œè€Œæ— éœ€æ±‚åŠ©äºå•æ¬¡ä½¿ç”¨çš„InputStreamResourceã€‚



### 8.4ã€Resourceç±»å›¾


ä¸Šè¿°Resourceå®ç°ç±»ä¸Resourceé¡¶çº§æ¥å£ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä¸‹é¢çš„UMLå…³ç³»æ¨¡å‹æ¥è¡¨ç¤º



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221206232920494.png)



### 8.5ã€ResourceLoader æ¥å£


#### 8.5.1ã€ResourceLoader æ¦‚è¿°


Spring æä¾›å¦‚ä¸‹ä¸¤ä¸ªæ ‡å¿—æ€§æ¥å£ï¼š



**ï¼ˆ1ï¼‰ResourceLoader ï¼š** è¯¥æ¥å£å®ç°ç±»çš„å®ä¾‹å¯ä»¥è·å¾—ä¸€ä¸ªResourceå®ä¾‹ã€‚



**ï¼ˆ2ï¼‰ ResourceLoaderAware ï¼š** è¯¥æ¥å£å®ç°ç±»çš„å®ä¾‹å°†è·å¾—ä¸€ä¸ªResourceLoaderçš„å¼•ç”¨ã€‚



åœ¨ResourceLoaderæ¥å£é‡Œæœ‰å¦‚ä¸‹æ–¹æ³•ï¼š



ï¼ˆ1ï¼‰**Resource getResourceï¼ˆString locationï¼‰** ï¼š è¯¥æ¥å£ä»…æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸€ä¸ªResourceå®ä¾‹ã€‚ApplicationContextå®ç°ç±»éƒ½å®ç°ResourceLoaderæ¥å£ï¼Œå› æ­¤ApplicationContextå¯ç›´æ¥è·å–Resourceå®ä¾‹ã€‚



#### 8.5.2ã€ä½¿ç”¨æ¼”ç¤º


**å®éªŒä¸€ï¼šClassPathXmlApplicationContextè·å–Resourceå®ä¾‹**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.core.io.Resource;

public class Demo1 {

    public static void main(String[] args) {
        ApplicationContext ctx = new ClassPathXmlApplicationContext();
//        é€šè¿‡ApplicationContextè®¿é—®èµ„æº
//        ApplicationContextå®ä¾‹è·å–Resourceå®ä¾‹æ—¶ï¼Œ
//        é»˜è®¤é‡‡ç”¨ä¸ApplicationContextç›¸åŒçš„èµ„æºè®¿é—®ç­–ç•¥
        Resource res = ctx.getResource("atguigu.txt");
        System.out.println(res.getFilename());
    }
}
```



**å®éªŒäºŒï¼šFileSystemApplicationContextè·å–Resourceå®ä¾‹**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.FileSystemXmlApplicationContext;
import org.springframework.core.io.Resource;

public class Demo2 {

    public static void main(String[] args) {
        ApplicationContext ctx = new FileSystemXmlApplicationContext();
        Resource res = ctx.getResource("atguigu.txt");
        System.out.println(res.getFilename());
    }
}
```



#### 8.5.3ã€ResourceLoader æ€»ç»“


Springå°†é‡‡ç”¨å’ŒApplicationContextç›¸åŒçš„ç­–ç•¥æ¥è®¿é—®èµ„æºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœApplicationContextæ˜¯FileSystemXmlApplicationContextï¼Œreså°±æ˜¯FileSystemResourceå®ä¾‹ï¼›å¦‚æœApplicationContextæ˜¯ClassPathXmlApplicationContextï¼Œreså°±æ˜¯ClassPathResourceå®ä¾‹



å½“Springåº”ç”¨éœ€è¦è¿›è¡Œèµ„æºè®¿é—®æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸éœ€è¦ç›´æ¥ä½¿ç”¨Resourceå®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨ResourceLoaderå®ä¾‹çš„getResource()æ–¹æ³•æ¥è·å¾—èµ„æºï¼ŒReosurceLoaderå°†ä¼šè´Ÿè´£é€‰æ‹©Reosurceå®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå…·ä½“çš„èµ„æºè®¿é—®ç­–ç•¥ï¼Œä»è€Œå°†åº”ç”¨ç¨‹åºå’Œå…·ä½“çš„èµ„æºè®¿é—®ç­–ç•¥åˆ†ç¦»å¼€æ¥



å¦å¤–ï¼Œä½¿ç”¨ApplicationContextè®¿é—®èµ„æºæ—¶ï¼Œå¯é€šè¿‡ä¸åŒå‰ç¼€æŒ‡å®šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šçš„ClassPathResourceã€FileSystemResourceç­‰å®ç°ç±»



```java
Resource res = ctx.getResource("calsspath:bean.xml");
Resrouce res = ctx.getResource("file:bean.xml");
Resource res = ctx.getResource("http://localhost:8080/beans.xml");
```



### 8.6ã€ResourceLoaderAware æ¥å£


ResourceLoaderAwareæ¥å£å®ç°ç±»çš„å®ä¾‹å°†è·å¾—ä¸€ä¸ªResourceLoaderçš„å¼•ç”¨ï¼ŒResourceLoaderAwareæ¥å£ä¹Ÿæä¾›äº†ä¸€ä¸ªsetResourceLoader()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ç”±Springå®¹å™¨è´Ÿè´£è°ƒç”¨ï¼ŒSpringå®¹å™¨ä¼šå°†ä¸€ä¸ªResourceLoaderå¯¹è±¡ä½œä¸ºè¯¥æ–¹æ³•çš„å‚æ•°ä¼ å…¥ã€‚



å¦‚æœæŠŠå®ç°ResourceLoaderAwareæ¥å£çš„Beanç±»éƒ¨ç½²åœ¨Springå®¹å™¨ä¸­ï¼ŒSpringå®¹å™¨ä¼šå°†è‡ªèº«å½“æˆResourceLoaderä½œä¸ºsetResourceLoader()æ–¹æ³•çš„å‚æ•°ä¼ å…¥ã€‚ç”±äºApplicationContextçš„å®ç°ç±»éƒ½å®ç°äº†ResourceLoaderæ¥å£ï¼ŒSpringå®¹å™¨è‡ªèº«å®Œå…¨å¯ä½œä¸ºResorceLoaderä½¿ç”¨ã€‚



**å®éªŒï¼šæ¼”ç¤ºResourceLoaderAwareä½¿ç”¨**



**ç¬¬ä¸€æ­¥ åˆ›å»ºç±»ï¼Œå®ç°ResourceLoaderAwareæ¥å£**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.context.ResourceLoaderAware;
import org.springframework.core.io.ResourceLoader;

public class TestBean implements ResourceLoaderAware {

    private ResourceLoader resourceLoader;

    //å®ç°ResourceLoaderAwareæ¥å£å¿…é¡»å®ç°çš„æ–¹æ³•
	//å¦‚æœæŠŠè¯¥Beanéƒ¨ç½²åœ¨Springå®¹å™¨ä¸­ï¼Œè¯¥æ–¹æ³•å°†ä¼šæœ‰Springå®¹å™¨è´Ÿè´£è°ƒç”¨ã€‚
	//SPringå®¹å™¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒSpringä¼šå°†è‡ªèº«ä½œä¸ºå‚æ•°ä¼ ç»™è¯¥æ–¹æ³•ã€‚
    public void setResourceLoader(ResourceLoader resourceLoader) {
        this.resourceLoader = resourceLoader;
    }

    //è¿”å›ResourceLoaderå¯¹è±¡çš„åº”ç”¨
    public ResourceLoader getResourceLoader(){
        return this.resourceLoader;
    }

}
```



**ç¬¬äºŒæ­¥ åˆ›å»ºbean.xmlæ–‡ä»¶ï¼Œé…ç½®TestBean**



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="testBean" class="com.atguigu.spring6.resouceloader.TestBean"></bean>
</beans>
```



**ç¬¬ä¸‰æ­¥ æµ‹è¯•**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.core.io.Resource;
import org.springframework.core.io.ResourceLoader;

public class Demo3 {

    public static void main(String[] args) {
        //Springå®¹å™¨ä¼šå°†ä¸€ä¸ªResourceLoaderå¯¹è±¡ä½œä¸ºè¯¥æ–¹æ³•çš„å‚æ•°ä¼ å…¥
        ApplicationContext ctx = new ClassPathXmlApplicationContext("bean.xml");
        TestBean testBean = ctx.getBean("testBean",TestBean.class);
        //è·å–ResourceLoaderå¯¹è±¡
        ResourceLoader resourceLoader = testBean.getResourceLoader();
        System.out.println("Springå®¹å™¨å°†è‡ªèº«æ³¨å…¥åˆ°ResourceLoaderAware Bean ä¸­ ï¼Ÿ ï¼š" + (resourceLoader == ctx));
        //åŠ è½½å…¶ä»–èµ„æº
        Resource resource = resourceLoader.getResource("atguigu.txt");
        System.out.println(resource.getFilename());
        System.out.println(resource.getDescription());
    }
}
```



### 8.7ã€ä½¿ç”¨Resource ä½œä¸ºå±æ€§


å‰é¢ä»‹ç»äº† Spring æä¾›çš„èµ„æºè®¿é—®ç­–ç•¥ï¼Œä½†è¿™äº›ä¾èµ–è®¿é—®ç­–ç•¥è¦ä¹ˆéœ€è¦ä½¿ç”¨ Resource å®ç°ç±»ï¼Œè¦ä¹ˆéœ€è¦ä½¿ç”¨ ApplicationContext æ¥è·å–èµ„æºã€‚å®é™…ä¸Šï¼Œå½“åº”ç”¨ç¨‹åºä¸­çš„ Bean å®ä¾‹éœ€è¦è®¿é—®èµ„æºæ—¶ï¼ŒSpring æœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼šç›´æ¥åˆ©ç”¨ä¾èµ–æ³¨å…¥ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥çœ‹ï¼ŒSpring æ¡†æ¶ä¸ä»…å……åˆ†åˆ©ç”¨äº†ç­–ç•¥æ¨¡å¼æ¥ç®€åŒ–èµ„æºè®¿é—®ï¼Œè€Œä¸”è¿˜å°†ç­–ç•¥æ¨¡å¼å’Œ IoC è¿›è¡Œå……åˆ†åœ°ç»“åˆï¼Œæœ€å¤§ç¨‹åº¦åœ°ç®€åŒ–äº† Spring èµ„æºè®¿é—®ã€‚



å½’çº³èµ·æ¥ï¼Œ**å¦‚æœ Bean å®ä¾‹éœ€è¦è®¿é—®èµ„æºï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š**



+ **ä»£ç ä¸­è·å– Resource å®ä¾‹ã€‚**
+ **ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€‚**



å¯¹äºç¬¬ä¸€ç§æ–¹å¼ï¼Œå½“ç¨‹åºè·å– Resource å®ä¾‹æ—¶ï¼Œæ€»éœ€è¦æä¾› Resource æ‰€åœ¨çš„ä½ç½®ï¼Œä¸ç®¡é€šè¿‡ FileSystemResource åˆ›å»ºå®ä¾‹ï¼Œè¿˜æ˜¯é€šè¿‡ ClassPathResource åˆ›å»ºå®ä¾‹ï¼Œæˆ–è€…é€šè¿‡ ApplicationContext çš„ getResource() æ–¹æ³•è·å–å®ä¾‹ï¼Œéƒ½éœ€è¦æä¾›èµ„æºä½ç½®ã€‚è¿™æ„å‘³ç€ï¼šèµ„æºæ‰€åœ¨çš„ç‰©ç†ä½ç½®å°†è¢«è€¦åˆåˆ°ä»£ç ä¸­ï¼Œå¦‚æœèµ„æºä½ç½®å‘ç”Ÿæ”¹å˜ï¼Œåˆ™å¿…é¡»æ”¹å†™ç¨‹åºã€‚å› æ­¤ï¼Œé€šå¸¸å»ºè®®é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œè®© Spring ä¸º Bean å®ä¾‹**ä¾èµ–æ³¨å…¥**èµ„æºã€‚



**å®éªŒï¼šè®©Springä¸ºBeanå®ä¾‹ä¾èµ–æ³¨å…¥èµ„æº**



**ç¬¬ä¸€æ­¥ åˆ›å»ºä¾èµ–æ³¨å…¥ç±»ï¼Œå®šä¹‰å±æ€§å’Œæ–¹æ³•**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.core.io.Resource;

public class ResourceBean {
    
    private Resource res;
    
    public void setRes(Resource res) {
        this.res = res;
    }
    public Resource getRes() {
        return res;
    }
    
    public void parse(){
        System.out.println(res.getFilename());
        System.out.println(res.getDescription());
    }
}
```



**ç¬¬äºŒæ­¥ åˆ›å»ºspringé…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¾èµ–æ³¨å…¥**



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="resourceBean" class="com.atguigu.spring6.resouceloader.ResourceBean" >
      <!-- å¯ä»¥ä½¿ç”¨file:ã€http:ã€ftp:ç­‰å‰ç¼€å¼ºåˆ¶Springé‡‡ç”¨å¯¹åº”çš„èµ„æºè®¿é—®ç­–ç•¥ -->
      <!-- å¦‚æœä¸é‡‡ç”¨ä»»ä½•å‰ç¼€ï¼Œåˆ™Springå°†é‡‡ç”¨ä¸è¯¥ApplicationContextç›¸åŒçš„èµ„æºè®¿é—®ç­–ç•¥æ¥è®¿é—®èµ„æº -->
        <property name="res" value="classpath:atguigu.txt"/>
    </bean>
</beans>
```



**ç¬¬ä¸‰æ­¥ æµ‹è¯•**



```java
package com.atguigu.spring6.resouceloader;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Demo4 {

    public static void main(String[] args) {
        ApplicationContext ctx =
                new ClassPathXmlApplicationContext("bean.xml");
        ResourceBean resourceBean = ctx.getBean("resourceBean",ResourceBean.class);
        resourceBean.parse();
    }
}
```



### 8.8ã€åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„


#### 8.8.1ã€æ¦‚è¿°


ä¸ç®¡ä»¥æ€æ ·çš„æ–¹å¼åˆ›å»ºApplicationContextå®ä¾‹ï¼Œéƒ½éœ€è¦ä¸ºApplicationContextæŒ‡å®šé…ç½®æ–‡ä»¶ï¼ŒSpringå…è®¸ä½¿ç”¨ä¸€ä»½æˆ–å¤šåˆ†XMLé…ç½®æ–‡ä»¶ã€‚å½“ç¨‹åºåˆ›å»ºApplicationContextå®ä¾‹æ—¶ï¼Œé€šå¸¸ä¹Ÿæ˜¯ä»¥Resourceçš„æ–¹å¼æ¥è®¿é—®é…ç½®æ–‡ä»¶çš„ï¼Œæ‰€ä»¥ApplicationContextå®Œå…¨æ”¯æŒClassPathResourceã€FileSystemResourceã€ServletContextResourceç­‰èµ„æºè®¿é—®æ–¹å¼ã€‚



**ApplicationContextç¡®å®šèµ„æºè®¿é—®ç­–ç•¥é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼š**



**ï¼ˆ1ï¼‰ä½¿ç”¨ApplicationContextå®ç°ç±»æŒ‡å®šè®¿é—®ç­–ç•¥ã€‚**



**ï¼ˆ2ï¼‰ä½¿ç”¨å‰ç¼€æŒ‡å®šè®¿é—®ç­–ç•¥ã€‚**



#### 8.8.2ã€ApplicationContextå®ç°ç±»æŒ‡å®šè®¿é—®ç­–ç•¥


åˆ›å»ºApplicationContextå¯¹è±¡æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å®ç°ç±»ï¼š



ï¼ˆ1ï¼‰ ClassPathXMLApplicationContext : å¯¹åº”ä½¿ç”¨ClassPathResourceè¿›è¡Œèµ„æºè®¿é—®ã€‚



ï¼ˆ2ï¼‰FileSystemXmlApplicationContext ï¼š å¯¹åº”ä½¿ç”¨FileSystemResourceè¿›è¡Œèµ„æºè®¿é—®ã€‚



ï¼ˆ3ï¼‰XmlWebApplicationContext ï¼š å¯¹åº”ä½¿ç”¨ServletContextResourceè¿›è¡Œèµ„æºè®¿é—®ã€‚



å½“ä½¿ç”¨ApplicationContextçš„ä¸åŒå®ç°ç±»æ—¶ï¼Œå°±æ„å‘³ç€Springä½¿ç”¨å“åº”çš„èµ„æºè®¿é—®ç­–ç•¥ã€‚



æ•ˆæœå‰é¢å·²ç»æ¼”ç¤º



#### 8.8.3ã€ä½¿ç”¨å‰ç¼€æŒ‡å®šè®¿é—®ç­–ç•¥


**å®éªŒä¸€ï¼šclasspathå‰ç¼€ä½¿ç”¨**



```java
package com.atguigu.spring6.context;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.FileSystemXmlApplicationContext;
import org.springframework.core.io.Resource;

public class Demo1 {

    public static void main(String[] args) {
        /*
         * é€šè¿‡æœç´¢æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸‹çš„xmlæ–‡ä»¶åˆ›å»ºApplicationContextï¼Œ
         * ä½†é€šè¿‡æŒ‡å®šclasspath:å‰ç¼€å¼ºåˆ¶æœç´¢ç±»åŠ è½½è·¯å¾„
         * classpath:bean.xml
         * */
        ApplicationContext ctx =
                new ClassPathXmlApplicationContext("classpath:bean.xml");
        System.out.println(ctx);
        Resource resource = ctx.getResource("atguigu.txt");
        System.out.println(resource.getFilename());
        System.out.println(resource.getDescription());
    }
}
```



**å®éªŒäºŒï¼šclasspathé€šé…ç¬¦ä½¿ç”¨**



classpath _ :å‰ç¼€æä¾›äº†åŠ è½½å¤šä¸ªXMLé…ç½®æ–‡ä»¶çš„èƒ½åŠ›ï¼Œå½“ä½¿ç”¨classpath_:å‰ç¼€æ¥æŒ‡å®šXMLé…ç½®æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°†æœç´¢ç±»åŠ è½½è·¯å¾„ï¼Œæ‰¾åˆ°æ‰€æœ‰ä¸æ–‡ä»¶ååŒ¹é…çš„æ–‡ä»¶ï¼Œåˆ†åˆ«åŠ è½½æ–‡ä»¶ä¸­çš„é…ç½®å®šä¹‰ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªApplicationContextã€‚



```java
ApplicationContext ctx = new ClassPathXmlApplicationContext("classpath*:bean.xml");
System.out.println(ctx);
```



å½“ä½¿ç”¨classpath * :å‰ç¼€æ—¶ï¼ŒSpringå°†ä¼šæœç´¢ç±»åŠ è½½è·¯å¾„ä¸‹æ‰€æœ‰æ»¡è¶³è¯¥è§„åˆ™çš„é…ç½®æ–‡ä»¶ã€‚



å¦‚æœä¸æ˜¯é‡‡ç”¨classpath * :å‰ç¼€ï¼Œè€Œæ˜¯æ”¹ä¸ºä½¿ç”¨classpath:å‰ç¼€ï¼ŒSpringåˆ™åªåŠ è½½ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„XMLæ–‡ä»¶



**æ³¨æ„ ï¼š**



classpath _ : å‰ç¼€ä»…å¯¹ApplicationContextæœ‰æ•ˆã€‚å®é™…æƒ…å†µæ˜¯ï¼Œåˆ›å»ºApplicationContextæ—¶ï¼Œåˆ†åˆ«è®¿é—®å¤šä¸ªé…ç½®æ–‡ä»¶(é€šè¿‡ClassLoaderçš„getResourceæ–¹æ³•å®ç°)ã€‚å› æ­¤ï¼Œclasspath _ :å‰ç¼€ä¸å¯ç”¨äºResourceã€‚



**ä½¿ç”¨ä¸‰ï¼šé€šé…ç¬¦å…¶ä»–ä½¿ç”¨**



ä¸€æ¬¡æ€§åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶æ—¶ä½¿ç”¨é€šé…ç¬¦



```java
ApplicationContext ctx = new ClassPathXmlApplicationContext("classpath:bean*.xml");
```



Springå…è®¸å°†classpath*:å‰ç¼€å’Œé€šé…ç¬¦ç»“åˆä½¿ç”¨ï¼š



```java
ApplicationContext ctx = new ClassPathXmlApplicationContext("classpath*:bean*.xml");
```



## 9ã€å›½é™…åŒ–ï¼ši18n


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221218154728062.png)



### 9.1ã€i18næ¦‚è¿°


å›½é™…åŒ–ä¹Ÿç§°ä½œi18nï¼Œå…¶æ¥æºæ˜¯è‹±æ–‡å•è¯ internationalizationçš„é¦–æœ«å­—ç¬¦iå’Œnï¼Œ18ä¸ºä¸­é—´çš„å­—ç¬¦æ•°ã€‚ç”±äºè½¯ä»¶å‘è¡Œå¯èƒ½é¢å‘å¤šä¸ªå›½å®¶ï¼Œå¯¹äºä¸åŒå›½å®¶çš„ç”¨æˆ·ï¼Œè½¯ä»¶æ˜¾ç¤ºä¸åŒè¯­è¨€çš„è¿‡ç¨‹å°±æ˜¯å›½é™…åŒ–ã€‚é€šå¸¸æ¥è®²ï¼Œè½¯ä»¶ä¸­çš„å›½é™…åŒ–æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°çš„ï¼Œå‡è®¾è¦æ”¯æ’‘ä¸¤ç§è¯­è¨€ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸¤ä¸ªç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ã€‚



### 9.2ã€Javaå›½é™…åŒ–


ï¼ˆ1ï¼‰Javaè‡ªèº«æ˜¯æ”¯æŒå›½é™…åŒ–çš„ï¼Œjava.util.Localeç”¨äºæŒ‡å®šå½“å‰ç”¨æˆ·æ‰€å±çš„è¯­è¨€ç¯å¢ƒç­‰ä¿¡æ¯ï¼Œjava.util.ResourceBundleç”¨äºæŸ¥æ‰¾ç»‘å®šå¯¹åº”çš„èµ„æºæ–‡ä»¶ã€‚LocaleåŒ…å«äº†languageä¿¡æ¯å’Œcountryä¿¡æ¯ï¼ŒLocaleåˆ›å»ºé»˜è®¤localeå¯¹è±¡æ—¶ä½¿ç”¨çš„é™æ€æ–¹æ³•ï¼š



```java
    /**
     * This method must be called only for creating the Locale.*
     * constants due to making shortcuts.
     */
    private static Locale createConstant(String lang, String country) {
        BaseLocale base = BaseLocale.createInstance(lang, country);
        return getInstance(base, null);
    }
```



ï¼ˆ2ï¼‰é…ç½®æ–‡ä»¶å‘½åè§„åˆ™ï¼š  
**basename_language_country.properties**  
å¿…é¡»éµå¾ªä»¥ä¸Šçš„å‘½åè§„åˆ™ï¼Œjavaæ‰ä¼šè¯†åˆ«ã€‚å…¶ä¸­ï¼Œbasenameæ˜¯å¿…é¡»çš„ï¼Œè¯­è¨€å’Œå›½å®¶æ˜¯å¯é€‰çš„ã€‚è¿™é‡Œå­˜åœ¨ä¸€ä¸ªä¼˜å…ˆçº§æ¦‚å¿µï¼Œå¦‚æœåŒæ—¶æä¾›äº†messages.propertieså’Œmessages_zh_CN.propertesä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæä¾›çš„localeç¬¦åˆen_CNï¼Œé‚£ä¹ˆä¼˜å…ˆæŸ¥æ‰¾messages_en_CN.propertesé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æŸ¥æ‰¾åˆ°ï¼Œå†æŸ¥æ‰¾messages.propertiesé…ç½®æ–‡ä»¶ã€‚æœ€åï¼Œæç¤ºä¸‹ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¿…é¡»æ”¾åœ¨classpathä¸­ï¼Œä¸€èˆ¬æ”¾åœ¨resourcesç›®å½•ä¸‹



**ï¼ˆ3ï¼‰å®éªŒï¼šæ¼”ç¤ºJavaå›½é™…åŒ–**



**ç¬¬ä¸€æ­¥ åˆ›å»ºå­æ¨¡å—spring6-i18nï¼Œå¼•å…¥springä¾èµ–**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207122500801.png)



**ç¬¬äºŒæ­¥ åœ¨resourceç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼šmessages_zh_CN.properteså’Œmessages_en_GB.propertes**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207124839565.png)



**ç¬¬ä¸‰æ­¥ æµ‹è¯•**



```java
package com.atguigu.spring6.javai18n;

import java.nio.charset.StandardCharsets;
import java.util.Locale;
import java.util.ResourceBundle;

public class Demo1 {

    public static void main(String[] args) {
        System.out.println(ResourceBundle.getBundle("messages",
                new Locale("en","GB")).getString("test"));

        System.out.println(ResourceBundle.getBundle("messages",
                new Locale("zh","CN")).getString("test"));
    }
}
```



### 9.3ã€Spring6å›½é™…åŒ–


#### 9.3.1ã€MessageSourceæ¥å£


springä¸­å›½é™…åŒ–æ˜¯é€šè¿‡MessageSourceè¿™ä¸ªæ¥å£æ¥æ”¯æŒçš„



**å¸¸è§å®ç°ç±»**



**ResourceBundleMessageSource**



è¿™ä¸ªæ˜¯åŸºäºJavaçš„ResourceBundleåŸºç¡€ç±»å®ç°ï¼Œå…è®¸ä»…é€šè¿‡èµ„æºååŠ è½½å›½é™…åŒ–èµ„æº



**ReloadableResourceBundleMessageSource**



è¿™ä¸ªåŠŸèƒ½å’Œç¬¬ä¸€ä¸ªç±»çš„åŠŸèƒ½ç±»ä¼¼ï¼Œå¤šäº†å®šæ—¶åˆ·æ–°åŠŸèƒ½ï¼Œå…è®¸åœ¨ä¸é‡å¯ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°èµ„æºçš„ä¿¡æ¯



**StaticMessageSource**



å®ƒå…è®¸é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æä¾›å›½é™…åŒ–ä¿¡æ¯ï¼Œä¸€ä¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å®ç°dbä¸­å­˜å‚¨å›½é™…åŒ–ä¿¡æ¯çš„åŠŸèƒ½ã€‚



#### 9.3.2ã€ä½¿ç”¨Spring6å›½é™…åŒ–


**ç¬¬ä¸€æ­¥ åˆ›å»ºèµ„æºæ–‡ä»¶**



**å›½é™…åŒ–æ–‡ä»¶å‘½åæ ¼å¼ï¼šåŸºæœ¬åç§° **_** è¯­è¨€ **_** å›½å®¶.properties**



**{0},{1}è¿™æ ·å†…å®¹ï¼Œå°±æ˜¯åŠ¨æ€å‚æ•°**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207140024056.png)



**ï¼ˆ1ï¼‰åˆ›å»ºatguigu_en_US.properties**



```properties
www.atguigu.com=welcome {0},æ—¶é—´:{1}
```



**ï¼ˆ2ï¼‰åˆ›å»ºatguigu_zh_CN.properties**



```properties
www.atguigu.com=æ¬¢è¿ {0},æ—¶é—´:{1}
```



**ç¬¬äºŒæ­¥ åˆ›å»ºspringé…ç½®æ–‡ä»¶ï¼Œé…ç½®MessageSource**



```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="messageSource"
          class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basenames">
            <list>
                <value>atguigu</value>
            </list>
        </property>
        <property name="defaultEncoding">
            <value>utf-8</value>
        </property>
    </bean>
</beans>
```



**ç¬¬ä¸‰æ­¥ åˆ›å»ºæµ‹è¯•ç±»**



```java
package com.atguigu.spring6.javai18n;

import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import java.util.Date;
import java.util.Locale;

public class Demo2 {

    public static void main(String[] args) {
        
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        
        //ä¼ é€’åŠ¨æ€å‚æ•°ï¼Œä½¿ç”¨æ•°ç»„å½¢å¼å¯¹åº”{0} {1}é¡ºåº
        Object[] objs = new Object[]{"atguigu",new Date().toString()};

        //www.atguigu.comä¸ºèµ„æºæ–‡ä»¶çš„keyå€¼,
        //objsä¸ºèµ„æºæ–‡ä»¶valueå€¼æ‰€éœ€è¦çš„å‚æ•°,Local.CHINAä¸ºå›½é™…åŒ–ä¸ºè¯­è¨€
        String str=context.getMessage("www.atguigu.com", objs, Locale.CHINA);
        System.out.println(str);
    }
}
```



## 10ã€æ•°æ®æ ¡éªŒï¼šValidation


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221218154808754.png)



### 10.1ã€Spring Validationæ¦‚è¿°


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221206220207266.png)



åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°å‚æ•°æ ¡éªŒçš„éœ€æ±‚ï¼Œæ¯”å¦‚ç”¨æˆ·æ³¨å†Œçš„æ—¶å€™ï¼Œè¦æ ¡éªŒç”¨æˆ·åä¸èƒ½ä¸ºç©ºã€ç”¨æˆ·åé•¿åº¦ä¸è¶…è¿‡20ä¸ªå­—ç¬¦ã€æ‰‹æœºå·æ˜¯åˆæ³•çš„æ‰‹æœºå·æ ¼å¼ç­‰ç­‰ã€‚å¦‚æœä½¿ç”¨æ™®é€šæ–¹å¼ï¼Œæˆ‘ä»¬ä¼šæŠŠæ ¡éªŒçš„ä»£ç å’ŒçœŸæ­£çš„ä¸šåŠ¡å¤„ç†é€»è¾‘è€¦åˆåœ¨ä¸€èµ·ï¼Œè€Œä¸”å¦‚æœæœªæ¥è¦æ–°å¢ä¸€ç§æ ¡éªŒé€»è¾‘ä¹Ÿéœ€è¦åœ¨ä¿®æ”¹å¤šä¸ªåœ°æ–¹ã€‚è€Œspring validationå…è®¸é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥å®šä¹‰å¯¹è±¡æ ¡éªŒè§„åˆ™ï¼ŒæŠŠæ ¡éªŒå’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»å¼€ï¼Œè®©ä»£ç ç¼–å†™æ›´åŠ æ–¹ä¾¿ã€‚Spring Validationå…¶å®å°±æ˜¯å¯¹Hibernate Validatorè¿›ä¸€æ­¥çš„å°è£…ï¼Œæ–¹ä¾¿åœ¨Springä¸­ä½¿ç”¨ã€‚



åœ¨Springä¸­æœ‰å¤šç§æ ¡éªŒçš„æ–¹å¼



**ç¬¬ä¸€ç§æ˜¯é€šè¿‡å®ç°org.springframework.validation.Validatoræ¥å£ï¼Œç„¶ååœ¨ä»£ç ä¸­è°ƒç”¨è¿™ä¸ªç±»**



**ç¬¬äºŒç§æ˜¯æŒ‰ç…§Bean Validationæ–¹å¼æ¥è¿›è¡Œæ ¡éªŒï¼Œå³é€šè¿‡æ³¨è§£çš„æ–¹å¼ã€‚**



**ç¬¬ä¸‰ç§æ˜¯åŸºäºæ–¹æ³•å®ç°æ ¡éªŒ**



**é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å®ç°è‡ªå®šä¹‰æ ¡éªŒ**



### 10.2ã€å®éªŒä¸€ï¼šé€šè¿‡Validatoræ¥å£å®ç°


**ç¬¬ä¸€æ­¥ åˆ›å»ºå­æ¨¡å— spring6-validator**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221206221002615.png)



**ç¬¬äºŒæ­¥ å¼•å…¥ç›¸å…³ä¾èµ–**



```xml
<dependencies>
    <dependency>
        <groupId>org.hibernate.validator</groupId>
        <artifactId>hibernate-validator</artifactId>
        <version>7.0.5.Final</version>
    </dependency>

    <dependency>
        <groupId>org.glassfish</groupId>
        <artifactId>jakarta.el</artifactId>
        <version>4.0.1</version>
    </dependency>
</dependencies>
```



**ç¬¬ä¸‰æ­¥ åˆ›å»ºå®ä½“ç±»ï¼Œå®šä¹‰å±æ€§å’Œæ–¹æ³•**



```java
package com.atguigu.spring6.validation.method1;

public class Person {
    private String name;
    private int age;

    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
}
```



**ç¬¬å››æ­¥ åˆ›å»ºç±»å®ç°Validatoræ¥å£ï¼Œå®ç°æ¥å£æ–¹æ³•æŒ‡å®šæ ¡éªŒè§„åˆ™**



```java
package com.atguigu.spring6.validation.method1;

import org.springframework.validation.Errors;
import org.springframework.validation.ValidationUtils;
import org.springframework.validation.Validator;

public class PersonValidator implements Validator {

    @Override
    public boolean supports(Class<?> clazz) {
        return Person.class.equals(clazz);
    }

    @Override
    public void validate(Object object, Errors errors) {
        ValidationUtils.rejectIfEmpty(errors, "name", "name.empty");
        Person p = (Person) object;
        if (p.getAge() < 0) {
            errors.rejectValue("age", "error value < 0");
        } else if (p.getAge() > 110) {
            errors.rejectValue("age", "error value too old");
        }
    }
}
```



ä¸Šé¢å®šä¹‰çš„ç±»ï¼Œå…¶å®å°±æ˜¯å®ç°æ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œ



supportsæ–¹æ³•ç”¨æ¥è¡¨ç¤ºæ­¤æ ¡éªŒç”¨åœ¨å“ªä¸ªç±»å‹ä¸Šï¼Œ



validateæ˜¯è®¾ç½®æ ¡éªŒé€»è¾‘çš„åœ°ç‚¹ï¼Œå…¶ä¸­ValidationUtilsï¼Œæ˜¯Springå°è£…çš„æ ¡éªŒå·¥å…·ç±»ï¼Œå¸®åŠ©å¿«é€Ÿå®ç°æ ¡éªŒã€‚



**ç¬¬äº”æ­¥ ä½¿ç”¨ä¸Šè¿°Validatorè¿›è¡Œæµ‹è¯•**



```java
package com.atguigu.spring6.validation.method1;

import org.springframework.validation.BindingResult;
import org.springframework.validation.DataBinder;

public class TestMethod1 {

    public static void main(String[] args) {
        //åˆ›å»ºpersonå¯¹è±¡
        Person person = new Person();
        person.setName("lucy");
        person.setAge(-1);
        
        // åˆ›å»ºPersonå¯¹åº”çš„DataBinder
        DataBinder binder = new DataBinder(person);

        // è®¾ç½®æ ¡éªŒ
        binder.setValidator(new PersonValidator());

        // ç”±äºPersonå¯¹è±¡ä¸­çš„å±æ€§ä¸ºç©ºï¼Œæ‰€ä»¥æ ¡éªŒä¸é€šè¿‡
        binder.validate();

        //è¾“å‡ºç»“æœ
        BindingResult results = binder.getBindingResult();
        System.out.println(results.getAllErrors());
    }
}
```



### 10.3ã€å®éªŒäºŒï¼šBean Validationæ³¨è§£å®ç°


ä½¿ç”¨Bean Validationæ ¡éªŒæ–¹å¼ï¼Œå°±æ˜¯å¦‚ä½•å°†Bean Validationéœ€è¦ä½¿ç”¨çš„javax.validation.ValidatorFactory å’Œjavax.validation.Validatoræ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚springé»˜è®¤æœ‰ä¸€ä¸ªå®ç°ç±»LocalValidatorFactoryBeanï¼Œå®ƒå®ç°äº†ä¸Šé¢Bean Validationä¸­çš„æ¥å£ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†org.springframework.validation.Validatoræ¥å£ã€‚



**ç¬¬ä¸€æ­¥ åˆ›å»ºé…ç½®ç±»ï¼Œé…ç½®LocalValidatorFactoryBean**



```java
@Configuration
@ComponentScan("com.atguigu.spring6.validation.method2")
public class ValidationConfig {

    @Bean
    public LocalValidatorFactoryBean validator() {
        return new LocalValidatorFactoryBean();
    }
}
```



**ç¬¬äºŒæ­¥ åˆ›å»ºå®ä½“ç±»ï¼Œä½¿ç”¨æ³¨è§£å®šä¹‰æ ¡éªŒè§„åˆ™**



```java
package com.atguigu.spring6.validation.method2;

import jakarta.validation.constraints.Max;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotNull;

public class User {

    @NotNull
    private String name;

    @Min(0)
    @Max(120)
    private int age;

    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
}
```



**å¸¸ç”¨æ³¨è§£è¯´æ˜**  
[@NotNull	](/NotNull	) é™åˆ¶å¿…é¡»ä¸ä¸ºnull   
[@NotEmpty	](/NotEmpty	) åªä½œç”¨äºå­—ç¬¦ä¸²ç±»å‹ï¼Œå­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œå¹¶ä¸”é•¿åº¦ä¸ä¸º0   
[@NotBlank	](/NotBlank	) åªä½œç”¨äºå­—ç¬¦ä¸²ç±»å‹ï¼Œå­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œå¹¶ä¸”trim()åä¸ä¸ºç©ºä¸²   
[@DecimalMax(value)	](/value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å¤§äºæŒ‡å®šå€¼çš„æ•°å­—   
[@DecimalMin(value)	](/value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å°äºæŒ‡å®šå€¼çš„æ•°å­—   
[@Max(value)	](/value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å¤§äºæŒ‡å®šå€¼çš„æ•°å­—   
[@Min(value)	](/value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å°äºæŒ‡å®šå€¼çš„æ•°å­—   
[@Pattern(value)	](/value) é™åˆ¶å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼   
@Size(max,min)	é™åˆ¶å­—ç¬¦é•¿åº¦å¿…é¡»åœ¨minåˆ°maxä¹‹é—´  
[@Email	](/Email	) éªŒè¯æ³¨è§£çš„å…ƒç´ å€¼æ˜¯Emailï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å’ŒflagæŒ‡å®šè‡ªå®šä¹‰çš„emailæ ¼å¼ 



**ç¬¬ä¸‰æ­¥ ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ ¡éªŒå™¨å®ç°**



**ï¼ˆ1ï¼‰ä½¿ç”¨jakarta.validation.Validatoræ ¡éªŒ**



```java
package com.atguigu.spring6.validation.method2;

import jakarta.validation.ConstraintViolation;
import jakarta.validation.Validator;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.util.Set;

@Service
public class MyService1 {

    @Autowired
    private Validator validator;

    public  boolean validator(User user){
        Set<ConstraintViolation<User>> sets =  validator.validate(user);
        return sets.isEmpty();
    }

}
```



**ï¼ˆ2ï¼‰ä½¿ç”¨org.springframework.validation.Validatoræ ¡éªŒ**



```java
package com.atguigu.spring6.validation.method2;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.validation.BindException;
import org.springframework.validation.Validator;

@Service
public class MyService2 {

    @Autowired
    private Validator validator;

    public boolean validaPersonByValidator(User user) {
        BindException bindException = new BindException(user, user.getName());
        validator.validate(user, bindException);
        return bindException.hasErrors();
    }
}
```



**ç¬¬å››æ­¥ æµ‹è¯•**



```java
package com.atguigu.spring6.validation.method2;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class TestMethod2 {

    @Test
    public void testMyService1() {
        ApplicationContext context = new AnnotationConfigApplicationContext(ValidationConfig.class);
        MyService1 myService = context.getBean(MyService1.class);
        User user = new User();
        user.setAge(-1);
        boolean validator = myService.validator(user);
        System.out.println(validator);
    }

    @Test
    public void testMyService2() {
        ApplicationContext context = new AnnotationConfigApplicationContext(ValidationConfig.class);
        MyService2 myService = context.getBean(MyService2.class);
        User user = new User();
        user.setName("lucy");
        user.setAge(130);
        user.setAge(-1);
        boolean validator = myService.validaPersonByValidator(user);
        System.out.println(validator);
    }
}
```



### 10.4ã€å®éªŒä¸‰ï¼šåŸºäºæ–¹æ³•å®ç°æ ¡éªŒ


**ç¬¬ä¸€æ­¥ åˆ›å»ºé…ç½®ç±»ï¼Œé…ç½®MethodValidationPostProcessor**



```java
package com.atguigu.spring6.validation.method3;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;
import org.springframework.validation.beanvalidation.MethodValidationPostProcessor;

@Configuration
@ComponentScan("com.atguigu.spring6.validation.method3")
public class ValidationConfig {

    @Bean
    public MethodValidationPostProcessor validationPostProcessor() {
        return new MethodValidationPostProcessor();
    }
}
```



**ç¬¬äºŒæ­¥ åˆ›å»ºå®ä½“ç±»ï¼Œä½¿ç”¨æ³¨è§£è®¾ç½®æ ¡éªŒè§„åˆ™**



```java
package com.atguigu.spring6.validation.method3;

import jakarta.validation.constraints.*;

public class User {

    @NotNull
    private String name;

    @Min(0)
    @Max(120)
    private int age;

    @Pattern(regexp = "^1(3|4|5|7|8)\\d{9}$",message = "æ‰‹æœºå·ç æ ¼å¼é”™è¯¯")
    @NotBlank(message = "æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º")
    private String phone;

    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getPhone() {
        return phone;
    }
    public void setPhone(String phone) {
        this.phone = phone;
    }
}
```



**ç¬¬ä¸‰æ­¥ å®šä¹‰Serviceç±»ï¼Œé€šè¿‡æ³¨è§£æ“ä½œå¯¹è±¡**



```java
package com.atguigu.spring6.validation.method3;

import jakarta.validation.Valid;
import jakarta.validation.constraints.NotNull;
import org.springframework.stereotype.Service;
import org.springframework.validation.annotation.Validated;

@Service
@Validated
public class MyService {
    
    public String testParams(@NotNull @Valid User user) {
        return user.toString();
    }

}
```



**ç¬¬å››æ­¥ æµ‹è¯•**



```java
package com.atguigu.spring6.validation.method3;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class TestMethod3 {

    @Test
    public void testMyService1() {
        ApplicationContext context = new AnnotationConfigApplicationContext(ValidationConfig.class);
        MyService myService = context.getBean(MyService.class);
        User user = new User();
        user.setAge(-1);
        myService.testParams(user);
    }
}
```



### 10.5ã€å®éªŒå››ï¼šå®ç°è‡ªå®šä¹‰æ ¡éªŒ


**ç¬¬ä¸€æ­¥ è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£**



```java
package com.atguigu.spring6.validation.method4;

import jakarta.validation.Constraint;
import jakarta.validation.Payload;
import java.lang.annotation.*;

@Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Constraint(validatedBy = {CannotBlankValidator.class})
public @interface CannotBlank {
    //é»˜è®¤é”™è¯¯æ¶ˆæ¯
    String message() default "ä¸èƒ½åŒ…å«ç©ºæ ¼";

    //åˆ†ç»„
    Class<?>[] groups() default {};

    //è´Ÿè½½
    Class<? extends Payload>[] payload() default {};

    //æŒ‡å®šå¤šä¸ªæ—¶ä½¿ç”¨
    @Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE})
    @Retention(RetentionPolicy.RUNTIME)
    @Documented
    @interface List {
        CannotBlank[] value();
    }
}
```



**ç¬¬äºŒæ­¥ ç¼–å†™çœŸæ­£çš„æ ¡éªŒç±»**



```java
package com.atguigu.spring6.validation.method4;

import jakarta.validation.ConstraintValidator;
import jakarta.validation.ConstraintValidatorContext;

public class CannotBlankValidator implements ConstraintValidator<CannotBlank, String> {

        @Override
        public void initialize(CannotBlank constraintAnnotation) {
        }

        @Override
        public boolean isValid(String value, ConstraintValidatorContext context) {
                //nullæ—¶ä¸è¿›è¡Œæ ¡éªŒ
                if (value != null && value.contains(" ")) {
                        //è·å–é»˜è®¤æç¤ºä¿¡æ¯
                        String defaultConstraintMessageTemplate = context.getDefaultConstraintMessageTemplate();
                        System.out.println("default message :" + defaultConstraintMessageTemplate);
                        //ç¦ç”¨é»˜è®¤æç¤ºä¿¡æ¯
                        context.disableDefaultConstraintViolation();
                        //è®¾ç½®æç¤ºè¯­
                        context.buildConstraintViolationWithTemplate("can not contains blank").addConstraintViolation();
                        return false;
                }
                return true;
        }
}
```



## 11ã€æå‰ç¼–è¯‘ï¼šAOT


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221218154841001.png)



### 11.1ã€AOTæ¦‚è¿°


#### 11.1.1ã€JITä¸AOTçš„åŒºåˆ«


JITå’ŒAOT è¿™ä¸ªåè¯æ˜¯æŒ‡ä¸¤ç§ä¸åŒçš„ç¼–è¯‘æ–¹å¼ï¼Œè¿™ä¸¤ç§ç¼–è¯‘æ–¹å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦åœ¨â€œè¿è¡Œæ—¶â€è¿›è¡Œç¼–è¯‘



**ï¼ˆ1ï¼‰JITï¼Œ Just-in-time,åŠ¨æ€(å³æ—¶)ç¼–è¯‘ï¼Œè¾¹è¿è¡Œè¾¹ç¼–è¯‘ï¼›**



åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ ¹æ®ç®—æ³•è®¡ç®—å‡ºçƒ­ç‚¹ä»£ç ï¼Œç„¶åè¿›è¡Œ JIT å®æ—¶ç¼–è¯‘ï¼Œè¿™ç§æ–¹å¼ååé‡é«˜ï¼Œæœ‰è¿è¡Œæ—¶æ€§èƒ½åŠ æˆï¼Œå¯ä»¥è·‘å¾—æ›´å¿«ï¼Œå¹¶å¯ä»¥åšåˆ°åŠ¨æ€ç”Ÿæˆä»£ç ç­‰ï¼Œä½†æ˜¯ç›¸å¯¹å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶éœ€è¦ä¸€å®šæ—¶é—´å’Œè°ƒç”¨é¢‘ç‡æ‰èƒ½è§¦å‘ JIT çš„åˆ†å±‚æœºåˆ¶ã€‚JIT ç¼ºç‚¹å°±æ˜¯ç¼–è¯‘éœ€è¦å ç”¨è¿è¡Œæ—¶èµ„æºï¼Œä¼šå¯¼è‡´è¿›ç¨‹å¡é¡¿ã€‚



**ï¼ˆ2ï¼‰AOTï¼ŒAhead Of Timeï¼ŒæŒ‡è¿è¡Œå‰ç¼–è¯‘ï¼Œé¢„å…ˆç¼–è¯‘ã€‚**



AOT ç¼–è¯‘èƒ½ç›´æ¥å°†æºä»£ç è½¬åŒ–ä¸ºæœºå™¨ç ï¼Œå†…å­˜å ç”¨ä½ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œå¯ä»¥æ— éœ€ runtime è¿è¡Œï¼Œç›´æ¥å°† runtime é™æ€é“¾æ¥è‡³æœ€ç»ˆçš„ç¨‹åºä¸­ï¼Œä½†æ˜¯æ— è¿è¡Œæ—¶æ€§èƒ½åŠ æˆï¼Œä¸èƒ½æ ¹æ®ç¨‹åºè¿è¡Œæƒ…å†µåšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼ŒAOT ç¼ºç‚¹å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰ç¼–è¯‘ä¼šä½¿ç¨‹åºå®‰è£…çš„æ—¶é—´å¢åŠ ã€‚



**ç®€å•æ¥è®²ï¼š**JITå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€Œ AOT ç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚



```plain
.java -> .class -> (ä½¿ç”¨jaotcç¼–è¯‘å·¥å…·) -> .soï¼ˆç¨‹åºå‡½æ•°åº“,å³ç¼–è¯‘å¥½çš„å¯ä»¥ä¾›å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç å’Œæ•°æ®ï¼‰
```



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207113544080.png)



**ï¼ˆ3ï¼‰AOTçš„ä¼˜ç‚¹**



**ç®€å•æ¥è®²ï¼Œ**Java è™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…åŠæ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘ Java åº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒã€‚



åœ¨ç¨‹åºè¿è¡Œå‰ç¼–è¯‘ï¼Œå¯ä»¥é¿å…åœ¨è¿è¡Œæ—¶çš„ç¼–è¯‘æ€§èƒ½æ¶ˆè€—å’Œå†…å­˜æ¶ˆè€—  
å¯ä»¥åœ¨ç¨‹åºè¿è¡ŒåˆæœŸå°±è¾¾åˆ°æœ€é«˜æ€§èƒ½ï¼Œç¨‹åºå¯åŠ¨é€Ÿåº¦å¿«  
è¿è¡Œäº§ç‰©åªæœ‰æœºå™¨ç ï¼Œæ‰“åŒ…ä½“ç§¯å°



**AOTçš„ç¼ºç‚¹**



ç”±äºæ˜¯é™æ€æå‰ç¼–è¯‘ï¼Œä¸èƒ½æ ¹æ®ç¡¬ä»¶æƒ…å†µæˆ–ç¨‹åºè¿è¡Œæƒ…å†µæ‹©ä¼˜é€‰æ‹©æœºå™¨æŒ‡ä»¤åºåˆ—ï¼Œç†è®ºå³°å€¼æ€§èƒ½ä¸å¦‚JIT  
æ²¡æœ‰åŠ¨æ€èƒ½åŠ›ï¼ŒåŒä¸€ä»½äº§ç‰©ä¸èƒ½è·¨å¹³å°è¿è¡Œ



ç¬¬ä¸€ç§å³æ—¶ç¼–è¯‘ (JIT) æ˜¯é»˜è®¤æ¨¡å¼ï¼ŒJava Hotspot è™šæ‹Ÿæœºä½¿ç”¨å®ƒåœ¨è¿è¡Œæ—¶å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚åè€…æå‰ç¼–è¯‘ (AOT)ç”±æ–°é¢–çš„ GraalVM ç¼–è¯‘å™¨æ”¯æŒï¼Œå¹¶å…è®¸åœ¨æ„å»ºæ—¶å°†å­—èŠ‚ç ç›´æ¥é™æ€ç¼–è¯‘ä¸ºæœºå™¨ç ã€‚



ç°åœ¨æ­£å¤„äºäº‘åŸç”Ÿï¼Œé™æœ¬å¢æ•ˆçš„æ—¶ä»£ï¼ŒJava ç›¸æ¯”äº Goã€Rust ç­‰å…¶ä»–ç¼–ç¨‹è¯­è¨€éå¸¸å¤§çš„å¼Šç«¯å°±æ˜¯å¯åŠ¨ç¼–è¯‘å’Œå¯åŠ¨è¿›ç¨‹éå¸¸æ…¢ï¼Œè¿™å¯¹äºæ ¹æ®å®æ—¶è®¡ç®—èµ„æºï¼Œå¼¹æ€§æ‰©ç¼©å®¹çš„äº‘åŸç”ŸæŠ€æœ¯ç›¸å†²çªï¼ŒSpring6 å€ŸåŠ© AOT æŠ€æœ¯åœ¨è¿è¡Œæ—¶å†…å­˜å ç”¨ä½ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œé€æ¸çš„æ¥æ»¡è¶³ Java åœ¨äº‘åŸç”Ÿæ—¶ä»£çš„éœ€æ±‚ï¼Œå¯¹äºå¤§è§„æ¨¡ä½¿ç”¨ Java åº”ç”¨çš„å•†ä¸šå…¬å¸å¯ä»¥è€ƒè™‘å°½æ—©è°ƒç ”ä½¿ç”¨ JDK17ï¼Œé€šè¿‡äº‘åŸç”ŸæŠ€æœ¯ä¸ºå…¬å¸å®ç°é™æœ¬å¢æ•ˆã€‚



#### 11.1.2ã€Graalvm


Spring6 æ”¯æŒçš„ AOT æŠ€æœ¯ï¼Œè¿™ä¸ª GraalVM Â å°±æ˜¯åº•å±‚çš„æ”¯æŒï¼ŒSpring ä¹Ÿå¯¹ GraalVM æœ¬æœºæ˜ åƒæä¾›äº†ä¸€æµçš„æ”¯æŒã€‚GraalVM æ˜¯ä¸€ç§é«˜æ€§èƒ½ JDKï¼Œæ—¨åœ¨åŠ é€Ÿç”¨ Java å’Œå…¶ä»– JVM è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ŒåŒæ—¶è¿˜ä¸º JavaScriptã€Python å’Œè®¸å¤šå…¶ä»–æµè¡Œè¯­è¨€æä¾›è¿è¡Œæ—¶ã€‚ GraalVM æä¾›ä¸¤ç§è¿è¡Œ Java åº”ç”¨ç¨‹åºçš„æ–¹æ³•ï¼šåœ¨ HotSpot JVM ä¸Šä½¿ç”¨ Graal å³æ—¶ (JIT) ç¼–è¯‘å™¨æˆ–ä½œä¸ºæå‰ (AOT) ç¼–è¯‘çš„æœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ GraalVM çš„å¤šè¯­è¨€èƒ½åŠ›ä½¿å¾—åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­æ··åˆå¤šç§ç¼–ç¨‹è¯­è¨€æˆä¸ºå¯èƒ½ï¼ŒåŒæ—¶æ¶ˆé™¤äº†å¤–è¯­è°ƒç”¨æˆæœ¬ã€‚GraalVM å‘ HotSpot Java è™šæ‹Ÿæœºæ·»åŠ äº†ä¸€ä¸ªç”¨ Java ç¼–å†™çš„é«˜çº§å³æ—¶ (JIT) ä¼˜åŒ–ç¼–è¯‘å™¨ã€‚



GraalVM å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š



ï¼ˆ1ï¼‰ä¸€ç§é«˜çº§ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œå®ƒç”Ÿæˆæ›´å¿«ã€æ›´ç²¾ç®€çš„ä»£ç ï¼Œéœ€è¦æ›´å°‘çš„è®¡ç®—èµ„æº



ï¼ˆ2ï¼‰AOT æœ¬æœºå›¾åƒç¼–è¯‘æå‰å°† Java åº”ç”¨ç¨‹åºç¼–è¯‘ä¸ºæœ¬æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç«‹å³å¯åŠ¨ï¼Œæ— éœ€é¢„çƒ­å³å¯å®ç°æœ€é«˜æ€§èƒ½



ï¼ˆ3ï¼‰Polyglot ç¼–ç¨‹åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­åˆ©ç”¨æµè¡Œè¯­è¨€çš„æœ€ä½³åŠŸèƒ½å’Œåº“ï¼Œæ— éœ€é¢å¤–å¼€é”€



ï¼ˆ4ï¼‰é«˜çº§å·¥å…·åœ¨ Java å’Œå¤šç§è¯­è¨€ä¸­è°ƒè¯•ã€ç›‘è§†ã€åˆ†æå’Œä¼˜åŒ–èµ„æºæ¶ˆè€—



æ€»çš„æ¥è¯´å¯¹äº‘åŸç”Ÿçš„è¦æ±‚ä¸ç®—é«˜çŸ­æœŸå†…å¯ä»¥ç»§ç»­ä½¿ç”¨ 2.7.X çš„ç‰ˆæœ¬å’Œ JDK8ï¼Œä¸è¿‡ Spring å®˜æ–¹å·²ç»å¯¹ Spring6 è¿›è¡Œäº†æ­£å¼ç‰ˆå‘å¸ƒã€‚



#### 11.1.3ã€Native Image


ç›®å‰ä¸šç•Œé™¤äº†è¿™ç§åœ¨JVMä¸­è¿›è¡ŒAOTçš„æ–¹æ¡ˆï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å®ç°Java AOTçš„æ€è·¯ï¼Œé‚£å°±æ˜¯ç›´æ¥æ‘’å¼ƒJVMï¼Œå’ŒC/C<u>ä¸€æ ·é€šè¿‡ç¼–è¯‘å™¨ç›´æ¥å°†ä»£ç ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œç„¶åè¿è¡Œã€‚è¿™æ— ç–‘æ˜¯ä¸€ç§ç›´æ¥é¢ è¦†Javaè¯­è¨€è®¾è®¡çš„æ€è·¯ï¼Œé‚£å°±æ˜¯GraalVM Native Imageã€‚å®ƒé€šè¿‡Cè¯­è¨€å®ç°äº†ä¸€ä¸ªè¶…å¾®ç¼©çš„è¿è¡Œæ—¶ç»„ä»¶ â€”â€” Substrate VMï¼ŒåŸºæœ¬å®ç°äº†JVMçš„å„ç§ç‰¹æ€§ï¼Œä½†è¶³å¤Ÿè½»é‡ã€å¯ä»¥è¢«è½»æ¾å†…åµŒï¼Œè¿™å°±è®©Javaè¯­è¨€å’Œå·¥ç¨‹æ‘†è„±JVMçš„é™åˆ¶ï¼Œèƒ½å¤ŸçœŸæ­£æ„ä¹‰ä¸Šå®ç°å’ŒC/C</u>ä¸€æ ·çš„AOTç¼–è¯‘ã€‚è¿™ä¸€æ–¹æ¡ˆåœ¨ç»è¿‡é•¿æ—¶é—´çš„ä¼˜åŒ–å’Œç§¯ç´¯åï¼Œå·²ç»æ‹¥æœ‰éå¸¸ä¸é”™çš„æ•ˆæœï¼ŒåŸºæœ¬ä¸Šæˆä¸ºOracleå®˜æ–¹é¦–æ¨çš„Java AOTè§£å†³æ–¹æ¡ˆã€‚  
Native Image æ˜¯ä¸€é¡¹åˆ›æ–°æŠ€æœ¯ï¼Œå¯å°† Java ä»£ç ç¼–è¯‘æˆç‹¬ç«‹çš„æœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶æˆ–æœ¬æœºå…±äº«åº“ã€‚åœ¨æ„å»ºæœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶æœŸé—´å¤„ç†çš„ Java å­—èŠ‚ç åŒ…æ‹¬æ‰€æœ‰åº”ç”¨ç¨‹åºç±»ã€ä¾èµ–é¡¹ã€ç¬¬ä¸‰æ–¹ä¾èµ–åº“å’Œä»»ä½•æ‰€éœ€çš„ JDK ç±»ã€‚ç”Ÿæˆçš„è‡ªåŒ…å«æœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶ç‰¹å®šäºä¸éœ€è¦ JVM çš„æ¯ä¸ªå•ç‹¬çš„æ“ä½œç³»ç»Ÿå’Œæœºå™¨ä½“ç³»ç»“æ„ã€‚



### 11.2ã€æ¼”ç¤ºNative Imageæ„å»ºè¿‡ç¨‹


#### 11.2.1ã€GraalVMå®‰è£…


##### ï¼ˆ1ï¼‰ä¸‹è½½GraalVM


è¿›å…¥å®˜ç½‘ä¸‹è½½ï¼š[https://www.graalvm.org/downloads/](https://www.graalvm.org/downloads/)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207153944132.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207152841304.png)



##### ï¼ˆ2ï¼‰é…ç½®ç¯å¢ƒå˜é‡


**æ·»åŠ GRAALVM_HOME**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207110539954.png)



**æŠŠJAVA_HOMEä¿®æ”¹ä¸ºgraalvmçš„ä½ç½®**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207153724340.png)



**æŠŠPathä¿®æ”¹ä½graalvmçš„binä½ç½®**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207153755732.png)



**ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207153642253.png)



##### ï¼ˆ3ï¼‰å®‰è£…native-imageæ’ä»¶


**ä½¿ç”¨å‘½ä»¤ gu install native-imageä¸‹è½½å®‰è£…**



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207155009832.png)



#### 11.2.2ã€å®‰è£…C++çš„ç¼–è¯‘ç¯å¢ƒ


##### ï¼ˆ1ï¼‰ä¸‹è½½Visual Studioå®‰è£…è½¯ä»¶


[https://visualstudio.microsoft.com/zh-hans/downloads/](https://visualstudio.microsoft.com/zh-hans/downloads/)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221219112426052.png)



##### ï¼ˆ2ï¼‰å®‰è£…Visual Studio


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207155726572.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207155756512.png)



##### ï¼ˆ3ï¼‰æ·»åŠ Visual Studioç¯å¢ƒå˜é‡


é…ç½®INCLUDEã€LIBå’ŒPath



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207110947997.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111012582.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111105569.png)



##### ï¼ˆ4ï¼‰æ‰“å¼€å·¥å…·ï¼Œåœ¨å·¥å…·ä¸­æ“ä½œ


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111206279.png)



#### 11.2.3ã€ç¼–å†™ä»£ç ï¼Œæ„å»ºNative Image


##### ï¼ˆ1ï¼‰ç¼–å†™Javaä»£ç 


```java
public class Hello {

    public static void main(String[] args) {
        System.out.println("hello world");
    }
}
```



##### ï¼ˆ2ï¼‰å¤åˆ¶æ–‡ä»¶åˆ°ç›®å½•ï¼Œæ‰§è¡Œç¼–è¯‘


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111420056.png)



##### ï¼ˆ3ï¼‰Native Image è¿›è¡Œæ„å»º


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111509837.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111609878.png)



##### ï¼ˆ4ï¼‰æŸ¥çœ‹æ„å»ºçš„æ–‡ä»¶


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111644950.png)



##### ï¼ˆ5ï¼‰æ‰§è¡Œæ„å»ºçš„æ–‡ä»¶


![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111731150.png)



å¯ä»¥çœ‹åˆ°è¿™ä¸ªHelloæœ€ç»ˆæ‰“åŒ…äº§å‡ºçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ä¸º11Mï¼Œè¿™æ˜¯åŒ…å«äº†SVMå’ŒJDKå„ç§åº“åçš„å¤§å°ï¼Œè™½ç„¶ç›¸æ¯”C/C++çš„äºŒè¿›åˆ¶æ–‡ä»¶æ¥è¯´ä½“ç§¯åå¤§ï¼Œä½†æ˜¯å¯¹æ¯”å®Œæ•´JVMæ¥è¯´ï¼Œå¯ä»¥è¯´æ˜¯å·²ç»æ˜¯éå¸¸å°äº†ã€‚



ç›¸æ¯”äºä½¿ç”¨JVMè¿è¡Œï¼ŒNative Imageçš„é€Ÿåº¦è¦å¿«ä¸Šä¸å°‘ï¼Œcpuå ç”¨ä¹Ÿæ›´ä½ä¸€äº›ï¼Œä»å®˜æ–¹æä¾›çš„å„ç±»å®éªŒæ•°æ®ä¹Ÿå¯ä»¥çœ‹å‡ºNative Imageå¯¹äºå¯åŠ¨é€Ÿåº¦å’Œå†…å­˜å ç”¨å¸¦æ¥çš„æå‡æ˜¯éå¸¸æ˜¾è‘—çš„ï¼š



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207111947283.png)



![](https://cdn.jsdelivr.net/gh/czlifetime/img/image-20221207112009852.png)

